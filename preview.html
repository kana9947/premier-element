<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premier &Eacute;l&eacute;ment - Preview Mode Test</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
tailwind.config={theme:{extend:{colors:{
primary:{50:'#eff6ff',100:'#dbeafe',200:'#bfdbfe',300:'#93c5fd',400:'#60a5fa',500:'#3b82f6',600:'#2563eb',700:'#1d4ed8',800:'#1e40af',900:'#1e3a8a'},
enterprise:{50:'#f5f3ff',100:'#ede9fe',500:'#8b5cf6',600:'#7c3aed',700:'#6d28d9'},
worker:{50:'#ecfdf5',100:'#d1fae5',500:'#10b981',600:'#059669',700:'#047857'},
manager:{50:'#fffbeb',100:'#fef3c7',500:'#f59e0b',600:'#d97706',700:'#b45309'},
}}}}
</script>
<style>
.view{display:none}.view.active{display:block}
body{margin:0;font-family:system-ui,-apple-system,sans-serif}
.leaflet-container{height:200px;width:100%;border-radius:12px;z-index:1}
.transport-btn{transition:all .2s}
.transport-btn.active{border-color:#1e40af;background:#eff6ff;color:#1e40af}
</style>
</head>
<body class="bg-gray-50 text-gray-900 antialiased">


<div class="flex min-h-screen">

<!-- ===== SIDEBAR ===== -->
<div id="sidebar" class="w-80 bg-gray-900 text-white flex flex-col overflow-hidden flex-shrink-0 transition-all duration-300" style="min-width:320px">
  <div class="p-4 bg-gray-800 border-b border-gray-700">
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-lg font-bold text-orange-400">MODE TEST</h3>
      <button onclick="toggleSidebar()" class="text-gray-400 hover:text-white"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></svg></button>
    </div>
    <div class="w-full py-2 rounded-lg font-semibold text-sm bg-orange-500 text-white text-center">Mode Test : ACTIF</div>
    <div id="currentUser" class="mt-2 px-3 py-2 bg-gray-700 rounded-lg text-xs hidden">
      <span class="text-gray-400">Connect&eacute; :</span> <span id="currentUserName" class="font-semibold"></span> <span id="currentUserBadge" class="px-1.5 py-0.5 rounded text-[10px] font-bold ml-1"></span>
    </div>
  </div>
  <div class="flex border-b border-gray-700">
    <button onclick="setSidebarTab('accounts')" id="tab-accounts" class="flex-1 py-2.5 text-sm font-medium text-orange-400 border-b-2 border-orange-400 bg-gray-800">Comptes</button>
    <button onclick="setSidebarTab('navigate')" id="tab-navigate" class="flex-1 py-2.5 text-sm font-medium text-gray-400 hover:text-gray-200">Navigation</button>
  </div>
  <!-- Accounts -->
  <div id="panel-accounts" class="flex-1 overflow-y-auto p-4">
    <div class="space-y-4">
      <div><p class="text-xs font-semibold text-purple-400 mb-2 uppercase tracking-wide">Clients</p><div class="space-y-1.5">
        <button onclick="switchUser('pierre')" class="acct-btn w-full text-left px-3 py-2.5 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-user="pierre"><div class="font-medium">Pierre Durand</div><div class="text-xs text-gray-400 mt-0.5">Test Services Inc.</div></button>
        <button onclick="switchUser('marie')" class="acct-btn w-full text-left px-3 py-2.5 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-user="marie"><div class="font-medium">Marie Martin</div><div class="text-xs text-gray-400 mt-0.5">ProClean Solutions</div></button>
      </div></div>
      <div><p class="text-xs font-semibold text-amber-400 mb-2 uppercase tracking-wide">Gestionnaires</p><div class="space-y-1.5">
        <button onclick="switchUser('admin')" class="acct-btn w-full text-left px-3 py-2.5 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-user="admin"><div class="font-medium">Admin Gestionnaire</div><div class="text-xs text-gray-400 mt-0.5">Gestionnaire principal</div></button>
        <button onclick="switchUser('sarah')" class="acct-btn w-full text-left px-3 py-2.5 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-user="sarah"><div class="font-medium">Sarah C&ocirc;t&eacute;</div><div class="text-xs text-gray-400 mt-0.5">Gestionnaire active</div></button>
        <button onclick="switchUser('luc')" class="acct-btn w-full text-left px-3 py-2.5 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-user="luc"><div class="font-medium">Luc Mercier</div><div class="text-xs text-gray-400 mt-0.5">Gestionnaire en attente</div></button>
      </div></div>
      <div><p class="text-xs font-semibold text-green-400 mb-2 uppercase tracking-wide">Travailleurs</p><div class="space-y-1.5">
        <button onclick="switchUser('julie')" class="acct-btn w-full text-left px-3 py-2.5 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-user="julie"><div class="font-medium">Julie Leblanc</div><div class="text-xs text-gray-400 mt-0.5">Nettoyage r&eacute;sidentiel</div></button>
        <button onclick="switchUser('marc')" class="acct-btn w-full text-left px-3 py-2.5 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-user="marc"><div class="font-medium">Marc Tremblay</div><div class="text-xs text-gray-400 mt-0.5">D&eacute;m&eacute;nagement</div></button>
        <button onclick="switchUser('sophie')" class="acct-btn w-full text-left px-3 py-2.5 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-user="sophie"><div class="font-medium">Sophie Roy</div><div class="text-xs text-gray-400 mt-0.5">Multi-services</div></button>
      </div></div>
      <button onclick="logoutUser()" id="btn-logout-sidebar" class="w-full py-2 mt-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg hidden">D&eacute;connexion</button>
    </div>
  </div>
  <!-- Navigate -->
  <div id="panel-navigate" class="flex-1 overflow-y-auto p-4 hidden">
    <div class="space-y-4">
      <div><p class="text-xs font-semibold text-blue-400 mb-2 uppercase tracking-wide">Pages publiques</p><div class="space-y-1">
        <button onclick="navigate('landing')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="landing">Accueil</button>
        <button onclick="navigate('login')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="login">Connexion</button>
        <button onclick="navigate('register')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="register">Inscription</button>
      </div></div>
      <div><p class="text-xs font-semibold text-purple-400 mb-2 uppercase tracking-wide">Portail Client</p><div class="space-y-1">
        <button onclick="navigate('client')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="client">Dashboard</button>
        <button onclick="navigate('client-missions')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="client-missions">Missions</button>
        <button onclick="navigate('client-mission-new')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="client-mission-new">+ Nouvelle mission</button>
        <button onclick="navigate('client-sites')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="client-sites">Sites de travail</button>
        <button onclick="navigate('client-contracts')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="client-contracts">Contrats</button>
        <button onclick="navigate('client-reports')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="client-reports">Rapports</button>
        <button onclick="navigate('client-messaging')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="client-messaging">Messagerie</button>
      </div></div>
      <div><p class="text-xs font-semibold text-amber-400 mb-2 uppercase tracking-wide">Portail Gestionnaire</p><div class="space-y-1">
        <button onclick="navigate('manager')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="manager">Dashboard</button>
        <button onclick="navigate('manager-missions')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="manager-missions">Missions</button>
        <button onclick="navigate('manager-workers')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="manager-workers">Travailleurs</button>
        <button onclick="navigate('manager-validation')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="manager-validation">Validation heures</button>
        <button onclick="navigate('manager-clients')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="manager-clients">Clients</button>
        <button onclick="navigate('manager-contracts')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="manager-contracts">Contrats</button>
        <button onclick="navigate('manager-reports')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="manager-reports">Rapports</button>
        <button onclick="navigate('manager-messaging')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="manager-messaging">Messagerie</button>
        <button onclick="navigate('manager-team')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="manager-team">Gestion &eacute;quipe</button>
      </div></div>
      <div><p class="text-xs font-semibold text-green-400 mb-2 uppercase tracking-wide">Portail Travailleur</p><div class="space-y-1">
        <button onclick="navigate('worker-shifts')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="worker-shifts">Quarts offerts</button>
        <button onclick="navigate('worker-shifts-calendar')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="worker-shifts-calendar">Calendrier</button>
        <button onclick="navigate('worker-myshifts')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="worker-myshifts">Mes quarts</button>
        <button onclick="navigate('worker-billing')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="worker-billing">Facturation</button>
        <button onclick="navigate('worker-notifications')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="worker-notifications">Notifications</button>
        <button onclick="navigate('worker-messaging')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="worker-messaging">Messagerie</button>
        <button onclick="navigate('worker-reports')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="worker-reports">Rapports</button>
        <button onclick="navigate('worker-profile')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="worker-profile">Profil</button>
        <button onclick="navigate('worker-profile-account')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="worker-profile-account">Compte</button>
        <button onclick="navigate('worker-profile-payment')" class="nav-btn w-full text-left px-3 py-2 rounded-lg text-sm bg-gray-800 hover:bg-gray-700 text-gray-200" data-view="worker-profile-payment">Paiement</button>
      </div></div>
    </div>
  </div>
  <div class="p-3 bg-gray-800 border-t border-gray-700 text-center text-[10px] text-gray-500">Panneau de test - Ne pas utiliser en production</div>
</div>

<!-- Sidebar toggle -->
<div id="sidebar-toggle" class="fixed bottom-4 left-4 z-50 hidden">
  <button onclick="toggleSidebar()" class="w-14 h-14 bg-orange-500 hover:bg-orange-600 text-white rounded-full shadow-xl flex items-center justify-center hover:scale-110 transition-all">
    <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
  </button>
</div>

<!-- ===== MAIN CONTENT ===== -->
<div class="flex-1 overflow-y-auto" id="main-content">

<!-- ===== LANDING ===== -->
<div id="view-landing" class="view active">
  <header class="bg-white shadow-sm"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-16">
    <div class="flex items-center gap-3"><img src="logo.png" width="38" height="38" alt="Logo"><span class="text-2xl font-bold text-primary-600">Premier &Eacute;l&eacute;ment</span></div>
    <div class="flex items-center gap-4"><button class="text-xs font-medium px-2 py-1 rounded bg-gray-100">FR / EN</button><button onclick="navigate('login')" class="text-sm font-medium text-gray-600">Connexion</button><button onclick="navigate('register')" class="px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg">Inscription</button></div>
  </div></header>
  <section class="bg-gradient-to-br from-primary-600 to-primary-800 text-white"><div class="max-w-7xl mx-auto px-4 py-24 text-center">
    <div class="flex justify-center mb-8"><img src="logo.png" width="120" height="120" alt="Logo" class="drop-shadow-2xl"></div>
    <h1 class="text-4xl sm:text-5xl font-bold mb-6">Trouvez les meilleurs travailleurs pour vos besoins</h1>
    <p class="text-xl text-primary-100 mb-12 max-w-2xl mx-auto">M&eacute;nage r&eacute;sidentiel, commercial et d&eacute;m&eacute;nagement</p>
    <div class="flex flex-col sm:flex-row gap-4 justify-center">
      <button onclick="switchUser('pierre')" class="px-8 py-4 bg-enterprise-600 hover:bg-enterprise-700 text-white font-semibold rounded-xl text-lg shadow-lg">Espace Client</button>
      <button onclick="switchUser('julie')" class="px-8 py-4 bg-worker-600 hover:bg-worker-700 text-white font-semibold rounded-xl text-lg shadow-lg">Espace Travailleur</button>
    </div>
  </div></section>
  <section class="py-12 bg-amber-50 border-y-2 border-amber-200"><div class="max-w-5xl mx-auto px-4">
    <div class="text-center mb-8"><span class="inline-block px-4 py-1 bg-amber-500 text-white text-xs font-bold rounded-full mb-3">MODE DEMO</span><h2 class="text-2xl font-bold text-gray-900">Connexion rapide</h2><p class="text-gray-600 mt-2">Cliquez sur un compte pour explorer l'application.</p></div>
    <div class="grid md:grid-cols-2 gap-8">
      <div><h3 class="text-sm font-bold text-purple-700 uppercase tracking-wider mb-4 flex items-center gap-2"><span class="w-3 h-3 bg-purple-500 rounded-full"></span>Portail Client</h3><div class="space-y-3">
        <button onclick="switchUser('pierre')" class="w-full text-left bg-white rounded-xl p-4 shadow-sm hover:shadow-md border-2 border-transparent hover:border-purple-300 group"><div class="flex justify-between items-center"><div><p class="font-semibold text-gray-900">Pierre Durand</p><p class="text-sm text-purple-600 font-medium">Test Services Inc.</p></div><span class="px-3 py-1.5 rounded-lg text-sm font-medium bg-purple-100 text-purple-700 group-hover:bg-purple-600 group-hover:text-white">Entrer</span></div></button>
        <button onclick="switchUser('marie')" class="w-full text-left bg-white rounded-xl p-4 shadow-sm hover:shadow-md border-2 border-transparent hover:border-purple-300 group"><div class="flex justify-between items-center"><div><p class="font-semibold text-gray-900">Marie Martin</p><p class="text-sm text-purple-600 font-medium">ProClean Solutions</p></div><span class="px-3 py-1.5 rounded-lg text-sm font-medium bg-purple-100 text-purple-700 group-hover:bg-purple-600 group-hover:text-white">Entrer</span></div></button>
      </div></div>
      <div><h3 class="text-sm font-bold text-green-700 uppercase tracking-wider mb-4 flex items-center gap-2"><span class="w-3 h-3 bg-green-500 rounded-full"></span>Portail Travailleur</h3><div class="space-y-3">
        <button onclick="switchUser('julie')" class="w-full text-left bg-white rounded-xl p-4 shadow-sm hover:shadow-md border-2 border-transparent hover:border-green-300 group"><div class="flex justify-between items-center"><div><p class="font-semibold text-gray-900">Julie Leblanc</p><p class="text-sm text-green-600 font-medium">Nettoyage r&eacute;sidentiel</p></div><span class="px-3 py-1.5 rounded-lg text-sm font-medium bg-green-100 text-green-700 group-hover:bg-green-600 group-hover:text-white">Entrer</span></div></button>
        <button onclick="switchUser('marc')" class="w-full text-left bg-white rounded-xl p-4 shadow-sm hover:shadow-md border-2 border-transparent hover:border-green-300 group"><div class="flex justify-between items-center"><div><p class="font-semibold text-gray-900">Marc Tremblay</p><p class="text-sm text-green-600 font-medium">D&eacute;m&eacute;nagement</p></div><span class="px-3 py-1.5 rounded-lg text-sm font-medium bg-green-100 text-green-700 group-hover:bg-green-600 group-hover:text-white">Entrer</span></div></button>
        <button onclick="switchUser('sophie')" class="w-full text-left bg-white rounded-xl p-4 shadow-sm hover:shadow-md border-2 border-transparent hover:border-green-300 group"><div class="flex justify-between items-center"><div><p class="font-semibold text-gray-900">Sophie Roy</p><p class="text-sm text-green-600 font-medium">Multi-services</p></div><span class="px-3 py-1.5 rounded-lg text-sm font-medium bg-green-100 text-green-700 group-hover:bg-green-600 group-hover:text-white">Entrer</span></div></button>
      </div></div>
    </div>
  </div></section>
  <section class="py-20 bg-white"><div class="max-w-7xl mx-auto px-4">
    <h2 class="text-3xl font-bold text-center mb-16">Pourquoi nous choisir ?</h2>
    <div class="grid md:grid-cols-3 gap-8">
      <div class="text-center p-8 rounded-2xl bg-gray-50"><div class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg></div><h3 class="text-lg font-semibold mb-2">Mise en relation rapide</h3><p class="text-gray-600">Trouvez un travailleur en quelques clics</p></div>
      <div class="text-center p-8 rounded-2xl bg-gray-50"><div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg></div><h3 class="text-lg font-semibold mb-2">Paiements s&eacute;curis&eacute;s</h3><p class="text-gray-600">Suivi des contrats et paiements en toute transparence</p></div>
      <div class="text-center p-8 rounded-2xl bg-gray-50"><div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg></div><h3 class="text-lg font-semibold mb-2">Travailleurs qualifi&eacute;s</h3><p class="text-gray-600">Profils v&eacute;rifi&eacute;s et &eacute;valu&eacute;s</p></div>
    </div>
  </div></section>
  <footer class="bg-gray-900 text-gray-400 py-8"><div class="max-w-7xl mx-auto px-4 text-center text-sm">&copy; 2026 Premier &Eacute;l&eacute;ment. Tous droits r&eacute;serv&eacute;s.</div></footer>
</div>

<!-- ===== LOGIN ===== -->
<div id="view-login" class="view"><div class="min-h-screen flex items-center justify-center bg-gray-50 px-4"><div class="max-w-md w-full">
  <div class="text-center mb-8"><div class="flex justify-center mb-3 cursor-pointer" onclick="navigate('landing')"><img src="logo.png" width="64" height="64" alt="Logo"></div><span class="text-3xl font-bold text-primary-600">Premier &Eacute;l&eacute;ment</span><h2 class="mt-4 text-2xl font-semibold text-gray-900">Connexion</h2></div>
  <div class="bg-white shadow-lg rounded-2xl p-8 space-y-6">
    <div class="bg-orange-50 border border-orange-200 rounded-lg p-3"><p class="text-xs font-semibold text-orange-600 mb-2">Auto-remplissage rapide :</p><div class="flex gap-2"><button onclick="switchUser('pierre')" class="flex-1 py-2 bg-purple-100 text-purple-700 text-xs font-medium rounded-lg hover:bg-purple-200">Client</button><button onclick="switchUser('julie')" class="flex-1 py-2 bg-green-100 text-green-700 text-xs font-medium rounded-lg hover:bg-green-200">Travailleur</button></div></div>
    <div><label class="block text-sm font-medium text-gray-700 mb-1">Adresse email</label><input type="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="email@exemple.com"></div>
    <div><label class="block text-sm font-medium text-gray-700 mb-1">Mot de passe</label><input type="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg" value="demo1234"></div>
    <button class="w-full py-3 bg-primary-600 text-white font-semibold rounded-lg hover:bg-primary-700">Connexion</button>
    <p class="text-center text-sm text-gray-600">Pas de compte ? <span onclick="navigate('register')" class="text-primary-600 font-medium cursor-pointer hover:underline">Inscription</span></p>
  </div>
</div></div></div>

<!-- ===== REGISTER ===== -->
<div id="view-register" class="view"><div class="min-h-screen flex items-center justify-center bg-gray-50 px-4 py-8"><div class="max-w-md w-full">
  <div class="text-center mb-8"><div class="flex justify-center mb-3 cursor-pointer" onclick="navigate('landing')"><img src="logo.png" width="64" height="64" alt="Logo"></div><span class="text-3xl font-bold text-primary-600">Premier &Eacute;l&eacute;ment</span><h2 class="mt-4 text-2xl font-semibold text-gray-900">Inscription</h2></div>
  <div class="bg-white shadow-lg rounded-2xl p-8 space-y-5">
    <div class="flex bg-gray-100 rounded-lg p-1"><button id="reg-client" onclick="setRegRole('client')" class="flex-1 py-2 text-sm font-medium rounded-md bg-enterprise-600 text-white">Client</button><button id="reg-worker" onclick="setRegRole('worker')" class="flex-1 py-2 text-sm font-medium rounded-md text-gray-500">Travailleur</button></div>
    <div class="grid grid-cols-2 gap-3"><div><label class="block text-sm font-medium text-gray-700 mb-1">Pr&eacute;nom</label><input class="w-full px-3 py-2 border rounded-lg text-sm" value="Pierre"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Nom</label><input class="w-full px-3 py-2 border rounded-lg text-sm" value="Durand"></div></div>
    <div><label class="block text-sm font-medium text-gray-700 mb-1">Email</label><input class="w-full px-3 py-2 border rounded-lg text-sm" value="test@workerapp.com"></div>
    <div><label class="block text-sm font-medium text-gray-700 mb-1">T&eacute;l&eacute;phone</label><input class="w-full px-3 py-2 border rounded-lg text-sm" value="514-555-0100"></div>
    <div><label class="block text-sm font-medium text-gray-700 mb-1">Mot de passe</label><input type="password" class="w-full px-3 py-2 border rounded-lg text-sm" value="demo1234"></div>
    <div id="client-fields"><div class="space-y-3 pt-2 border-t"><div><label class="block text-sm font-medium text-gray-700 mb-1">Nom de l'entreprise</label><input class="w-full px-3 py-2 border rounded-lg text-sm" value="Test Services Inc."></div><div class="grid grid-cols-2 gap-3"><div><label class="block text-sm font-medium text-gray-700 mb-1">Ville</label><input class="w-full px-3 py-2 border rounded-lg text-sm" value="Montr&eacute;al"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Code postal</label><input class="w-full px-3 py-2 border rounded-lg text-sm" value="H2X 1A1"></div></div></div></div>
    <button class="w-full py-3 bg-primary-600 text-white font-semibold rounded-lg">S'inscrire</button>
  </div>
</div></div></div>

<!-- ===== CLIENT DASHBOARD ===== -->
<div id="view-client" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16">
    <div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-enterprise-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-enterprise-100 text-enterprise-700 px-2 py-0.5 rounded-full">Client</span></div>
    <div class="flex items-center gap-4"><span class="text-sm text-gray-600" id="client-user">Pierre Durand</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div>
  </div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-2 py-3 overflow-x-auto">
    <button onclick="navigate('client')" class="px-4 py-2 rounded-lg text-sm font-medium bg-enterprise-600 text-white">Dashboard</button>
    <button onclick="navigate('client-missions')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Missions</button>
    <button onclick="navigate('client-sites')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Sites de travail</button>
    <button onclick="navigate('client-contracts')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Contrats</button>
    <button onclick="navigate('client-reports')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Rapports</button>
    <button onclick="navigate('client-messaging')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50 relative">Messagerie<span class="client-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">3</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-2xl font-bold text-gray-900 mb-8">Tableau de bord client</h1>
    <div class="grid sm:grid-cols-2 md:grid-cols-4 gap-6">
      <div onclick="navigate('client-missions')" class="bg-white rounded-xl shadow-sm p-6 hover:shadow-md cursor-pointer"><div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center mb-4"><span class="text-white text-xl font-bold">3</span></div><p class="text-gray-600 font-medium">Missions actives</p></div>
      <div onclick="navigate('client-contracts')" class="bg-white rounded-xl shadow-sm p-6 hover:shadow-md cursor-pointer"><div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mb-4"><span class="text-white text-xl font-bold">4</span></div><p class="text-gray-600 font-medium">Total contrats</p></div>
      <div onclick="navigate('client-sites')" class="bg-white rounded-xl shadow-sm p-6 hover:shadow-md cursor-pointer"><div class="w-12 h-12 bg-amber-500 rounded-lg flex items-center justify-center mb-4"><span class="text-white text-xl font-bold">4</span></div><p class="text-gray-600 font-medium">Sites de travail</p></div>
      <div onclick="navigate('client-reports')" class="bg-white rounded-xl shadow-sm p-6 hover:shadow-md cursor-pointer"><div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center mb-4"><span class="text-white text-xl font-bold">2</span></div><p class="text-gray-600 font-medium">Rapports</p></div>
    </div>
  </main>
</div>

<!-- ===== CLIENT MISSIONS ===== -->
<div id="view-client-missions" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-enterprise-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-enterprise-100 text-enterprise-700 px-2 py-0.5 rounded-full">Client</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Pierre Durand</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-2 py-3 overflow-x-auto">
    <button onclick="navigate('client')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Dashboard</button>
    <button class="px-4 py-2 rounded-lg text-sm font-medium bg-enterprise-600 text-white">Missions</button>
    <button onclick="navigate('client-sites')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Sites de travail</button>
    <button onclick="navigate('client-contracts')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Contrats</button>
    <button onclick="navigate('client-reports')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Rapports</button>
    <button onclick="navigate('client-messaging')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50 relative">Messagerie<span class="client-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">3</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex justify-between items-center mb-6"><h1 class="text-2xl font-bold">Mes missions</h1><button onclick="navigate('client-mission-new')" class="px-4 py-2 bg-enterprise-600 text-white text-sm font-medium rounded-lg flex items-center gap-2"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>Cr&eacute;er une mission</button></div>
    <div class="space-y-4" id="missions-list"></div>
  </main>
</div>

<!-- ===== CLIENT MISSION NEW ===== -->
<div id="view-client-mission-new" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-enterprise-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-enterprise-100 text-enterprise-700 px-2 py-0.5 rounded-full">Client</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Pierre Durand</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-2 py-3 overflow-x-auto">
    <button onclick="navigate('client')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Dashboard</button>
    <button onclick="navigate('client-missions')" class="px-4 py-2 rounded-lg text-sm font-medium bg-enterprise-600 text-white">Missions</button>
    <button onclick="navigate('client-sites')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Sites de travail</button>
    <button onclick="navigate('client-contracts')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Contrats</button>
    <button onclick="navigate('client-reports')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Rapports</button>
    <button onclick="navigate('client-messaging')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50 relative">Messagerie<span class="client-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">3</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <button onclick="navigate('client-missions')" class="text-sm text-enterprise-600 font-medium mb-4 inline-flex items-center gap-1"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg> Retour aux missions</button>
    <h1 class="text-2xl font-bold mb-6">Nouvelle demande de mission</h1>
    <div class="grid lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2 space-y-6">
        <!-- Identité client -->
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h2 class="text-lg font-semibold mb-4 flex items-center gap-2"><span class="w-7 h-7 bg-enterprise-100 rounded-full flex items-center justify-center text-enterprise-700 text-sm font-bold">1</span>Informations du demandeur</h2>
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label class="text-xs text-gray-500 mb-1 block">Nom du client / entreprise <span class="text-red-500">*</span></label><input id="m-client-name" class="w-full px-4 py-2.5 border rounded-lg text-sm focus:ring-2 focus:ring-enterprise-500 focus:border-enterprise-500" placeholder="Ex: Test Services Inc. ou Jean Dupont" value="Test Services Inc."></div>
            <div><label class="text-xs text-gray-500 mb-1 block">Personne contact</label><input id="m-contact" class="w-full px-4 py-2.5 border rounded-lg text-sm" placeholder="Nom du responsable" value="Pierre Durand"></div>
            <div><label class="text-xs text-gray-500 mb-1 block">T&eacute;l&eacute;phone</label><input id="m-phone" class="w-full px-4 py-2.5 border rounded-lg text-sm" placeholder="514-555-0000" value="514-555-0100"></div>
            <div><label class="text-xs text-gray-500 mb-1 block">Courriel</label><input id="m-email" class="w-full px-4 py-2.5 border rounded-lg text-sm" placeholder="email@exemple.com" value="pierre@testservices.ca"></div>
          </div>
        </div>
        <!-- Adresse + Map -->
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h2 class="text-lg font-semibold mb-4 flex items-center gap-2"><span class="w-7 h-7 bg-enterprise-100 rounded-full flex items-center justify-center text-enterprise-700 text-sm font-bold">2</span>Lieu du service</h2>
          <div class="grid sm:grid-cols-2 gap-4 mb-4">
            <div class="sm:col-span-2"><label class="text-xs text-gray-500 mb-1 block">Adresse compl&egrave;te <span class="text-red-500">*</span></label><div class="flex gap-2"><input id="m-address" class="flex-1 px-4 py-2.5 border rounded-lg text-sm" placeholder="123 rue Exemple, Montr&eacute;al, QC"><button onclick="geocodeMissionAddress()" class="px-4 py-2.5 bg-enterprise-600 text-white text-sm rounded-lg hover:bg-enterprise-700 flex-shrink-0">Localiser</button></div></div>
            <div><label class="text-xs text-gray-500 mb-1 block">Ville</label><input id="m-city" class="w-full px-4 py-2.5 border rounded-lg text-sm" placeholder="Montr&eacute;al"></div>
            <div><label class="text-xs text-gray-500 mb-1 block">Code postal</label><input id="m-postal" class="w-full px-4 py-2.5 border rounded-lg text-sm" placeholder="H2X 1Y4"></div>
          </div>
          <div id="mission-map" class="rounded-xl overflow-hidden border" style="height:220px;z-index:1"></div>
        </div>
        <!-- Service -->
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h2 class="text-lg font-semibold mb-4 flex items-center gap-2"><span class="w-7 h-7 bg-enterprise-100 rounded-full flex items-center justify-center text-enterprise-700 text-sm font-bold">3</span>Service demand&eacute;</h2>
          <div class="mb-4"><label class="text-xs text-gray-500 mb-2 block">Type de service <span class="text-red-500">*</span></label>
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-2" id="m-service-types">
              <button onclick="selectMissionService(this,'menage')" class="px-3 py-3 border-2 rounded-xl text-sm font-medium text-center border-enterprise-500 bg-enterprise-50 text-enterprise-700" data-svc="menage"><span class="text-xl block mb-1">&#128467;</span>M&eacute;nage</button>
              <button onclick="selectMissionService(this,'entretien')" class="px-3 py-3 border-2 rounded-xl text-sm font-medium text-center border-gray-200 text-gray-500" data-svc="entretien"><span class="text-xl block mb-1">&#128736;</span>Entretien</button>
              <button onclick="selectMissionService(this,'demenagement')" class="px-3 py-3 border-2 rounded-xl text-sm font-medium text-center border-gray-200 text-gray-500" data-svc="demenagement"><span class="text-xl block mb-1">&#128666;</span>D&eacute;m&eacute;nagement</button>
              <button onclick="selectMissionService(this,'autre')" class="px-3 py-3 border-2 rounded-xl text-sm font-medium text-center border-gray-200 text-gray-500" data-svc="autre"><span class="text-xl block mb-1">&#128295;</span>Autre</button>
            </div>
          </div>
          <div><label class="text-xs text-gray-500 mb-1 block">Titre de la mission <span class="text-red-500">*</span></label><input id="m-title" class="w-full px-4 py-2.5 border rounded-lg text-sm" placeholder="Ex: Nettoyage complet des bureaux"></div>
          <div class="mt-4"><label class="text-xs text-gray-500 mb-1 block">Description d&eacute;taill&eacute;e du service</label><textarea id="m-description" class="w-full px-4 py-2.5 border rounded-lg text-sm h-28 resize-none" placeholder="D&eacute;crivez les t&acirc;ches &agrave; r&eacute;aliser, les exigences particuli&egrave;res, le mat&eacute;riel fourni ou requis..."></textarea></div>
        </div>
        <!-- Horaires & Conditions -->
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h2 class="text-lg font-semibold mb-4 flex items-center gap-2"><span class="w-7 h-7 bg-enterprise-100 rounded-full flex items-center justify-center text-enterprise-700 text-sm font-bold">4</span>Horaires et conditions</h2>
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label class="text-xs text-gray-500 mb-1 block">Date de d&eacute;but <span class="text-red-500">*</span></label><input type="date" id="m-start-date" class="w-full px-4 py-2.5 border rounded-lg text-sm" value="2026-02-15"></div>
            <div><label class="text-xs text-gray-500 mb-1 block">Date de fin</label><input type="date" id="m-end-date" class="w-full px-4 py-2.5 border rounded-lg text-sm" value="2026-02-28"></div>
            <div><label class="text-xs text-gray-500 mb-1 block">Heure de d&eacute;but</label><input type="time" id="m-start-time" class="w-full px-4 py-2.5 border rounded-lg text-sm" value="09:00"></div>
            <div><label class="text-xs text-gray-500 mb-1 block">Heure de fin</label><input type="time" id="m-end-time" class="w-full px-4 py-2.5 border rounded-lg text-sm" value="17:00"></div>
            <div><label class="text-xs text-gray-500 mb-1 block">R&eacute;currence</label><select id="m-recurrence" class="w-full px-4 py-2.5 border rounded-lg text-sm bg-white"><option value="none">Ponctuel</option><option value="daily">Quotidien</option><option value="weekly" selected>Hebdomadaire</option><option value="biweekly">Bimensuel</option><option value="monthly">Mensuel</option></select></div>
            <div><label class="text-xs text-gray-500 mb-1 block">Travailleurs requis</label><input type="number" id="m-workers" class="w-full px-4 py-2.5 border rounded-lg text-sm" value="2" min="1"></div>
          </div>
        </div>
        <!-- Budget -->
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h2 class="text-lg font-semibold mb-4 flex items-center gap-2"><span class="w-7 h-7 bg-enterprise-100 rounded-full flex items-center justify-center text-enterprise-700 text-sm font-bold">5</span>Budget propos&eacute;</h2>
          <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4 text-sm text-amber-800"><strong>Note :</strong> Le co&ucirc;t propos&eacute; est indicatif. Apr&egrave;s &eacute;valuation par notre gestionnaire, un co&ucirc;t final sera convenu entre les parties.</div>
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label class="text-xs text-gray-500 mb-1 block">Taux horaire propos&eacute; ($/h)</label><input type="number" id="m-rate" class="w-full px-4 py-2.5 border rounded-lg text-sm" placeholder="22.00" step="0.5" min="15" value="22"></div>
            <div><label class="text-xs text-gray-500 mb-1 block">Budget mensuel estim&eacute; ($)</label><input type="number" id="m-budget" class="w-full px-4 py-2.5 border rounded-lg text-sm" placeholder="3 500" step="100"></div>
          </div>
          <p class="text-xs text-gray-400 mt-3">Le taux final sera confirm&eacute; apr&egrave;s &eacute;valuation. Premier &Eacute;l&eacute;ment se r&eacute;serve le droit d'ajuster selon la complexit&eacute; du service.</p>
        </div>
      </div>
      <!-- Résumé latéral -->
      <div>
        <div class="bg-white rounded-xl shadow-sm p-6 sticky top-4">
          <h3 class="font-semibold text-sm mb-4">R&eacute;sum&eacute; de la demande</h3>
          <div class="space-y-3 text-sm" id="mission-summary">
            <div class="flex justify-between"><span class="text-gray-400">Client</span><span class="font-medium" id="ms-client">Test Services Inc.</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Service</span><span class="font-medium" id="ms-service">M&eacute;nage</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Adresse</span><span class="font-medium text-right max-w-[160px] truncate" id="ms-address">&mdash;</span></div>
            <div class="flex justify-between"><span class="text-gray-400">P&eacute;riode</span><span class="font-medium" id="ms-period">15-28 f&eacute;v</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Horaire</span><span class="font-medium" id="ms-hours">09:00-17:00</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Travailleurs</span><span class="font-medium" id="ms-workers">2</span></div>
            <div class="border-t pt-3 flex justify-between"><span class="text-gray-400">Taux propos&eacute;</span><span class="font-bold text-enterprise-600" id="ms-rate">22.00$/h</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Budget mensuel</span><span class="font-bold" id="ms-budget">&mdash;</span></div>
          </div>
          <div class="border-t mt-4 pt-4 space-y-2">
            <button onclick="submitMission()" class="w-full py-3 bg-enterprise-600 hover:bg-enterprise-700 text-white font-semibold rounded-xl text-sm shadow-md">Soumettre la demande</button>
            <button onclick="saveMissionDraft()" class="w-full py-2.5 border border-gray-300 text-gray-600 font-medium rounded-xl text-sm hover:bg-gray-50">Enregistrer brouillon</button>
          </div>
          <p class="text-[10px] text-gray-400 mt-3 text-center">En soumettant, votre demande sera envoy&eacute;e au gestionnaire pour &eacute;valuation et attribution.</p>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- ===== CLIENT MISSION DETAIL ===== -->
<div id="view-client-mission-detail" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-enterprise-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-enterprise-100 text-enterprise-700 px-2 py-0.5 rounded-full">Client</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Pierre Durand</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-2 py-3 overflow-x-auto">
    <button onclick="navigate('client')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Dashboard</button>
    <button onclick="navigate('client-missions')" class="px-4 py-2 rounded-lg text-sm font-medium bg-enterprise-600 text-white">Missions</button>
    <button onclick="navigate('client-sites')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Sites de travail</button>
    <button onclick="navigate('client-contracts')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Contrats</button>
    <button onclick="navigate('client-reports')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Rapports</button>
    <button onclick="navigate('client-messaging')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50 relative">Messagerie<span class="client-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">3</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <button onclick="navigate('client-missions')" class="text-sm text-enterprise-600 font-medium mb-4 inline-flex items-center gap-1"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg> Retour</button>
    <div class="flex items-center justify-between mb-6">
      <div><h1 class="text-2xl font-bold" id="md-title">Mission</h1><p class="text-sm text-gray-400 mt-1" id="md-ref">R&eacute;f&eacute;rence</p></div>
      <div class="flex items-center gap-3"><span class="px-3 py-1 text-xs font-bold rounded-full" id="md-status-badge">Statut</span><button onclick="toggleMissionEdit()" id="md-edit-btn" class="px-4 py-2 border border-enterprise-600 text-enterprise-700 text-sm font-medium rounded-lg hover:bg-purple-50 flex items-center gap-2"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>Modifier</button></div>
    </div>
    <div class="grid lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2 space-y-4">
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Informations g&eacute;n&eacute;rales</h3>
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label class="text-xs text-gray-400">Client</label><input id="md-client" class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" readonly></div>
            <div><label class="text-xs text-gray-400">Contact</label><input id="md-contact" class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" readonly></div>
            <div><label class="text-xs text-gray-400">Service</label><input id="md-service" class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" readonly></div>
            <div><label class="text-xs text-gray-400">Adresse</label><input id="md-address" class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" readonly></div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Description de la mission</h3>
          <textarea id="md-description" class="w-full px-3 py-2 border rounded-lg text-sm h-24 resize-none bg-gray-50" readonly></textarea>
        </div>
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Horaires et conditions</h3>
          <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div><label class="text-xs text-gray-400">D&eacute;but</label><input type="date" id="md-start" class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" readonly></div>
            <div><label class="text-xs text-gray-400">Fin</label><input type="date" id="md-end" class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" readonly></div>
            <div><label class="text-xs text-gray-400">Horaire</label><input id="md-hours" class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" readonly></div>
            <div><label class="text-xs text-gray-400">Travailleurs</label><input type="number" id="md-workers" class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" readonly></div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Budget</h3>
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label class="text-xs text-gray-400">Taux horaire propos&eacute;</label><div class="flex items-center gap-2"><input type="number" id="md-rate" class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" readonly step="0.5"><span class="text-sm text-gray-500">$/h</span></div></div>
            <div><label class="text-xs text-gray-400">Budget mensuel</label><div class="flex items-center gap-2"><input type="number" id="md-budget" class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" readonly step="100"><span class="text-sm text-gray-500">$</span></div></div>
          </div>
          <div id="md-cost-note" class="mt-3 hidden"><div class="bg-green-50 border border-green-200 rounded-lg p-3 text-sm text-green-800"><strong>Co&ucirc;t final adopt&eacute; :</strong> <span id="md-final-rate">22.00</span>$/h &mdash; Confirm&eacute; par le gestionnaire</div></div>
        </div>
        <div id="md-save-bar" class="hidden"><button onclick="saveMissionChanges()" class="px-6 py-3 bg-enterprise-600 text-white font-semibold rounded-xl text-sm shadow-md hover:bg-enterprise-700">Enregistrer les modifications</button><button onclick="toggleMissionEdit()" class="ml-3 px-4 py-3 border text-gray-600 rounded-xl text-sm">Annuler</button></div>
      </div>
      <div>
        <div class="bg-white rounded-xl shadow-sm p-5 mb-4">
          <h3 class="font-semibold text-sm mb-3">Suivi de la mission</h3>
          <div class="space-y-3" id="md-timeline">
            <div class="flex gap-3"><div class="w-2 h-2 mt-1.5 bg-enterprise-600 rounded-full flex-shrink-0"></div><div><p class="text-sm font-medium">Demande soumise</p><p class="text-xs text-gray-400" id="md-tl-created">8 f&eacute;v 2026</p></div></div>
            <div class="flex gap-3" id="md-tl-eval"><div class="w-2 h-2 mt-1.5 bg-amber-500 rounded-full flex-shrink-0"></div><div><p class="text-sm font-medium">&Eacute;valuation en cours</p><p class="text-xs text-gray-400">En attente du gestionnaire</p></div></div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
          <div class="p-4 bg-gray-50 border-b font-semibold text-sm">Discussion</div>
          <div id="md-chat" class="h-52 p-3 space-y-2 overflow-y-auto"><p class="text-xs text-gray-400 text-center py-6">La discussion avec le gestionnaire commencera apr&egrave;s soumission.</p></div>
          <div class="p-3 border-t"><div class="flex gap-2"><input id="md-chat-input" class="flex-1 px-3 py-2 border rounded-full text-sm" placeholder="Message..." onkeydown="if(event.key==='Enter')sendMsg('md-chat-input','md-chat','enterprise')"><button onclick="sendMsg('md-chat-input','md-chat','enterprise')" class="px-3 py-2 bg-enterprise-600 text-white rounded-full text-sm">Envoyer</button></div></div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- ===== CLIENT SITES DE TRAVAIL ===== -->
<div id="view-client-sites" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-enterprise-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-enterprise-100 text-enterprise-700 px-2 py-0.5 rounded-full">Client</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Pierre Durand</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-2 py-3 overflow-x-auto">
    <button onclick="navigate('client')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Dashboard</button>
    <button onclick="navigate('client-missions')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Missions</button>
    <button class="px-4 py-2 rounded-lg text-sm font-medium bg-enterprise-600 text-white">Sites de travail</button>
    <button onclick="navigate('client-contracts')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Contrats</button>
    <button onclick="navigate('client-reports')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Rapports</button>
    <button onclick="navigate('client-messaging')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50 relative">Messagerie<span class="client-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">3</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex justify-between items-center mb-6"><h1 class="text-2xl font-bold">Sites de travail</h1><button class="px-4 py-2 bg-enterprise-600 text-white text-sm font-medium rounded-lg">+ Ajouter un site</button></div>
    <div class="mb-6 rounded-xl overflow-hidden shadow-sm" id="client-sites-map" style="height:250px;z-index:1"></div>
    <div class="grid sm:grid-cols-2 gap-4">
      <div class="bg-white rounded-xl shadow-sm p-5 border border-gray-100"><div class="flex items-start gap-3"><div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg></div><div class="flex-1"><h3 class="font-semibold text-gray-900">Si&egrave;ge social</h3><p class="text-sm text-gray-500">500 boul. Ren&eacute;-L&eacute;vesque, Montr&eacute;al</p><p class="text-xs text-gray-400 mt-1">3 missions actives</p></div><button class="text-xs text-enterprise-600 font-medium">Modifier</button></div></div>
      <div class="bg-white rounded-xl shadow-sm p-5 border border-gray-100"><div class="flex items-start gap-3"><div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg></div><div class="flex-1"><h3 class="font-semibold text-gray-900">Entrep&ocirc;t Nord</h3><p class="text-sm text-gray-500">1500 rue Notre-Dame, Montr&eacute;al</p><p class="text-xs text-gray-400 mt-1">1 mission active</p></div><button class="text-xs text-enterprise-600 font-medium">Modifier</button></div></div>
      <div class="bg-white rounded-xl shadow-sm p-5 border border-gray-100"><div class="flex items-start gap-3"><div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg></div><div class="flex-1"><h3 class="font-semibold text-gray-900">Succursale Laval</h3><p class="text-sm text-gray-500">3200 boul. Le Carrefour, Laval</p><p class="text-xs text-gray-400 mt-1">Aucune mission</p></div><button class="text-xs text-enterprise-600 font-medium">Modifier</button></div></div>
      <div class="bg-white rounded-xl shadow-sm p-5 border border-gray-100"><div class="flex items-start gap-3"><div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg></div><div class="flex-1"><h3 class="font-semibold text-gray-900">Bureau Sherbrooke</h3><p class="text-sm text-gray-500">200 rue Sherbrooke, Montr&eacute;al</p><p class="text-xs text-gray-400 mt-1">1 mission (brouillon)</p></div><button class="text-xs text-enterprise-600 font-medium">Modifier</button></div></div>
    </div>
  </main>
</div>

<!-- ===== CLIENT CONTRACTS ===== -->
<div id="view-client-contracts" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-enterprise-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-enterprise-100 text-enterprise-700 px-2 py-0.5 rounded-full">Client</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Pierre Durand</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-2 py-3 overflow-x-auto">
    <button onclick="navigate('client')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Dashboard</button>
    <button onclick="navigate('client-missions')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Missions</button>
    <button onclick="navigate('client-sites')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Sites de travail</button>
    <button class="px-4 py-2 rounded-lg text-sm font-medium bg-enterprise-600 text-white">Contrats</button>
    <button onclick="navigate('client-reports')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Rapports</button>
    <button onclick="navigate('client-messaging')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50 relative">Messagerie<span class="client-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">3</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-2xl font-bold mb-6">Contrats</h1>
    <!-- Établissement 1 -->
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-4"><div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg></div><div><h2 class="text-lg font-bold text-gray-900">Si&egrave;ge social &mdash; 500 boul. Ren&eacute;-L&eacute;vesque</h2><p class="text-xs text-gray-400">Test Services Inc.</p></div></div>
      <div class="grid sm:grid-cols-2 gap-4">
        <div onclick="openContract(0)" class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 hover:shadow-md cursor-pointer transition-shadow">
          <div class="flex items-start gap-4"><div class="w-12 h-14 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="w-7 h-7 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg></div>
          <div class="flex-1"><h3 class="font-semibold text-gray-900 text-sm">Contrat de service &mdash; Nettoyage</h3><p class="text-xs text-gray-400 mt-1">Sign&eacute; le 15 jan. 2026</p><div class="flex items-center gap-2 mt-2"><span class="px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold rounded-full">ACTIF</span><span class="text-xs text-gray-400">Expire : 31 d&eacute;c. 2026</span></div></div></div>
        </div>
        <div onclick="openContract(1)" class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 hover:shadow-md cursor-pointer transition-shadow">
          <div class="flex items-start gap-4"><div class="w-12 h-14 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="w-7 h-7 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg></div>
          <div class="flex-1"><h3 class="font-semibold text-gray-900 text-sm">Contrat de service &mdash; Entretien mensuel</h3><p class="text-xs text-gray-400 mt-1">Sign&eacute; le 1 f&eacute;v. 2026</p><div class="flex items-center gap-2 mt-2"><span class="px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold rounded-full">ACTIF</span><span class="text-xs text-gray-400">Expire : 1 f&eacute;v. 2027</span></div></div></div>
        </div>
      </div>
    </div>
    <!-- Établissement 2 -->
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-4"><div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg></div><div><h2 class="text-lg font-bold text-gray-900">Entrep&ocirc;t Nord &mdash; 1500 rue Notre-Dame</h2><p class="text-xs text-gray-400">Test Services Inc.</p></div></div>
      <div class="grid sm:grid-cols-2 gap-4">
        <div onclick="openContract(2)" class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 hover:shadow-md cursor-pointer transition-shadow">
          <div class="flex items-start gap-4"><div class="w-12 h-14 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="w-7 h-7 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg></div>
          <div class="flex-1"><h3 class="font-semibold text-gray-900 text-sm">Contrat de d&eacute;m&eacute;nagement</h3><p class="text-xs text-gray-400 mt-1">Sign&eacute; le 8 f&eacute;v. 2026</p><div class="flex items-center gap-2 mt-2"><span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-[10px] font-bold rounded-full">EN COURS</span><span class="text-xs text-gray-400">Ponctuel &mdash; 10-12 f&eacute;v.</span></div></div></div>
        </div>
      </div>
    </div>
    <!-- Établissement 3 -->
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-4"><div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg></div><div><h2 class="text-lg font-bold text-gray-900">Succursale Laval &mdash; 3200 boul. Le Carrefour</h2><p class="text-xs text-gray-400">Test Services Inc.</p></div></div>
      <div class="grid sm:grid-cols-2 gap-4">
        <div onclick="openContract(3)" class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 hover:shadow-md cursor-pointer transition-shadow">
          <div class="flex items-start gap-4"><div class="w-12 h-14 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="w-7 h-7 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg></div>
          <div class="flex-1"><h3 class="font-semibold text-gray-900 text-sm">Contrat de service &mdash; Nettoyage hebdo</h3><p class="text-xs text-gray-400 mt-1">Sign&eacute; le 20 jan. 2026</p><div class="flex items-center gap-2 mt-2"><span class="px-2 py-0.5 bg-gray-100 text-gray-600 text-[10px] font-bold rounded-full">TERMIN&Eacute;</span><span class="text-xs text-gray-400">Expir&eacute; le 31 jan. 2026</span></div></div></div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- ===== CLIENT CONTRACT DETAIL (PDF) ===== -->
<div id="view-client-contract-detail" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-enterprise-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-enterprise-100 text-enterprise-700 px-2 py-0.5 rounded-full">Client</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Pierre Durand</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-2 py-3 overflow-x-auto">
    <button onclick="navigate('client')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Dashboard</button>
    <button onclick="navigate('client-missions')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Missions</button>
    <button onclick="navigate('client-sites')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Sites de travail</button>
    <button onclick="navigate('client-contracts')" class="px-4 py-2 rounded-lg text-sm font-medium bg-enterprise-600 text-white">Contrats</button>
    <button onclick="navigate('client-reports')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Rapports</button>
    <button onclick="navigate('client-messaging')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50 relative">Messagerie<span class="client-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">3</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <button onclick="navigate('client-contracts')" class="text-sm text-enterprise-600 font-medium mb-4 inline-flex items-center gap-1"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg> Retour aux contrats</button>
    <div class="flex items-center justify-between mb-6">
      <div><h1 class="text-2xl font-bold" id="contract-title">Contrat de service</h1><p class="text-sm text-gray-500 mt-1" id="contract-subtitle">Si&egrave;ge social</p></div>
      <div class="flex gap-2"><button onclick="alert('T&eacute;l&eacute;chargement du PDF...')" class="px-4 py-2 bg-enterprise-600 text-white text-sm font-medium rounded-lg flex items-center gap-2"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>T&eacute;l&eacute;charger PDF</button></div>
    </div>
    <!-- PDF Preview -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
      <div class="bg-gray-100 px-4 py-2 border-b flex items-center justify-between"><div class="flex items-center gap-2"><svg class="w-5 h-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg><span class="text-sm font-medium text-gray-600" id="contract-pdf-name">contrat-nettoyage-siege.pdf</span></div><span class="text-xs text-gray-400">Page 1 / 3</span></div>
      <div class="p-8 md:p-12 max-w-3xl mx-auto" id="contract-pdf-body" style="min-height:700px; font-family:'Times New Roman',Times,serif; line-height:1.8">
        <div class="text-center mb-8">
          <img src="logo.png" width="64" height="64" alt="Logo" class="mx-auto mb-3">
          <h2 class="text-2xl font-bold" style="font-family:'Times New Roman',Times,serif">PREMIER &Eacute;L&Eacute;MENT</h2>
          <p class="text-sm text-gray-500 mt-1">Services d'entretien et de main-d'&#339;uvre</p>
          <div class="w-24 h-0.5 bg-gray-300 mx-auto mt-4"></div>
        </div>
        <h3 class="text-xl font-bold text-center mb-6" id="contract-doc-title">CONTRAT DE SERVICE DE NETTOYAGE</h3>
        <p class="text-sm mb-1"><strong>R&eacute;f&eacute;rence :</strong> <span id="contract-ref">PE-CTR-2026-0015</span></p>
        <p class="text-sm mb-1"><strong>Date de signature :</strong> <span id="contract-date-signed">15 janvier 2026</span></p>
        <p class="text-sm mb-4"><strong>&Eacute;tablissement :</strong> <span id="contract-establishment">Si&egrave;ge social &mdash; 500 boul. Ren&eacute;-L&eacute;vesque O, Montr&eacute;al, QC H2Z 1Y6</span></p>
        <div class="border-t border-gray-200 my-4"></div>
        <p class="text-sm mb-3"><strong>ENTRE :</strong></p>
        <p class="text-sm mb-1"><strong>Premier &Eacute;l&eacute;ment Inc.</strong>, soci&eacute;t&eacute; de services, dont le si&egrave;ge social est situ&eacute; &agrave; Montr&eacute;al, Qu&eacute;bec (ci-apr&egrave;s &laquo; le Prestataire &raquo;)</p>
        <p class="text-sm mb-3"><strong>ET :</strong></p>
        <p class="text-sm mb-4" id="contract-client-name"><strong>Test Services Inc.</strong>, repr&eacute;sent&eacute; par Pierre Durand (ci-apr&egrave;s &laquo; le Client &raquo;)</p>
        <div class="border-t border-gray-200 my-4"></div>
        <h4 class="font-bold text-sm mb-2">ARTICLE 1 &mdash; OBJET DU CONTRAT</h4>
        <p class="text-sm mb-4" id="contract-art1">Le Prestataire s'engage &agrave; fournir des services de nettoyage commercial r&eacute;gulier &agrave; l'&eacute;tablissement d&eacute;sign&eacute; ci-dessus, selon les modalit&eacute;s d&eacute;finies dans le pr&eacute;sent contrat.</p>
        <h4 class="font-bold text-sm mb-2">ARTICLE 2 &mdash; DUR&Eacute;E</h4>
        <p class="text-sm mb-4" id="contract-art2">Le pr&eacute;sent contrat entre en vigueur le 15 janvier 2026 et prend fin le 31 d&eacute;cembre 2026, renouvelable tacitement pour des p&eacute;riodes de 12 mois.</p>
        <h4 class="font-bold text-sm mb-2">ARTICLE 3 &mdash; CONDITIONS FINANCI&Egrave;RES</h4>
        <p class="text-sm mb-4">Taux horaire : <strong>22,00 $/h</strong> par travailleur. Facturation mensuelle sur pr&eacute;sentation des relev&eacute;s d'heures approuv&eacute;s.</p>
        <h4 class="font-bold text-sm mb-2">ARTICLE 4 &mdash; OBLIGATIONS DES PARTIES</h4>
        <p class="text-sm mb-4">Le Prestataire s'engage &agrave; fournir du personnel qualifi&eacute; et &agrave; garantir la qualit&eacute; des services. Le Client s'engage &agrave; fournir l'acc&egrave;s aux locaux et le mat&eacute;riel n&eacute;cessaire.</p>
        <div class="border-t border-gray-200 my-6"></div>
        <div class="grid grid-cols-2 gap-8 mt-8">
          <div class="text-center"><p class="text-sm font-bold mb-6">Le Prestataire</p><div class="border-b border-gray-400 mx-8 mb-2"></div><p class="text-xs text-gray-500">Premier &Eacute;l&eacute;ment Inc.</p><p class="text-xs text-green-600 font-medium mt-1">&#10003; Sign&eacute; &eacute;lectroniquement</p></div>
          <div class="text-center"><p class="text-sm font-bold mb-6">Le Client</p><div class="border-b border-gray-400 mx-8 mb-2"></div><p class="text-xs text-gray-500" id="contract-signer">Pierre Durand &mdash; Test Services Inc.</p><p class="text-xs text-green-600 font-medium mt-1">&#10003; Sign&eacute; &eacute;lectroniquement</p></div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- ===== CLIENT REPORT DETAIL ===== -->
<div id="view-client-report-detail" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-enterprise-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-enterprise-100 text-enterprise-700 px-2 py-0.5 rounded-full">Client</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Pierre Durand</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-2 py-3 overflow-x-auto">
    <button onclick="navigate('client')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Dashboard</button>
    <button onclick="navigate('client-missions')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Missions</button>
    <button onclick="navigate('client-sites')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Sites de travail</button>
    <button onclick="navigate('client-contracts')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Contrats</button>
    <button onclick="navigate('client-reports')" class="px-4 py-2 rounded-lg text-sm font-medium bg-enterprise-600 text-white">Rapports</button>
    <button onclick="navigate('client-messaging')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50 relative">Messagerie<span class="client-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">3</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <button onclick="navigate('client-reports')" class="text-sm text-enterprise-600 font-medium mb-4 inline-flex items-center gap-1"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg> Retour aux rapports</button>
    <div class="grid lg:grid-cols-3 gap-6">
      <!-- Report content -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-xl shadow-sm p-6" id="report-detail-card">
          <div class="flex justify-between items-start mb-4"><div><h1 class="text-xl font-bold" id="rpt-detail-title">Rapport #RPT-2026-003</h1><p class="text-sm text-gray-400 mt-1" id="rpt-detail-meta">8 f&eacute;v 2026 &bull; 500 boul. Ren&eacute;-L&eacute;vesque O, Montr&eacute;al</p></div><span class="px-3 py-1 text-xs font-bold rounded-full" id="rpt-detail-badge">RAS</span></div>
          <div id="rpt-detail-incident-cat" class="mb-3 hidden"><span class="px-2.5 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-full"></span></div>
          <div class="border-t pt-4 mb-4">
            <h3 class="text-sm font-semibold text-gray-700 mb-2">Contenu du rapport</h3>
            <p class="text-sm text-gray-600 leading-relaxed" id="rpt-detail-body">Le quart du 8 f&eacute;vrier 2026 (09:00 &ndash; 17:00) s'est d&eacute;roul&eacute; de mani&egrave;re conforme. Rien &agrave; d&eacute;clarer.</p>
          </div>
          <div id="rpt-detail-photos" class="mb-4 hidden"><h3 class="text-sm font-semibold text-gray-700 mb-2">Photos jointes</h3><div class="flex gap-2" id="rpt-detail-photos-list"></div></div>
          <div class="border-t pt-4 grid grid-cols-2 gap-4 text-sm">
            <div><span class="text-gray-400 text-xs">Travailleur</span><p class="font-medium" id="rpt-detail-worker">Julie Leblanc</p></div>
            <div><span class="text-gray-400 text-xs">Certifi&eacute; par</span><p class="font-medium" id="rpt-detail-certifier">Admin Gestionnaire</p></div>
            <div><span class="text-gray-400 text-xs">Horaire</span><p class="font-medium" id="rpt-detail-schedule">09:00 &ndash; 17:00</p></div>
            <div><span class="text-gray-400 text-xs">Statut</span><p class="font-medium text-green-600" id="rpt-detail-status">Transmis au client</p></div>
          </div>
        </div>
      </div>
      <!-- Contact sidebar -->
      <div>
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
          <div class="p-4 bg-gray-50 border-b"><h3 class="font-semibold text-sm">Contacter &agrave; propos de ce rapport</h3></div>
          <div class="p-4 space-y-2">
            <button onclick="startReportChat('manager')" class="w-full flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-purple-50 border border-gray-100 text-left">
              <div class="w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center text-sm font-bold text-amber-700">AG</div>
              <div><p class="text-sm font-medium">Gestionnaire</p><p class="text-xs text-gray-400">Admin Gestionnaire</p></div>
            </button>
            <button onclick="startReportChat('worker')" class="w-full flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-purple-50 border border-gray-100 text-left">
              <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-sm font-bold text-green-700" id="rpt-chat-worker-initials">JL</div>
              <div><p class="text-sm font-medium" id="rpt-chat-worker-name">Julie Leblanc</p><p class="text-xs text-gray-400">Travailleur</p></div>
            </button>
          </div>
          <div id="report-chat-area" class="border-t hidden">
            <div class="p-3 bg-gray-50 border-b flex items-center justify-between"><span class="text-sm font-medium" id="report-chat-target">Gestionnaire</span><button onclick="document.getElementById('report-chat-area').classList.add('hidden')" class="text-xs text-gray-400 hover:text-gray-600">Fermer</button></div>
            <div id="report-chat" class="h-48 p-3 space-y-2 overflow-y-auto"></div>
            <div class="p-3 border-t"><div class="flex gap-2"><input id="report-chat-input" class="flex-1 px-3 py-2 border rounded-full text-sm" placeholder="Message..." onkeydown="if(event.key==='Enter')sendMsg('report-chat-input','report-chat','enterprise')"><button onclick="sendMsg('report-chat-input','report-chat','enterprise')" class="px-3 py-2 bg-enterprise-600 text-white rounded-full text-sm">Envoyer</button></div></div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- ===== CLIENT REPORTS ===== -->
<div id="view-client-reports" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-enterprise-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-enterprise-100 text-enterprise-700 px-2 py-0.5 rounded-full">Client</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Pierre Durand</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-2 py-3 overflow-x-auto">
    <button onclick="navigate('client')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Dashboard</button>
    <button onclick="navigate('client-missions')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Missions</button>
    <button onclick="navigate('client-sites')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Sites de travail</button>
    <button onclick="navigate('client-contracts')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Contrats</button>
    <button class="px-4 py-2 rounded-lg text-sm font-medium bg-enterprise-600 text-white">Rapports</button>
    <button onclick="navigate('client-messaging')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50 relative">Messagerie<span class="client-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">3</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-2xl font-bold mb-2">Rapports re&ccedil;us</h1>
    <p class="text-sm text-gray-500 mb-6">Rapports transmis par le gestionnaire de compte</p>
    <div class="flex gap-3 mb-6">
      <span class="px-3 py-1.5 bg-gray-900 text-white text-xs font-medium rounded-full">Tous (3)</span>
      <span class="px-3 py-1.5 bg-green-100 text-green-700 text-xs font-medium rounded-full cursor-pointer">RAS (2)</span>
      <span class="px-3 py-1.5 bg-red-100 text-red-700 text-xs font-medium rounded-full cursor-pointer">Incidents (1)</span>
    </div>
    <div class="space-y-4" id="client-reports-list">
      <div onclick="openClientReport(0)" class="bg-white rounded-xl shadow-sm border-l-4 border-green-500 p-5 hover:shadow-md cursor-pointer transition-shadow">
        <div class="flex justify-between items-start mb-3"><div><h3 class="font-semibold text-gray-900">Rapport #RPT-2026-003</h3><p class="text-xs text-gray-400 mt-1">8 f&eacute;v 2026 &bull; 500 boul. Ren&eacute;-L&eacute;vesque O, Montr&eacute;al</p></div><span class="px-3 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full">RAS</span></div>
        <p class="text-sm text-gray-600 mb-3">Le quart du 8 f&eacute;vrier 2026 (09:00 &ndash; 17:00) s'est d&eacute;roul&eacute; de mani&egrave;re conforme. Rien &agrave; d&eacute;clarer.</p>
        <div class="flex items-center justify-between"><div class="flex items-center gap-4 text-xs text-gray-400"><span>Travailleur : Julie Leblanc</span><span>&bull;</span><span>Certifi&eacute; par : Admin Gestionnaire</span></div><span class="text-xs text-enterprise-600 font-medium">Consulter &rarr;</span></div>
      </div>
      <div onclick="openClientReport(1)" class="bg-white rounded-xl shadow-sm border-l-4 border-red-500 p-5 hover:shadow-md cursor-pointer transition-shadow">
        <div class="flex justify-between items-start mb-3"><div><h3 class="font-semibold text-gray-900">Rapport #RPT-2026-002</h3><p class="text-xs text-gray-400 mt-1">5 f&eacute;v 2026 &bull; 4200 rue Saint-Denis, Montr&eacute;al</p></div><span class="px-3 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-full">Incident</span></div>
        <div class="mb-2"><span class="px-2 py-0.5 bg-amber-100 text-amber-700 text-[10px] font-bold rounded-full">BRIS</span></div>
        <p class="text-sm text-gray-600 mb-3">Lors du d&eacute;m&eacute;nagement, un miroir mural a &eacute;t&eacute; endommag&eacute; dans le couloir du 2e &eacute;tage...</p>
        <div class="flex items-center justify-between"><div class="flex items-center gap-4 text-xs text-gray-400"><span>Travailleur : Marc Tremblay</span><span>&bull;</span><span>Certifi&eacute; par : Admin Gestionnaire</span></div><span class="text-xs text-enterprise-600 font-medium">Consulter &rarr;</span></div>
      </div>
      <div onclick="openClientReport(2)" class="bg-white rounded-xl shadow-sm border-l-4 border-green-500 p-5 hover:shadow-md cursor-pointer transition-shadow">
        <div class="flex justify-between items-start mb-3"><div><h3 class="font-semibold text-gray-900">Rapport #RPT-2026-001</h3><p class="text-xs text-gray-400 mt-1">3 f&eacute;v 2026 &bull; 3000 boul. Le Carrefour, Laval</p></div><span class="px-3 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full">RAS</span></div>
        <p class="text-sm text-gray-600 mb-3">Le quart du 3 f&eacute;vrier 2026 (10:00 &ndash; 14:00) s'est d&eacute;roul&eacute; de mani&egrave;re conforme. Rien &agrave; d&eacute;clarer.</p>
        <div class="flex items-center justify-between"><div class="flex items-center gap-4 text-xs text-gray-400"><span>Travailleur : Sophie Roy</span><span>&bull;</span><span>Certifi&eacute; par : Admin Gestionnaire</span></div><span class="text-xs text-enterprise-600 font-medium">Consulter &rarr;</span></div>
      </div>
    </div>
  </main>
</div>

<!-- ===== CLIENT MESSAGING ===== -->
<div id="view-client-messaging" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-enterprise-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-enterprise-100 text-enterprise-700 px-2 py-0.5 rounded-full">Client</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Pierre Durand</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-2 py-3 overflow-x-auto">
    <button onclick="navigate('client')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Dashboard</button>
    <button onclick="navigate('client-missions')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Missions</button>
    <button onclick="navigate('client-sites')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Sites de travail</button>
    <button onclick="navigate('client-contracts')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Contrats</button>
    <button onclick="navigate('client-reports')" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-purple-50">Rapports</button>
    <button class="px-4 py-2 rounded-lg text-sm font-medium bg-enterprise-600 text-white relative">Messagerie</button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-2xl font-bold mb-6">Messagerie</h1>
    <div class="grid md:grid-cols-3 gap-4" style="min-height:500px">
      <!-- Conversation list -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="p-3 bg-gray-50 border-b font-medium text-sm text-gray-700">Conversations</div>
        <div class="divide-y" id="client-conv-list">
          <div onclick="selectClientConv(0)" data-conv="0" class="p-3 bg-purple-50 border-l-4 border-enterprise-600 cursor-pointer"><div class="flex justify-between"><span class="font-semibold text-sm">Admin Gestionnaire</span><span class="text-xs text-gray-400">10:30</span></div><p class="text-xs text-gray-500 truncate">Bien not&eacute;. Je transmets l'information...</p></div>
          <div onclick="selectClientConv(1)" data-conv="1" class="p-3 hover:bg-gray-50 cursor-pointer"><div class="flex justify-between items-center"><span class="font-semibold text-sm">Julie Leblanc</span><div class="flex items-center gap-1.5"><span class="w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">2</span><span class="text-xs text-gray-400">Hier</span></div></div><p class="text-xs text-gray-500 truncate">Merci pour la confirmation !</p></div>
          <div onclick="selectClientConv(2)" data-conv="2" class="p-3 hover:bg-gray-50 cursor-pointer"><div class="flex justify-between items-center"><span class="font-semibold text-sm">Marc Tremblay</span><div class="flex items-center gap-1.5"><span class="w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">1</span><span class="text-xs text-gray-400">5 f&eacute;v</span></div></div><p class="text-xs text-gray-500 truncate">Je serai l&agrave; &agrave; 7h demain</p></div>
          <div onclick="selectClientConv(3)" data-conv="3" class="p-3 hover:bg-gray-50 cursor-pointer"><div class="flex justify-between"><span class="font-semibold text-sm">Sophie Roy</span><span class="text-xs text-gray-400">3 f&eacute;v</span></div><p class="text-xs text-gray-500 truncate">D'accord, &agrave; lundi !</p></div>
          <div onclick="selectClientConv(4)" data-conv="4" class="p-3 hover:bg-gray-50 cursor-pointer"><div class="flex justify-between"><span class="font-semibold text-sm">Support PE</span><span class="text-xs text-gray-400">1 f&eacute;v</span></div><p class="text-xs text-gray-500 truncate">Comment puis-je vous aider ?</p></div>
        </div>
      </div>
      <!-- Chat area -->
      <div class="md:col-span-2 bg-white rounded-xl shadow-sm border border-gray-100 flex flex-col">
        <div class="p-3 bg-gray-50 border-b flex items-center gap-3">
          <div class="w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center text-sm font-bold text-amber-700" id="client-chat-avatar">AG</div>
          <div><span class="font-medium text-sm" id="client-chat-name">Admin Gestionnaire</span><p class="text-xs text-gray-400" id="client-chat-role">Gestionnaire de compte</p></div>
        </div>
        <div id="client-chat" class="flex-1 p-4 space-y-3 overflow-y-auto">
          <div class="flex justify-start mb-2"><div class="bg-gray-100 rounded-2xl rounded-bl-sm px-4 py-2 max-w-xs"><p class="text-sm">Bonjour Pierre, la mission de vendredi au si&egrave;ge est confirm&eacute;e avec 2 travailleurs.</p><p class="text-xs text-gray-400 mt-1">10:30</p></div></div>
          <div class="flex justify-end mb-2"><div class="bg-enterprise-600 text-white rounded-2xl rounded-br-sm px-4 py-2 max-w-xs"><p class="text-sm">Parfait, merci ! Ils peuvent se stationner au parking P2.</p><p class="text-xs text-purple-200 mt-1">10:32</p></div></div>
          <div class="flex justify-start mb-2"><div class="bg-gray-100 rounded-2xl rounded-bl-sm px-4 py-2 max-w-xs"><p class="text-sm">Bien not&eacute;. Je transmets l'information aux travailleurs.</p><p class="text-xs text-gray-400 mt-1">10:35</p></div></div>
        </div>
        <div class="p-3 border-t"><div class="flex gap-2"><input id="client-msg-input" class="flex-1 px-4 py-2 border rounded-full text-sm" placeholder="&Eacute;crire un message..." onkeydown="if(event.key==='Enter')sendMsg('client-msg-input','client-chat','enterprise')"><button onclick="sendMsg('client-msg-input','client-chat','enterprise')" class="px-4 py-2 bg-enterprise-600 text-white rounded-full text-sm font-medium">Envoyer</button></div></div>
      </div>
    </div>
  </main>
</div>

<!-- ===== MANAGER DASHBOARD ===== -->
<div id="view-manager" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-manager-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-manager-100 text-manager-700 px-2 py-0.5 rounded-full">Gestionnaire</span></div><div class="flex items-center gap-4"><button onclick="navigate('manager-team')" class="text-gray-400 hover:text-manager-600" title="Gestion de l'&eacute;quipe"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg></button><span class="text-sm text-gray-600">Admin Gestionnaire</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-1 py-3 overflow-x-auto">
    <button class="px-3 py-2 rounded-lg text-sm font-medium bg-manager-600 text-white">Dashboard</button>
    <button onclick="navigate('manager-missions')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Missions</button>
    <button onclick="navigate('manager-workers')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Travailleurs</button>
    <button onclick="navigate('manager-validation')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Validation heures</button>
    <button onclick="navigate('manager-clients')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Clients</button>
    <button onclick="navigate('manager-contracts')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Contrats</button>
    <button onclick="navigate('manager-reports')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Rapports</button>
    <button onclick="navigate('manager-messaging')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50 relative">Messagerie<span class="mgr-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">4</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-2xl font-bold text-gray-900 mb-6">Tableau de bord</h1>
    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
      <div onclick="navigate('manager-clients')" class="bg-purple-100 text-purple-700 rounded-xl p-4 cursor-pointer hover:shadow-md"><p class="text-3xl font-bold">8</p><p class="text-sm font-medium mt-1">Clients</p></div>
      <div onclick="navigate('manager-workers')" class="bg-green-100 text-green-700 rounded-xl p-4 cursor-pointer hover:shadow-md"><p class="text-3xl font-bold">24</p><p class="text-sm font-medium mt-1">Travailleurs</p></div>
      <div class="bg-blue-100 text-blue-700 rounded-xl p-4 cursor-pointer hover:shadow-md"><p class="text-3xl font-bold">15</p><p class="text-sm font-medium mt-1">Missions</p></div>
      <div class="bg-amber-100 text-amber-700 rounded-xl p-4 cursor-pointer hover:shadow-md"><p class="text-3xl font-bold">5</p><p class="text-sm font-medium mt-1">Candidatures en attente</p></div>
      <div onclick="navigate('manager-validation')" class="bg-red-100 text-red-700 rounded-xl p-4 cursor-pointer hover:shadow-md"><p class="text-3xl font-bold">3</p><p class="text-sm font-medium mt-1">Heures &agrave; valider</p></div>
      <div onclick="navigate('manager-reports')" class="bg-gray-100 text-gray-700 rounded-xl p-4 cursor-pointer hover:shadow-md"><p class="text-3xl font-bold">2</p><p class="text-sm font-medium mt-1">Rapports</p></div>
    </div>
  </main>
</div>

<!-- ===== MANAGER MISSIONS ===== -->
<div id="view-manager-missions" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-manager-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-manager-100 text-manager-700 px-2 py-0.5 rounded-full">Gestionnaire</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Admin Gestionnaire</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-1 py-3 overflow-x-auto">
    <button onclick="navigate('manager')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Dashboard</button>
    <button class="px-3 py-2 rounded-lg text-sm font-medium bg-manager-600 text-white">Missions</button>
    <button onclick="navigate('manager-workers')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Travailleurs</button>
    <button onclick="navigate('manager-validation')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Validation heures</button>
    <button onclick="navigate('manager-clients')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Clients</button>
    <button onclick="navigate('manager-contracts')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Contrats</button>
    <button onclick="navigate('manager-reports')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Rapports</button>
    <button onclick="navigate('manager-messaging')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50 relative">Messagerie<span class="mgr-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">4</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-2xl font-bold mb-6">Missions re&ccedil;ues</h1>
    <div class="space-y-4" id="mgr-missions-list"></div>
  </main>
</div>

<!-- ===== MANAGER MISSION DETAIL ===== -->
<div id="view-manager-mission-detail" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-manager-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-manager-100 text-manager-700 px-2 py-0.5 rounded-full">Gestionnaire</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Admin Gestionnaire</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-1 py-3 overflow-x-auto">
    <button onclick="navigate('manager')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Dashboard</button>
    <button onclick="navigate('manager-missions')" class="px-3 py-2 rounded-lg text-sm font-medium bg-manager-600 text-white">Missions</button>
    <button onclick="navigate('manager-workers')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Travailleurs</button>
    <button onclick="navigate('manager-validation')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Validation heures</button>
    <button onclick="navigate('manager-clients')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Clients</button>
    <button onclick="navigate('manager-contracts')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Contrats</button>
    <button onclick="navigate('manager-reports')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Rapports</button>
    <button onclick="navigate('manager-messaging')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50 relative">Messagerie<span class="mgr-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">4</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <button onclick="navigate('manager-missions')" class="text-sm text-manager-600 font-medium mb-4 inline-flex items-center gap-1"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg> Retour</button>
    <div class="flex items-center justify-between mb-6">
      <div><h1 class="text-2xl font-bold" id="mmd-title">Mission</h1><p class="text-sm text-gray-400 mt-1" id="mmd-ref">R&eacute;f&eacute;rence</p></div>
      <span class="px-3 py-1 text-xs font-bold rounded-full" id="mmd-status-badge">Statut</span>
    </div>
    <div class="grid lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2 space-y-4">
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Informations client</h3>
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label class="text-xs text-gray-400">Client</label><p class="text-sm font-medium mt-1" id="mmd-client"></p></div>
            <div><label class="text-xs text-gray-400">Contact</label><p class="text-sm font-medium mt-1" id="mmd-contact"></p></div>
            <div><label class="text-xs text-gray-400">T&eacute;l&eacute;phone</label><p class="text-sm font-medium mt-1" id="mmd-phone"></p></div>
            <div><label class="text-xs text-gray-400">Courriel</label><p class="text-sm font-medium mt-1" id="mmd-email"></p></div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">D&eacute;tails de la mission</h3>
          <div class="grid sm:grid-cols-2 gap-4 mb-3">
            <div><label class="text-xs text-gray-400">Service</label><p class="text-sm font-medium mt-1" id="mmd-service"></p></div>
            <div><label class="text-xs text-gray-400">Adresse</label><p class="text-sm font-medium mt-1" id="mmd-address"></p></div>
          </div>
          <div><label class="text-xs text-gray-400">Description</label><p class="text-sm text-gray-700 mt-1" id="mmd-description"></p></div>
        </div>
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Horaires et conditions</h3>
          <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div><label class="text-xs text-gray-400">D&eacute;but</label><p class="text-sm font-medium mt-1" id="mmd-start"></p></div>
            <div><label class="text-xs text-gray-400">Fin</label><p class="text-sm font-medium mt-1" id="mmd-end"></p></div>
            <div><label class="text-xs text-gray-400">Horaire</label><p class="text-sm font-medium mt-1" id="mmd-hours"></p></div>
            <div><label class="text-xs text-gray-400">Travailleurs</label><p class="text-sm font-medium mt-1" id="mmd-workers"></p></div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Budget</h3>
          <div class="grid sm:grid-cols-2 gap-4 mb-4">
            <div><label class="text-xs text-gray-400">Taux propos&eacute; par le client</label><p class="text-sm font-medium mt-1" id="mmd-rate-proposed"></p></div>
            <div><label class="text-xs text-gray-400">Budget mensuel estim&eacute;</label><p class="text-sm font-medium mt-1" id="mmd-budget"></p></div>
          </div>
          <div class="bg-amber-50 border border-amber-200 rounded-lg p-4" id="mmd-eval-section">
            <h4 class="text-sm font-semibold text-amber-800 mb-3">&Eacute;valuation du co&ucirc;t final</h4>
            <div class="flex items-end gap-3">
              <div class="flex-1"><label class="text-xs text-amber-700 mb-1 block">Taux horaire final ($/h)</label><input type="number" id="mmd-final-rate-input" class="w-full px-3 py-2 border border-amber-300 rounded-lg text-sm bg-white" step="0.5" min="15" placeholder="23.50"></div>
              <button onclick="confirmMissionRate()" class="px-5 py-2 bg-amber-600 hover:bg-amber-700 text-white text-sm font-semibold rounded-lg flex-shrink-0">Confirmer le co&ucirc;t</button>
            </div>
          </div>
          <div class="bg-green-50 border border-green-200 rounded-lg p-3 mt-3 hidden" id="mmd-confirmed-rate">
            <p class="text-sm text-green-800"><strong>Co&ucirc;t final confirm&eacute; :</strong> <span id="mmd-final-rate-display">0</span>$/h</p>
          </div>
        </div>
      </div>
      <div>
        <div class="bg-white rounded-xl shadow-sm p-5 mb-4">
          <h3 class="font-semibold text-sm mb-3">Suivi</h3>
          <div class="space-y-3" id="mmd-timeline"></div>
        </div>
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
          <div class="p-4 bg-gray-50 border-b font-semibold text-sm">Discussion avec le client</div>
          <div id="mmd-chat" class="h-52 p-3 space-y-2 overflow-y-auto"><p class="text-xs text-gray-400 text-center py-6">Envoyez un message au client.</p></div>
          <div class="p-3 border-t"><div class="flex gap-2"><input id="mmd-chat-input" class="flex-1 px-3 py-2 border rounded-full text-sm" placeholder="Message au client..." onkeydown="if(event.key==='Enter')sendMsg('mmd-chat-input','mmd-chat','manager')"><button onclick="sendMsg('mmd-chat-input','mmd-chat','manager')" class="px-3 py-2 bg-manager-600 text-white rounded-full text-sm">Envoyer</button></div></div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- ===== MANAGER WORKERS ===== -->
<div id="view-manager-workers" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-manager-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-manager-100 text-manager-700 px-2 py-0.5 rounded-full">Gestionnaire</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Admin Gestionnaire</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-1 py-3 overflow-x-auto">
    <button onclick="navigate('manager')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Dashboard</button>
    <button onclick="navigate('manager-missions')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Missions</button>
    <button class="px-3 py-2 rounded-lg text-sm font-medium bg-manager-600 text-white">Travailleurs</button>
    <button onclick="navigate('manager-validation')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Validation heures</button>
    <button onclick="navigate('manager-clients')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Clients</button>
    <button onclick="navigate('manager-contracts')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Contrats</button>
    <button onclick="navigate('manager-reports')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Rapports</button>
    <button onclick="navigate('manager-messaging')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50 relative">Messagerie<span class="mgr-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">4</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-2xl font-bold mb-4">Travailleurs</h1>
    <div class="mb-4"><input type="text" id="worker-search" oninput="filterWorkers()" class="w-full sm:w-80 px-4 py-2.5 border border-gray-300 rounded-lg text-sm" placeholder="Rechercher par nom..."></div>
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4" id="mgr-workers-grid"></div>
  </main>
</div>

<!-- ===== MANAGER REPORTS ===== -->
<div id="view-manager-reports" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-manager-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-manager-100 text-manager-700 px-2 py-0.5 rounded-full">Gestionnaire</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Admin Gestionnaire</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-1 py-3 overflow-x-auto">
    <button onclick="navigate('manager')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Dashboard</button>
    <button onclick="navigate('manager-missions')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Missions</button>
    <button onclick="navigate('manager-workers')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Travailleurs</button>
    <button onclick="navigate('manager-validation')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Validation heures</button>
    <button onclick="navigate('manager-clients')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Clients</button>
    <button onclick="navigate('manager-contracts')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Contrats</button>
    <button class="px-3 py-2 rounded-lg text-sm font-medium bg-manager-600 text-white">Rapports</button>
    <button onclick="navigate('manager-messaging')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50 relative">Messagerie<span class="mgr-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">4</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-2xl font-bold mb-2">Rapports des travailleurs</h1>
    <p class="text-sm text-gray-500 mb-6">Certifiez et transmettez les rapports au client concern&eacute;</p>
    <div class="flex gap-3 mb-6">
      <span class="px-3 py-1.5 bg-gray-900 text-white text-xs font-medium rounded-full">Tous (4)</span>
      <span class="px-3 py-1.5 bg-green-100 text-green-700 text-xs font-medium rounded-full cursor-pointer">RAS (2)</span>
      <span class="px-3 py-1.5 bg-red-100 text-red-700 text-xs font-medium rounded-full cursor-pointer">Incidents (1)</span>
      <span class="px-3 py-1.5 bg-amber-100 text-amber-700 text-xs font-medium rounded-full cursor-pointer">&Agrave; certifier (1)</span>
    </div>
    <div class="space-y-4">
      <!-- Rapport non certifié -->
      <div onclick="openMgrReport(0)" class="bg-white rounded-xl shadow-sm border-l-4 border-amber-500 p-5 hover:shadow-md cursor-pointer transition-shadow">
        <div class="flex justify-between items-start mb-3"><div><h3 class="font-semibold text-gray-900">Rapport #RPT-2026-004 <span class="ml-2 px-2 py-0.5 bg-amber-100 text-amber-700 text-[10px] font-bold rounded-full animate-pulse">&Agrave; CERTIFIER</span></h3><p class="text-xs text-gray-400 mt-1">8 f&eacute;v 2026 &bull; Sophie Roy &bull; 3000 boul. Le Carrefour, Laval</p></div><span class="px-3 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full">RAS</span></div>
        <p class="text-sm text-gray-600 mb-3">Le quart du 8 f&eacute;vrier 2026 (10:00 &ndash; 14:00) s'est d&eacute;roul&eacute; de mani&egrave;re conforme. Rien &agrave; d&eacute;clarer.</p>
        <div class="text-xs text-gray-400 mb-4">Client : NettoPlus &bull; Destination : Pierre Durand</div>
        <div class="flex gap-3"><button onclick="certifyReport(this)" class="px-5 py-2.5 bg-manager-600 text-white text-sm font-semibold rounded-lg hover:bg-manager-700">Certifier</button><button onclick="transmitReport(this)" class="px-5 py-2.5 border-2 border-manager-600 text-manager-700 text-sm font-semibold rounded-lg hover:bg-amber-50" disabled style="opacity:0.4">Transmettre au client</button></div>
      </div>
      <!-- Rapport certifié, pas encore transmis -->
      <div onclick="openMgrReport(1)" class="bg-white rounded-xl shadow-sm border-l-4 border-green-500 p-5 hover:shadow-md cursor-pointer transition-shadow">
        <div class="flex justify-between items-start mb-3"><div><h3 class="font-semibold text-gray-900">Rapport #RPT-2026-003 <span class="ml-2 px-2 py-0.5 bg-blue-100 text-blue-700 text-[10px] font-bold rounded-full">CERTIFI&Eacute;</span></h3><p class="text-xs text-gray-400 mt-1">8 f&eacute;v 2026 &bull; Julie Leblanc &bull; 500 boul. Ren&eacute;-L&eacute;vesque O</p></div><span class="px-3 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full">RAS</span></div>
        <p class="text-sm text-gray-600 mb-3">Le quart du 8 f&eacute;vrier 2026 (09:00 &ndash; 17:00) s'est d&eacute;roul&eacute; de mani&egrave;re conforme. Rien &agrave; d&eacute;clarer.</p>
        <div class="text-xs text-gray-400 mb-4">Client : ProClean Solutions &bull; Destination : Pierre Durand</div>
        <div class="flex gap-3"><span class="px-4 py-2 bg-green-100 text-green-700 text-sm font-medium rounded-lg">&#10003; Certifi&eacute;</span><button onclick="transmitReport(this)" class="px-5 py-2.5 bg-enterprise-600 text-white text-sm font-semibold rounded-lg hover:bg-enterprise-700">Transmettre au client</button></div>
      </div>
      <!-- Rapport transmis (incident) -->
      <div onclick="openMgrReport(2)" class="bg-white rounded-xl shadow-sm border-l-4 border-red-500 p-5 hover:shadow-md cursor-pointer transition-shadow">
        <div class="flex justify-between items-start mb-3"><div><h3 class="font-semibold text-gray-900">Rapport #RPT-2026-002 <span class="ml-2 px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold rounded-full">TRANSMIS</span></h3><p class="text-xs text-gray-400 mt-1">5 f&eacute;v 2026 &bull; Marc Tremblay &bull; 4200 rue Saint-Denis</p></div><span class="px-3 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-full">Incident</span></div>
        <div class="mb-2"><span class="px-2 py-0.5 bg-amber-100 text-amber-700 text-[10px] font-bold rounded-full">BRIS</span></div>
        <p class="text-sm text-gray-600 mb-3">Miroir mural endommag&eacute; dans le couloir du 2e &eacute;tage lors du d&eacute;placement d'un meuble.</p>
        <div class="flex gap-2 mb-3"><div class="w-14 h-14 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400 text-[10px]">Photo 1</div><div class="w-14 h-14 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400 text-[10px]">Photo 2</div></div>
        <div class="flex gap-3"><span class="px-4 py-2 bg-green-100 text-green-700 text-sm font-medium rounded-lg">&#10003; Transmis &agrave; Pierre Durand</span></div>
      </div>
      <!-- Rapport transmis (RAS) -->
      <div onclick="openMgrReport(3)" class="bg-white rounded-xl shadow-sm border-l-4 border-green-500 p-5 hover:shadow-md cursor-pointer transition-shadow">
        <div class="flex justify-between items-start mb-3"><div><h3 class="font-semibold text-gray-900">Rapport #RPT-2026-001 <span class="ml-2 px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold rounded-full">TRANSMIS</span></h3><p class="text-xs text-gray-400 mt-1">3 f&eacute;v 2026 &bull; Sophie Roy &bull; 3000 boul. Le Carrefour, Laval</p></div><span class="px-3 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full">RAS</span></div>
        <p class="text-sm text-gray-600 mb-3">Le quart du 3 f&eacute;vrier 2026 s'est d&eacute;roul&eacute; de mani&egrave;re conforme.</p>
        <div class="flex gap-3"><span class="px-4 py-2 bg-green-100 text-green-700 text-sm font-medium rounded-lg">&#10003; Transmis &agrave; Pierre Durand</span></div>
      </div>
    </div>
  </main>
</div>

<!-- ===== MANAGER CONTRACTS ===== -->
<div id="view-manager-contracts" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-manager-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-manager-100 text-manager-700 px-2 py-0.5 rounded-full">Gestionnaire</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Admin Gestionnaire</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-1 py-3 overflow-x-auto">
    <button onclick="navigate('manager')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Dashboard</button>
    <button onclick="navigate('manager-missions')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Missions</button>
    <button onclick="navigate('manager-workers')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Travailleurs</button>
    <button onclick="navigate('manager-validation')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Validation heures</button>
    <button onclick="navigate('manager-clients')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Clients</button>
    <button class="px-3 py-2 rounded-lg text-sm font-medium bg-manager-600 text-white">Contrats</button>
    <button onclick="navigate('manager-reports')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Rapports</button>
    <button onclick="navigate('manager-messaging')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50 relative">Messagerie<span class="mgr-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">4</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-2xl font-bold mb-6">Contrats</h1>
    <!-- Client 1 : Test Services Inc. -->
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-4"><div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg></div><div><h2 class="text-lg font-bold text-gray-900">Test Services Inc.</h2><p class="text-xs text-gray-400">Client : Pierre Durand &bull; 3 contrats</p></div></div>
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <div onclick="openMgrContract(0)" class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 hover:shadow-md cursor-pointer transition-shadow">
          <div class="flex items-start gap-3"><div class="w-10 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="w-6 h-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg></div>
          <div class="flex-1"><h3 class="font-semibold text-gray-900 text-sm">Nettoyage &mdash; Si&egrave;ge social</h3><p class="text-xs text-gray-400 mt-1">Sign&eacute; le 15 jan. 2026</p><span class="px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold rounded-full mt-2 inline-block">ACTIF</span></div></div>
        </div>
        <div onclick="openMgrContract(1)" class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 hover:shadow-md cursor-pointer transition-shadow">
          <div class="flex items-start gap-3"><div class="w-10 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="w-6 h-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg></div>
          <div class="flex-1"><h3 class="font-semibold text-gray-900 text-sm">Entretien mensuel &mdash; Si&egrave;ge</h3><p class="text-xs text-gray-400 mt-1">Sign&eacute; le 1 f&eacute;v. 2026</p><span class="px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold rounded-full mt-2 inline-block">ACTIF</span></div></div>
        </div>
        <div onclick="openMgrContract(2)" class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 hover:shadow-md cursor-pointer transition-shadow">
          <div class="flex items-start gap-3"><div class="w-10 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="w-6 h-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg></div>
          <div class="flex-1"><h3 class="font-semibold text-gray-900 text-sm">D&eacute;m&eacute;nagement &mdash; Entrep&ocirc;t Nord</h3><p class="text-xs text-gray-400 mt-1">Sign&eacute; le 8 f&eacute;v. 2026</p><span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-[10px] font-bold rounded-full mt-2 inline-block">EN COURS</span></div></div>
        </div>
      </div>
    </div>
    <!-- Client 2 : NettoPlus -->
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-4"><div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg></div><div><h2 class="text-lg font-bold text-gray-900">NettoPlus</h2><p class="text-xs text-gray-400">Client : Marie Martin &bull; 1 contrat</p></div></div>
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <div onclick="openMgrContract(3)" class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 hover:shadow-md cursor-pointer transition-shadow">
          <div class="flex items-start gap-3"><div class="w-10 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="w-6 h-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg></div>
          <div class="flex-1"><h3 class="font-semibold text-gray-900 text-sm">Nettoyage &mdash; Succursale Laval</h3><p class="text-xs text-gray-400 mt-1">Sign&eacute; le 20 jan. 2026</p><span class="px-2 py-0.5 bg-gray-100 text-gray-600 text-[10px] font-bold rounded-full mt-2 inline-block">TERMIN&Eacute;</span></div></div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- ===== MANAGER CONTRACT DETAIL ===== -->
<div id="view-manager-contract-detail" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-manager-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-manager-100 text-manager-700 px-2 py-0.5 rounded-full">Gestionnaire</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Admin Gestionnaire</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-1 py-3 overflow-x-auto">
    <button onclick="navigate('manager')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Dashboard</button>
    <button onclick="navigate('manager-missions')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Missions</button>
    <button onclick="navigate('manager-workers')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Travailleurs</button>
    <button onclick="navigate('manager-validation')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Validation heures</button>
    <button onclick="navigate('manager-clients')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Clients</button>
    <button onclick="navigate('manager-contracts')" class="px-3 py-2 rounded-lg text-sm font-medium bg-manager-600 text-white">Contrats</button>
    <button onclick="navigate('manager-reports')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Rapports</button>
    <button onclick="navigate('manager-messaging')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50 relative">Messagerie<span class="mgr-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">4</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <button onclick="navigate('manager-contracts')" class="text-sm text-manager-600 font-medium mb-4 inline-flex items-center gap-1"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg> Retour aux contrats</button>
    <div class="flex items-center justify-between mb-6">
      <div><h1 class="text-2xl font-bold" id="mgr-ctr-title">Contrat de service</h1><p class="text-sm text-gray-500 mt-1" id="mgr-ctr-subtitle">Client</p></div>
      <button onclick="alert('T\u00e9l\u00e9chargement du PDF...')" class="px-4 py-2 bg-manager-600 text-white text-sm font-medium rounded-lg flex items-center gap-2"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>PDF</button>
    </div>
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
      <div class="bg-gray-100 px-4 py-2 border-b flex items-center justify-between"><div class="flex items-center gap-2"><svg class="w-5 h-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg><span class="text-sm font-medium text-gray-600" id="mgr-ctr-pdf-name">contrat.pdf</span></div><span class="text-xs text-gray-400">Page 1 / 3</span></div>
      <div class="p-8 md:p-12 max-w-3xl mx-auto" id="mgr-ctr-pdf-body" style="min-height:700px; font-family:'Times New Roman',Times,serif; line-height:1.8">
        <div class="text-center mb-8"><img src="logo.png" width="64" height="64" alt="Logo" class="mx-auto mb-3"><h2 class="text-2xl font-bold" style="font-family:'Times New Roman',Times,serif">PREMIER &Eacute;L&Eacute;MENT</h2><p class="text-sm text-gray-500 mt-1">Services d'entretien et de main-d'&#339;uvre</p><div class="w-24 h-0.5 bg-gray-300 mx-auto mt-4"></div></div>
        <h3 class="text-xl font-bold text-center mb-6" id="mgr-ctr-doc-title">CONTRAT DE SERVICE</h3>
        <p class="text-sm mb-1"><strong>R&eacute;f&eacute;rence :</strong> <span id="mgr-ctr-ref">PE-CTR-2026-0015</span></p>
        <p class="text-sm mb-1"><strong>Date de signature :</strong> <span id="mgr-ctr-date">15 janvier 2026</span></p>
        <p class="text-sm mb-4"><strong>&Eacute;tablissement :</strong> <span id="mgr-ctr-estab">Si&egrave;ge social</span></p>
        <div class="border-t border-gray-200 my-4"></div>
        <p class="text-sm mb-3"><strong>ENTRE :</strong></p>
        <p class="text-sm mb-1"><strong>Premier &Eacute;l&eacute;ment Inc.</strong> (ci-apr&egrave;s &laquo; le Prestataire &raquo;)</p>
        <p class="text-sm mb-3"><strong>ET :</strong></p>
        <p class="text-sm mb-4" id="mgr-ctr-client"><strong>Test Services Inc.</strong>, repr&eacute;sent&eacute; par Pierre Durand (ci-apr&egrave;s &laquo; le Client &raquo;)</p>
        <div class="border-t border-gray-200 my-4"></div>
        <h4 class="font-bold text-sm mb-2">ARTICLE 1 &mdash; OBJET DU CONTRAT</h4>
        <p class="text-sm mb-4" id="mgr-ctr-art1">Le Prestataire s'engage &agrave; fournir des services conform&eacute;ment aux termes du pr&eacute;sent contrat.</p>
        <h4 class="font-bold text-sm mb-2">ARTICLE 2 &mdash; DUR&Eacute;E</h4>
        <p class="text-sm mb-4" id="mgr-ctr-art2">Du 15 janvier 2026 au 31 d&eacute;cembre 2026.</p>
        <h4 class="font-bold text-sm mb-2">ARTICLE 3 &mdash; CONDITIONS FINANCI&Egrave;RES</h4>
        <p class="text-sm mb-4" id="mgr-ctr-art3">Taux horaire : 22,00 $/h par travailleur.</p>
        <div class="border-t border-gray-200 my-6"></div>
        <div class="grid grid-cols-2 gap-8 mt-8"><div class="text-center"><p class="text-sm font-bold mb-6">Le Prestataire</p><div class="border-b border-gray-400 mx-8 mb-2"></div><p class="text-xs text-gray-500">Premier &Eacute;l&eacute;ment Inc.</p><p class="text-xs text-green-600 font-medium mt-1">&#10003; Sign&eacute; &eacute;lectroniquement</p></div><div class="text-center"><p class="text-sm font-bold mb-6">Le Client</p><div class="border-b border-gray-400 mx-8 mb-2"></div><p class="text-xs text-gray-500" id="mgr-ctr-signer">Pierre Durand</p><p class="text-xs text-green-600 font-medium mt-1">&#10003; Sign&eacute; &eacute;lectroniquement</p></div></div>
      </div>
    </div>
  </main>
</div>

<!-- ===== MANAGER REPORT DETAIL ===== -->
<div id="view-manager-report-detail" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-manager-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-manager-100 text-manager-700 px-2 py-0.5 rounded-full">Gestionnaire</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Admin Gestionnaire</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-1 py-3 overflow-x-auto">
    <button onclick="navigate('manager')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Dashboard</button>
    <button onclick="navigate('manager-missions')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Missions</button>
    <button onclick="navigate('manager-workers')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Travailleurs</button>
    <button onclick="navigate('manager-validation')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Validation heures</button>
    <button onclick="navigate('manager-clients')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Clients</button>
    <button onclick="navigate('manager-contracts')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Contrats</button>
    <button onclick="navigate('manager-reports')" class="px-3 py-2 rounded-lg text-sm font-medium bg-manager-600 text-white">Rapports</button>
    <button onclick="navigate('manager-messaging')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50 relative">Messagerie<span class="mgr-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">4</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <button onclick="navigate('manager-reports')" class="text-sm text-manager-600 font-medium mb-4 inline-flex items-center gap-1"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg> Retour aux rapports</button>
    <div class="grid lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2">
        <div class="bg-white rounded-xl shadow-sm p-6" id="mgr-rpt-card">
          <div class="flex justify-between items-start mb-4"><div><h1 class="text-xl font-bold" id="mgr-rpt-title">Rapport</h1><p class="text-sm text-gray-400 mt-1" id="mgr-rpt-meta">info</p></div><span class="px-3 py-1 text-xs font-bold rounded-full" id="mgr-rpt-badge">RAS</span></div>
          <div id="mgr-rpt-incident-cat" class="mb-3 hidden"><span class="px-2.5 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-full"></span></div>
          <div class="border-t pt-4 mb-4"><h3 class="text-sm font-semibold text-gray-700 mb-2">Contenu du rapport</h3><p class="text-sm text-gray-600 leading-relaxed" id="mgr-rpt-body"></p></div>
          <div id="mgr-rpt-photos" class="mb-4 hidden"><h3 class="text-sm font-semibold text-gray-700 mb-2">Photos</h3><div class="flex gap-2" id="mgr-rpt-photos-list"></div></div>
          <div class="border-t pt-4 grid grid-cols-2 gap-4 text-sm">
            <div><span class="text-gray-400 text-xs">Travailleur</span><p class="font-medium" id="mgr-rpt-worker"></p></div>
            <div><span class="text-gray-400 text-xs">Client destination</span><p class="font-medium" id="mgr-rpt-client"></p></div>
            <div><span class="text-gray-400 text-xs">Horaire</span><p class="font-medium" id="mgr-rpt-schedule"></p></div>
            <div><span class="text-gray-400 text-xs">Statut</span><p class="font-medium" id="mgr-rpt-status"></p></div>
          </div>
          <div class="border-t mt-4 pt-4 flex gap-3" id="mgr-rpt-actions"></div>
        </div>
      </div>
      <div>
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
          <div class="p-4 bg-gray-50 border-b"><h3 class="font-semibold text-sm">Contacter</h3></div>
          <div class="p-4 space-y-2">
            <button onclick="startMgrReportChat('client')" class="w-full flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-amber-50 border border-gray-100 text-left"><div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-sm font-bold text-purple-700" id="mgr-rpt-client-init">PD</div><div><p class="text-sm font-medium" id="mgr-rpt-client-name2">Pierre Durand</p><p class="text-xs text-gray-400">Client</p></div></button>
            <button onclick="startMgrReportChat('worker')" class="w-full flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-amber-50 border border-gray-100 text-left"><div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-sm font-bold text-green-700" id="mgr-rpt-worker-init">JL</div><div><p class="text-sm font-medium" id="mgr-rpt-worker-name2">Julie Leblanc</p><p class="text-xs text-gray-400">Travailleur</p></div></button>
          </div>
          <div id="mgr-report-chat-area" class="border-t hidden">
            <div class="p-3 bg-gray-50 border-b flex items-center justify-between"><span class="text-sm font-medium" id="mgr-report-chat-target">Contact</span><button onclick="document.getElementById('mgr-report-chat-area').classList.add('hidden')" class="text-xs text-gray-400 hover:text-gray-600">Fermer</button></div>
            <div id="mgr-report-chat" class="h-48 p-3 space-y-2 overflow-y-auto"></div>
            <div class="p-3 border-t"><div class="flex gap-2"><input id="mgr-report-chat-input" class="flex-1 px-3 py-2 border rounded-full text-sm" placeholder="Message..." onkeydown="if(event.key==='Enter')sendMsg('mgr-report-chat-input','mgr-report-chat','manager')"><button onclick="sendMsg('mgr-report-chat-input','mgr-report-chat','manager')" class="px-3 py-2 bg-manager-600 text-white rounded-full text-sm">Envoyer</button></div></div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- ===== MANAGER MESSAGING ===== -->
<div id="view-manager-messaging" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-manager-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-manager-100 text-manager-700 px-2 py-0.5 rounded-full">Gestionnaire</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Admin Gestionnaire</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-1 py-3 overflow-x-auto">
    <button onclick="navigate('manager')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Dashboard</button>
    <button onclick="navigate('manager-missions')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Missions</button>
    <button onclick="navigate('manager-workers')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Travailleurs</button>
    <button onclick="navigate('manager-validation')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Validation heures</button>
    <button onclick="navigate('manager-clients')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Clients</button>
    <button onclick="navigate('manager-contracts')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Contrats</button>
    <button onclick="navigate('manager-reports')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Rapports</button>
    <button class="px-3 py-2 rounded-lg text-sm font-medium bg-manager-600 text-white">Messagerie</button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-2xl font-bold mb-6">Messagerie</h1>
    <div class="grid md:grid-cols-3 gap-4" style="min-height:500px">
      <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
        <div class="p-3 bg-gray-50 border-b font-medium text-sm">Conversations</div>
        <div class="divide-y" id="mgr-conv-list">
          <div onclick="selectMgrConv(0)" data-conv="0" class="p-3 bg-amber-50 border-l-4 border-manager-600 cursor-pointer"><div class="flex justify-between"><span class="font-semibold text-sm">Pierre Durand</span><span class="text-xs text-gray-400">10:35</span></div><p class="text-xs text-gray-500 truncate">Bien not&eacute;. Je transmets l'info...</p></div>
          <div onclick="selectMgrConv(1)" data-conv="1" class="p-3 hover:bg-gray-50 cursor-pointer"><div class="flex justify-between items-center"><span class="font-semibold text-sm">Julie Leblanc</span><div class="flex items-center gap-1.5"><span class="w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">2</span><span class="text-xs text-gray-400">09:00</span></div></div><p class="text-xs text-gray-500 truncate">OK je serai l&agrave; &agrave; 9h</p></div>
          <div onclick="selectMgrConv(2)" data-conv="2" class="p-3 hover:bg-gray-50 cursor-pointer"><div class="flex justify-between items-center"><span class="font-semibold text-sm">Marc Tremblay</span><div class="flex items-center gap-1.5"><span class="w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">1</span><span class="text-xs text-gray-400">Hier</span></div></div><p class="text-xs text-gray-500 truncate">D&eacute;sol&eacute; pour le retard</p></div>
          <div onclick="selectMgrConv(3)" data-conv="3" class="p-3 hover:bg-gray-50 cursor-pointer"><div class="flex justify-between"><span class="font-semibold text-sm">Sophie Roy</span><span class="text-xs text-gray-400">3 f&eacute;v</span></div><p class="text-xs text-gray-500 truncate">Merci, &agrave; la semaine prochaine !</p></div>
          <div onclick="selectMgrConv(4)" data-conv="4" class="p-3 hover:bg-gray-50 cursor-pointer"><div class="flex justify-between items-center"><span class="font-semibold text-sm">Marie Martin</span><div class="flex items-center gap-1.5"><span class="w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">1</span><span class="text-xs text-gray-400">2 f&eacute;v</span></div></div><p class="text-xs text-gray-500 truncate">Pouvez-vous me rappeler ?</p></div>
        </div>
      </div>
      <div class="md:col-span-2 bg-white rounded-xl shadow-sm border flex flex-col">
        <div class="p-3 bg-gray-50 border-b flex items-center gap-3">
          <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-sm font-bold text-purple-700" id="mgr-chat-avatar">PD</div>
          <div><span class="font-medium text-sm" id="mgr-chat-name">Pierre Durand</span><p class="text-xs text-gray-400" id="mgr-chat-role">Client &mdash; Test Services Inc.</p></div>
        </div>
        <div id="manager-chat" class="flex-1 p-4 space-y-3 overflow-y-auto">
          <div class="flex justify-end mb-2"><div class="bg-manager-600 text-white rounded-2xl rounded-br-sm px-4 py-2 max-w-xs"><p class="text-sm">La mission de vendredi au si&egrave;ge est confirm&eacute;e avec 2 travailleurs.</p><p class="text-xs text-amber-200 mt-1">10:30</p></div></div>
          <div class="flex justify-start mb-2"><div class="bg-gray-100 rounded-2xl rounded-bl-sm px-4 py-2 max-w-xs"><p class="text-sm">Parfait ! Parking P2 disponible.</p><p class="text-xs text-gray-400 mt-1">10:32</p></div></div>
          <div class="flex justify-end mb-2"><div class="bg-manager-600 text-white rounded-2xl rounded-br-sm px-4 py-2 max-w-xs"><p class="text-sm">Bien not&eacute;. Je transmets l'information aux travailleurs.</p><p class="text-xs text-amber-200 mt-1">10:35</p></div></div>
        </div>
        <div class="p-3 border-t"><div class="flex gap-2"><input id="manager-msg-input" class="flex-1 px-4 py-2 border rounded-full text-sm" placeholder="&Eacute;crire un message..." onkeydown="if(event.key==='Enter')sendMsg('manager-msg-input','manager-chat','manager')"><button onclick="sendMsg('manager-msg-input','manager-chat','manager')" class="px-4 py-2 bg-manager-600 text-white rounded-full text-sm font-medium">Envoyer</button></div></div>
      </div>
    </div>
  </main>
</div>

<!-- ===== MANAGER VALIDATION ===== -->
<div id="view-manager-validation" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-manager-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-manager-100 text-manager-700 px-2 py-0.5 rounded-full">Gestionnaire</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Admin Gestionnaire</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-1 py-3 overflow-x-auto">
    <button onclick="navigate('manager')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Dashboard</button>
    <button onclick="navigate('manager-missions')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Missions</button>
    <button onclick="navigate('manager-workers')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Travailleurs</button>
    <button class="px-3 py-2 rounded-lg text-sm font-medium bg-manager-600 text-white">Validation heures</button>
    <button onclick="navigate('manager-clients')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Clients</button>
    <button onclick="navigate('manager-contracts')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Contrats</button>
    <button onclick="navigate('manager-reports')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Rapports</button>
    <button onclick="navigate('manager-messaging')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50 relative">Messagerie<span class="mgr-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">4</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-2xl font-bold mb-6">Validation des heures</h1>
    <div class="flex bg-gray-100 rounded-lg p-1 mb-6 max-w-md">
      <button onclick="setValidationTab('timesheets')" id="vtab-timesheets" class="flex-1 py-2 text-sm font-medium rounded-md bg-white text-manager-600 shadow-sm">Feuilles de temps</button>
      <button onclick="setValidationTab('assignments')" id="vtab-assignments" class="flex-1 py-2 text-sm font-medium rounded-md text-gray-500">Assignations</button>
    </div>
    <div id="validation-timesheets-panel">
      <div class="flex gap-2 mb-4">
        <button onclick="renderTimesheets('all')" class="ts-filter px-3 py-1.5 bg-gray-900 text-white text-xs font-medium rounded-full">Tous</button>
        <button onclick="renderTimesheets('pending')" class="ts-filter px-3 py-1.5 bg-amber-100 text-amber-700 text-xs font-medium rounded-full cursor-pointer">En attente</button>
        <button onclick="renderTimesheets('approved')" class="ts-filter px-3 py-1.5 bg-green-100 text-green-700 text-xs font-medium rounded-full cursor-pointer">Approuv&eacute;s</button>
        <button onclick="renderTimesheets('rejected')" class="ts-filter px-3 py-1.5 bg-red-100 text-red-700 text-xs font-medium rounded-full cursor-pointer">Refus&eacute;s</button>
      </div>
      <div class="space-y-3" id="timesheets-list"></div>
    </div>
    <div id="validation-assignments-panel" class="hidden">
      <div class="space-y-4" id="assignments-list"></div>
    </div>
  </main>
</div>

<!-- ===== MANAGER CLIENTS ===== -->
<div id="view-manager-clients" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-manager-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-manager-100 text-manager-700 px-2 py-0.5 rounded-full">Gestionnaire</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Admin Gestionnaire</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-1 py-3 overflow-x-auto">
    <button onclick="navigate('manager')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Dashboard</button>
    <button onclick="navigate('manager-missions')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Missions</button>
    <button onclick="navigate('manager-workers')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Travailleurs</button>
    <button onclick="navigate('manager-validation')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Validation heures</button>
    <button class="px-3 py-2 rounded-lg text-sm font-medium bg-manager-600 text-white">Clients</button>
    <button onclick="navigate('manager-contracts')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Contrats</button>
    <button onclick="navigate('manager-reports')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Rapports</button>
    <button onclick="navigate('manager-messaging')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50 relative">Messagerie<span class="mgr-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">4</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-2xl font-bold mb-6">Clients</h1>
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4" id="mgr-clients-grid"></div>
  </main>
</div>

<!-- ===== MANAGER CLIENT DETAIL ===== -->
<div id="view-manager-client-detail" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-manager-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-manager-100 text-manager-700 px-2 py-0.5 rounded-full">Gestionnaire</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Admin Gestionnaire</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-1 py-3 overflow-x-auto">
    <button onclick="navigate('manager')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Dashboard</button>
    <button onclick="navigate('manager-missions')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Missions</button>
    <button onclick="navigate('manager-workers')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Travailleurs</button>
    <button onclick="navigate('manager-validation')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Validation heures</button>
    <button onclick="navigate('manager-clients')" class="px-3 py-2 rounded-lg text-sm font-medium bg-manager-600 text-white">Clients</button>
    <button onclick="navigate('manager-contracts')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Contrats</button>
    <button onclick="navigate('manager-reports')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Rapports</button>
    <button onclick="navigate('manager-messaging')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50 relative">Messagerie<span class="mgr-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">4</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <button onclick="navigate('manager-clients')" class="text-sm text-manager-600 font-medium mb-4 inline-flex items-center gap-1"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg> Retour aux clients</button>
    <div class="grid lg:grid-cols-3 gap-6" id="client-detail-content"></div>
  </main>
</div>

<!-- ===== MANAGER WORKER DETAIL ===== -->
<div id="view-manager-worker-detail" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-manager-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-manager-100 text-manager-700 px-2 py-0.5 rounded-full">Gestionnaire</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Admin Gestionnaire</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-1 py-3 overflow-x-auto">
    <button onclick="navigate('manager')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Dashboard</button>
    <button onclick="navigate('manager-missions')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Missions</button>
    <button onclick="navigate('manager-workers')" class="px-3 py-2 rounded-lg text-sm font-medium bg-manager-600 text-white">Travailleurs</button>
    <button onclick="navigate('manager-validation')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Validation heures</button>
    <button onclick="navigate('manager-clients')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Clients</button>
    <button onclick="navigate('manager-contracts')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Contrats</button>
    <button onclick="navigate('manager-reports')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Rapports</button>
    <button onclick="navigate('manager-messaging')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50 relative">Messagerie<span class="mgr-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">4</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <button onclick="navigate('manager-workers')" class="text-sm text-manager-600 font-medium mb-4 inline-flex items-center gap-1"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg> Retour aux travailleurs</button>
    <div id="worker-detail-content"></div>
  </main>
</div>

<!-- ===== MANAGER TEAM ===== -->
<div id="view-manager-team" class="view">
  <header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center gap-2"><img src="logo.png" width="30" height="30" alt="Logo" class="flex-shrink-0"><span class="text-xl font-bold text-manager-600">Premier &Eacute;l&eacute;ment</span><span class="text-xs bg-manager-100 text-manager-700 px-2 py-0.5 rounded-full">Gestionnaire</span></div><div class="flex items-center gap-4"><span class="text-sm text-gray-600">Admin Gestionnaire</span><button onclick="logoutUser()" class="text-sm text-red-600 font-medium">D&eacute;connexion</button></div></div></div></header>
  <nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex gap-1 py-3 overflow-x-auto">
    <button onclick="navigate('manager')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Dashboard</button>
    <button onclick="navigate('manager-missions')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Missions</button>
    <button onclick="navigate('manager-workers')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Travailleurs</button>
    <button onclick="navigate('manager-validation')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Validation heures</button>
    <button onclick="navigate('manager-clients')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Clients</button>
    <button onclick="navigate('manager-contracts')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Contrats</button>
    <button onclick="navigate('manager-reports')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50">Rapports</button>
    <button onclick="navigate('manager-messaging')" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-amber-50 relative">Messagerie<span class="mgr-msg-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center">4</span></button>
  </div></div></nav>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold">Gestion de l'&eacute;quipe</h1>
      <button onclick="showInviteManagerForm()" class="px-4 py-2 bg-manager-600 text-white text-sm font-medium rounded-lg hover:bg-manager-700">+ Inviter un gestionnaire</button>
    </div>
    <div id="invite-manager-form" class="hidden mb-6 bg-amber-50 border border-amber-200 rounded-xl p-6">
      <h3 class="font-semibold text-amber-800 mb-4">Inviter un nouveau gestionnaire</h3>
      <div class="grid sm:grid-cols-2 gap-4 mb-4">
        <div><label class="block text-sm font-medium text-gray-700 mb-1">Nom complet</label><input id="invite-name" type="text" class="w-full px-3 py-2 border rounded-lg text-sm" placeholder="Pr&eacute;nom Nom"></div>
        <div><label class="block text-sm font-medium text-gray-700 mb-1">Courriel</label><input id="invite-email" type="email" class="w-full px-3 py-2 border rounded-lg text-sm" placeholder="email@exemple.com"></div>
        <div><label class="block text-sm font-medium text-gray-700 mb-1">T&eacute;l&eacute;phone</label><input id="invite-phone" type="tel" class="w-full px-3 py-2 border rounded-lg text-sm" placeholder="514-555-0000"></div>
        <div><label class="block text-sm font-medium text-gray-700 mb-1">M&eacute;thode d'envoi</label>
          <div class="flex bg-gray-100 rounded-lg p-1"><button onclick="setInviteMethod('email')" id="invite-method-email" class="flex-1 py-1.5 text-xs font-medium rounded-md bg-white text-manager-600 shadow-sm">Courriel</button><button onclick="setInviteMethod('sms')" id="invite-method-sms" class="flex-1 py-1.5 text-xs font-medium rounded-md text-gray-500">SMS</button></div>
        </div>
      </div>
      <div class="flex gap-3"><button onclick="submitInviteManager()" class="px-5 py-2 bg-manager-600 text-white text-sm font-semibold rounded-lg hover:bg-manager-700">Envoyer l'invitation</button><button onclick="hideInviteManagerForm()" class="px-5 py-2 border border-gray-300 text-gray-600 text-sm font-medium rounded-lg hover:bg-gray-50">Annuler</button></div>
      <div id="invite-success" class="hidden mt-4 p-3 bg-green-50 border border-green-200 rounded-lg"><p class="text-sm text-green-700" id="invite-success-msg"></p></div>
    </div>
    <div class="space-y-3" id="team-members-list"></div>
  </main>
</div>

<!-- ===== WORKER BOTTOM NAV HELPER (reused via JS) ===== -->
<!-- ===== WORKER SHIFTS LIST ===== -->
<div id="view-worker-shifts" class="view">
  <div class="min-h-screen bg-gray-50 pb-20">
    <header class="bg-white shadow-sm sticky top-0 z-30"><div class="max-w-lg mx-auto px-4"><div class="flex justify-between items-center h-14"><div class="flex items-center gap-1.5"><img src="logo.png" width="28" height="28" alt="Logo"><span class="text-lg font-bold text-worker-600">PE</span></div><div class="flex items-center gap-3"><button onclick="navigate('worker-notifications')" class="relative"><svg class="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg><span class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold rounded-full h-4 min-w-[16px] flex items-center justify-center px-1">3</span></button><button onclick="logoutUser()" class="text-xs text-red-500 font-medium">D&eacute;connexion</button></div></div></div></header>
    <div class="max-w-lg mx-auto px-4 pt-4">
      <h1 class="text-xl font-bold text-gray-900 mb-4">Quarts offerts</h1>
      <div class="flex bg-gray-100 rounded-lg p-1 mb-4">
        <button class="flex-1 py-2 text-sm font-medium rounded-md bg-white text-worker-600 shadow-sm">Liste</button>
        <button onclick="navigate('worker-shifts-calendar')" class="flex-1 py-2 text-sm font-medium rounded-md text-gray-500">Calendrier</button>
        <button class="flex-1 py-2 text-sm font-medium rounded-md text-gray-500">Carte</button>
      </div>
      <div class="flex gap-2 mb-4"><select class="px-3 py-2 text-sm border border-gray-200 rounded-lg bg-white"><option>Type de poste</option><option>M&eacute;nage</option><option>D&eacute;m&eacute;nagement</option><option>Manutention</option></select><button class="px-3 py-2 text-sm font-medium rounded-lg border border-gray-200 text-gray-500">Urgent</button></div>
      <div class="space-y-3">
        <!-- Shift 1 -->
        <div onclick="openShiftDetail(0)" class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 cursor-pointer hover:shadow-md transition-shadow">
          <div class="flex items-center gap-2 mb-2"><span class="px-2 py-0.5 bg-red-100 text-red-700 text-xs font-bold rounded-full">Urgent</span><span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs font-medium rounded-full">M&eacute;nage</span><span class="text-xs text-gray-400 ml-auto">REF-2026-001</span></div>
          <h3 class="font-semibold text-gray-900 mb-1">Nettoyage bureaux centre-ville</h3><p class="text-sm text-gray-500 mb-2">ProClean Solutions</p>
          <div class="grid grid-cols-2 gap-y-1 text-sm mb-3"><div class="text-gray-500">&#128197; sam. 15 f&eacute;v</div><div class="text-gray-500">&#128336; 09:00 - 17:00</div><div class="text-gray-500">&#128205; Montr&eacute;al</div><div class="text-gray-900 font-semibold">22.00$/h</div></div>
          <div class="flex items-center justify-between pt-2 border-t border-gray-100"><span class="text-xs text-gray-400">Montant estim&eacute;</span><span class="text-sm font-bold text-worker-600">~176.00$</span></div>
        </div>
        <!-- Shift 2 -->
        <div onclick="openShiftDetail(1)" class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 cursor-pointer hover:shadow-md transition-shadow">
          <div class="flex items-center gap-2 mb-2"><span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs font-medium rounded-full">D&eacute;m&eacute;nagement</span><span class="text-xs text-gray-400 ml-auto">REF-2026-002</span></div>
          <h3 class="font-semibold text-gray-900 mb-1">D&eacute;m&eacute;nagement r&eacute;sidentiel Plateau</h3><p class="text-sm text-gray-500 mb-2">D&eacute;m&eacute;Pro</p>
          <div class="grid grid-cols-2 gap-y-1 text-sm mb-3"><div class="text-gray-500">&#128197; mer. 18 f&eacute;v</div><div class="text-gray-500">&#128336; 08:00 - 16:00</div><div class="text-gray-500">&#128205; Montr&eacute;al</div><div class="text-gray-900 font-semibold">25.00$/h</div></div>
          <div class="flex items-center justify-between pt-2 border-t border-gray-100"><span class="text-xs text-gray-400">Montant estim&eacute;</span><span class="text-sm font-bold text-worker-600">~200.00$</span></div>
        </div>
        <!-- Shift 3 -->
        <div onclick="openShiftDetail(2)" class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 cursor-pointer hover:shadow-md transition-shadow">
          <div class="flex items-center gap-2 mb-2"><span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs font-medium rounded-full">M&eacute;nage</span><span class="text-xs text-gray-400 ml-auto">REF-2026-003</span></div>
          <h3 class="font-semibold text-gray-900 mb-1">Entretien m&eacute;nager hebdomadaire</h3><p class="text-sm text-gray-500 mb-2">NettoPlus</p>
          <div class="grid grid-cols-2 gap-y-1 text-sm mb-3"><div class="text-gray-500">&#128197; ven. 20 f&eacute;v</div><div class="text-gray-500">&#128336; 10:00 - 14:00</div><div class="text-gray-500">&#128205; Laval</div><div class="text-gray-900 font-semibold">20.00$/h</div></div>
          <div class="flex items-center justify-between pt-2 border-t border-gray-100"><span class="text-xs text-gray-400">Montant estim&eacute;</span><span class="text-sm font-bold text-worker-600">~80.00$</span></div>
        </div>
        <!-- Shift 4 -->
        <div onclick="openShiftDetail(3)" class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 cursor-pointer hover:shadow-md transition-shadow">
          <div class="flex items-center gap-2 mb-2"><span class="px-2 py-0.5 bg-red-100 text-red-700 text-xs font-bold rounded-full">Urgent</span><span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs font-medium rounded-full">Manutention</span><span class="text-xs text-gray-400 ml-auto">REF-2026-004</span></div>
          <h3 class="font-semibold text-gray-900 mb-1">Aide au d&eacute;chargement</h3><p class="text-sm text-gray-500 mb-2">TranspoQuick</p>
          <div class="grid grid-cols-2 gap-y-1 text-sm mb-3"><div class="text-gray-500">&#128197; lun. 16 f&eacute;v</div><div class="text-gray-500">&#128336; 07:00 - 12:00</div><div class="text-gray-500">&#128205; Longueuil</div><div class="text-gray-900 font-semibold">23.50$/h</div></div>
          <div class="flex items-center justify-between pt-2 border-t border-gray-100"><span class="text-xs text-gray-400">Montant estim&eacute;</span><span class="text-sm font-bold text-worker-600">~117.50$</span></div>
        </div>
      </div>
    </div>
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-40 worker-bottom-nav"><div class="max-w-lg mx-auto flex justify-around items-center h-16 px-2">
      <button onclick="navigate('worker-shifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-worker-600"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Quarts</span></button>
      <button onclick="navigate('worker-myshifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg><span>Mes quarts</span></button>
      <button onclick="navigate('worker-billing')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><span>Facturation</span></button>
      <button onclick="navigate('worker-profile')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg><span>Profil</span></button>
    </div></nav>
  </div>
</div>

<!-- ===== SHIFT DETAIL ===== -->
<div id="view-worker-shift-detail" class="view">
  <div class="min-h-screen bg-gray-50 pb-6">
    <!-- Green header -->
    <header class="bg-gradient-to-r from-emerald-700 to-emerald-800 text-white sticky top-0 z-30">
      <div class="max-w-lg mx-auto px-4"><div class="flex justify-between items-center h-14">
        <button onclick="navigate('worker-shifts')" class="flex items-center gap-1 text-white"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg> Retour</button>
        <span class="font-semibold">D&eacute;tails du quart</span>
        <button onclick="navigate('worker-notifications')" class="relative"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg><span class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold rounded-full h-4 min-w-[16px] flex items-center justify-center px-1">3</span></button>
      </div></div>
    </header>
    <div class="max-w-lg mx-auto px-4 pt-4 space-y-4">
      <!-- Map -->
      <div class="rounded-xl overflow-hidden shadow-sm" id="shift-detail-map" style="height:200px;z-index:1"></div>
      <!-- Transport mode -->
      <div class="bg-white rounded-xl shadow-sm p-4">
        <h3 class="text-sm font-semibold text-gray-700 mb-3">Quel est votre mode de transport ?</h3>
        <div class="flex gap-2 mb-3">
          <button onclick="selectTransport(this,'transit','1h 30m')" class="transport-btn flex-1 flex flex-col items-center gap-1 p-3 rounded-xl border-2 border-primary-700 bg-primary-50 text-primary-700">
            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M8 17h8M8 17v4m8-4v4M6 3h12a2 2 0 012 2v10a2 2 0 01-2 2H6a2 2 0 01-2-2V5a2 2 0 012-2zm3 4h6"/></svg>
            <span class="text-[10px] font-medium">Transport en commun</span><span class="text-xs font-bold">1h 30m</span>
          </button>
          <button onclick="selectTransport(this,'car','34m')" class="transport-btn flex-1 flex flex-col items-center gap-1 p-3 rounded-xl border-2 border-gray-200 text-gray-400">
            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M8 17h.01M16 17h.01M3 11l1.5-5A2 2 0 016.4 4h11.2a2 2 0 011.9 1.4L21 11M3 11h18M3 11v5a1 1 0 001 1h1m14 0h1a1 1 0 001-1v-5"/></svg>
            <span class="text-[10px] font-medium">Voiture</span><span class="text-xs font-bold">34m</span>
          </button>
          <button onclick="selectTransport(this,'bike','33m')" class="transport-btn flex-1 flex flex-col items-center gap-1 p-3 rounded-xl border-2 border-gray-200 text-gray-400">
            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><circle cx="5.5" cy="17.5" r="3.5"/><circle cx="18.5" cy="17.5" r="3.5"/><path d="M15 6a1 1 0 100-2 1 1 0 000 2zm-3 11l-4-7h6l2-4"/></svg>
            <span class="text-[10px] font-medium">V&eacute;lo</span><span class="text-xs font-bold">33m</span>
          </button>
          <button onclick="selectTransport(this,'walk','1h')" class="transport-btn flex-1 flex flex-col items-center gap-1 p-3 rounded-xl border-2 border-gray-200 text-gray-400">
            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7a2 2 0 100-4 2 2 0 000 4zm-1 3l-2 8m1-8l3 3v5m-3-8l-3-2"/></svg>
            <span class="text-[10px] font-medium">Marche</span><span class="text-xs font-bold">1h</span>
          </button>
        </div>
        <p class="text-sm text-gray-600 mb-3" id="transport-summary">Vous venez en <strong>Transport en commun</strong></p>
        <button class="w-full py-2.5 border-2 border-gray-800 rounded-full text-sm font-medium text-gray-800 hover:bg-gray-100">Itin&eacute;raire</button>
      </div>
      <!-- Shift title + badges -->
      <div class="flex items-center gap-2 flex-wrap">
        <h2 class="text-lg font-bold text-gray-900" id="shift-title">Nettoyage bureaux centre-ville</h2>
        <span id="shift-urgent" class="px-2 py-0.5 bg-red-100 text-red-700 text-xs font-bold rounded-full">Urgent</span>
        <span id="shift-status-badge" class="px-2 py-0.5 bg-green-100 text-green-700 text-xs font-bold rounded-full">Confirm&eacute;</span>
      </div>
      <!-- Establishment -->
      <div class="bg-white rounded-xl shadow-sm p-4 text-center">
        <div class="w-16 h-16 bg-gray-200 rounded-full mx-auto mb-2 flex items-center justify-center"><svg class="w-8 h-8 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg></div>
        <h2 class="text-lg font-bold text-gray-900" id="shift-site-name">ProClean Solutions</h2>
        <p class="text-sm text-gray-500" id="shift-reference">R&eacute;f&eacute;rence : REF-2026-001</p>
      </div>
      <!-- Shift details card -->
      <div class="bg-white rounded-xl shadow-sm p-4">
        <h3 class="text-sm font-semibold text-gray-700 mb-3">D&eacute;tails du quart</h3>
        <div class="space-y-3">
          <div class="flex justify-between items-center"><span class="text-sm text-gray-500">Date</span><span class="text-sm font-semibold" id="shift-date">Samedi 15 f&eacute;vrier</span></div>
          <div class="flex justify-between items-center"><span class="text-sm text-gray-500">Horaire</span><span class="text-sm font-semibold" id="shift-time">09:00 &ndash; 17:00</span></div>
          <div class="flex justify-between items-center"><span class="text-sm text-gray-500">Taux horaire</span><span class="text-sm font-semibold" id="shift-rate">22 $ / H</span></div>
          <div class="flex justify-between items-center"><span class="text-sm text-gray-500">Poste</span><span class="px-3 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-full" id="shift-post">M&eacute;nage</span></div>
          <div class="flex justify-between items-center"><span class="text-sm text-gray-500">R&eacute;mun&eacute;ration estim&eacute;e</span><span class="text-lg font-bold text-worker-600" id="shift-total">176 $</span></div>
        </div>
        <p class="text-xs text-gray-400 mt-3">Le montant affich&eacute; est une estimation. Le montant final d&eacute;pendra des heures r&eacute;alis&eacute;es.</p>
      </div>
      <!-- Status -->
      <div class="flex items-center gap-2 bg-green-50 border border-green-200 rounded-xl p-3">
        <svg class="w-5 h-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        <span class="text-sm font-semibold text-green-700" id="shift-status">Quart confirm&eacute;</span>
      </div>
      <!-- Address -->
      <div class="bg-white rounded-xl shadow-sm p-4 flex items-start gap-3">
        <svg class="w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
        <span class="text-sm text-gray-700" id="shift-address">500 boul. Ren&eacute;-L&eacute;vesque, Montr&eacute;al, QC, Canada</span>
      </div>
      <!-- Extra details -->
      <div class="bg-white rounded-xl shadow-sm p-4">
        <div class="space-y-3">
          <div class="flex justify-between items-center"><span class="text-sm text-gray-500">Tenue requise</span><span class="text-sm font-semibold" id="shift-dress">Uniforme fourni</span></div>
          <div class="flex justify-between items-center"><span class="text-sm text-gray-500">Pause incluse</span><span class="text-sm font-semibold" id="shift-break">30 min</span></div>
          <div class="flex justify-between items-center"><span class="text-sm text-gray-500">Temps de trajet estim&eacute;</span><span class="text-sm font-semibold text-worker-600" id="shift-commute-time">1h 30m</span></div>
        </div>
      </div>
      <!-- Responsable -->
      <div class="bg-white rounded-xl shadow-sm p-4 flex items-center justify-between">
        <div>
          <p class="text-xs text-gray-400 mb-0.5">Responsable du quart</p>
          <p class="text-sm font-semibold text-gray-900" id="shift-responsable">Marie Tremblay</p>
        </div>
        <a id="shift-resp-phone" href="tel:514-555-0100" class="flex items-center gap-1 px-4 py-2 bg-worker-600 text-white text-sm font-medium rounded-full"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg> 514-555-0100</a>
      </div>
      <!-- Action buttons -->
      <div class="space-y-3 pt-2">
        <button onclick="showDelayModal()" class="w-full py-3.5 bg-orange-500 hover:bg-orange-600 text-white font-semibold rounded-xl flex items-center justify-center gap-2 shadow-md">Aviser d'un retard <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg></button>
        <button onclick="showCancelModal()" class="w-full py-3.5 border-2 border-orange-500 text-orange-600 font-semibold rounded-xl flex items-center justify-center gap-2 hover:bg-orange-50">Annuler mon quart <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg></button>
      </div>
    </div>
  </div>
</div>

<!-- ===== WORKER CALENDAR ===== -->
<div id="view-worker-shifts-calendar" class="view"><div class="min-h-screen bg-gray-50 pb-20">
  <header class="bg-white shadow-sm sticky top-0 z-30"><div class="max-w-lg mx-auto px-4"><div class="flex justify-between items-center h-14"><div class="flex items-center gap-1.5"><img src="logo.png" width="28" height="28" alt="Logo"><span class="text-lg font-bold text-worker-600">PE</span></div><div class="flex items-center gap-3"><button onclick="navigate('worker-notifications')" class="relative"><svg class="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg><span class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold rounded-full h-4 min-w-[16px] flex items-center justify-center px-1">3</span></button><button onclick="logoutUser()" class="text-xs text-red-500 font-medium">D&eacute;connexion</button></div></div></div></header>
  <div class="max-w-lg mx-auto px-4 pt-4">
    <h1 class="text-xl font-bold mb-4">Quarts offerts</h1>
    <div class="flex bg-gray-100 rounded-lg p-1 mb-4"><button onclick="navigate('worker-shifts')" class="flex-1 py-2 text-sm font-medium rounded-md text-gray-500">Liste</button><button class="flex-1 py-2 text-sm font-medium rounded-md bg-white text-worker-600 shadow-sm">Calendrier</button><button class="flex-1 py-2 text-sm font-medium rounded-md text-gray-500">Carte</button></div>
    <div class="bg-white rounded-xl shadow-sm p-4">
      <div class="flex justify-between items-center mb-4"><button class="text-gray-400">&larr;</button><h2 class="text-lg font-bold">F&eacute;vrier 2026</h2><button class="text-gray-400">&rarr;</button></div>
      <div class="grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-400 mb-2"><span>L</span><span>M</span><span>M</span><span>J</span><span>V</span><span>S</span><span>D</span></div>
      <div class="grid grid-cols-7 gap-1 text-center text-sm">
        <span class="py-2 text-gray-300"></span><span class="py-2 text-gray-300"></span><span class="py-2 text-gray-300"></span><span class="py-2 text-gray-300"></span><span class="py-2 text-gray-300"></span><span class="py-2 text-gray-300"></span><span class="py-2">1</span>
        <span class="py-2">2</span><span class="py-2">3</span><span class="py-2">4</span><span class="py-2">5</span><span class="py-2">6</span><span class="py-2">7</span><span class="py-2 rounded-lg bg-primary-100 text-primary-700 font-bold">8</span>
        <span class="py-2">9</span><span class="py-2">10</span><span class="py-2">11</span><span class="py-2">12</span><span class="py-2">13</span><span class="py-2">14</span><span class="py-2 rounded-lg relative bg-red-50 text-red-700 font-semibold cursor-pointer" onclick="openShiftDetail(0)">15<span class="absolute bottom-0.5 left-1/2 -translate-x-1/2 w-1.5 h-1.5 bg-red-500 rounded-full"></span></span>
        <span class="py-2 rounded-lg relative bg-red-50 text-red-700 font-semibold cursor-pointer" onclick="openShiftDetail(3)">16<span class="absolute bottom-0.5 left-1/2 -translate-x-1/2 w-1.5 h-1.5 bg-red-500 rounded-full"></span></span><span class="py-2">17</span><span class="py-2 rounded-lg relative bg-blue-50 text-blue-700 font-semibold cursor-pointer" onclick="openShiftDetail(1)">18<span class="absolute bottom-0.5 left-1/2 -translate-x-1/2 w-1.5 h-1.5 bg-blue-500 rounded-full"></span></span><span class="py-2">19</span><span class="py-2 rounded-lg relative bg-green-50 text-green-700 font-semibold cursor-pointer" onclick="openShiftDetail(2)">20<span class="absolute bottom-0.5 left-1/2 -translate-x-1/2 w-1.5 h-1.5 bg-green-500 rounded-full"></span></span><span class="py-2">21</span><span class="py-2">22</span>
        <span class="py-2">23</span><span class="py-2">24</span><span class="py-2">25</span><span class="py-2">26</span><span class="py-2">27</span><span class="py-2">28</span>
      </div>
    </div>
  </div>
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t z-40 worker-bottom-nav"><div class="max-w-lg mx-auto flex justify-around items-center h-16 px-2"><button onclick="navigate('worker-shifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-worker-600"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Quarts</span></button><button onclick="navigate('worker-myshifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg><span>Mes quarts</span></button><button onclick="navigate('worker-billing')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><span>Facturation</span></button><button onclick="navigate('worker-profile')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg><span>Profil</span></button></div></nav>
</div></div>

<!-- ===== WORKER MY SHIFTS / BILLING / NOTIFS / MESSAGING / PROFILE / ACCOUNT / PAYMENT ===== -->
<!-- I'll include them more compactly -->

<!-- MY SHIFTS -->
<div id="view-worker-myshifts" class="view"><div class="min-h-screen bg-gray-50 pb-20">
  <header class="bg-white shadow-sm sticky top-0 z-30"><div class="max-w-lg mx-auto px-4"><div class="flex justify-between items-center h-14"><div class="flex items-center gap-1.5"><img src="logo.png" width="28" height="28" alt="Logo"><span class="text-lg font-bold text-worker-600">PE</span></div><div class="flex items-center gap-3"><button onclick="navigate('worker-notifications')" class="relative"><svg class="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg><span class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold rounded-full h-4 min-w-[16px] flex items-center justify-center px-1">3</span></button><button onclick="logoutUser()" class="text-xs text-red-500 font-medium">D&eacute;co</button></div></div></div></header>
  <div class="max-w-lg mx-auto px-4 pt-4"><h1 class="text-xl font-bold mb-4">Mes quarts</h1>
    <div class="space-y-3">
      <div onclick="openShiftDetail(0)" class="bg-white rounded-xl shadow-sm border p-4 cursor-pointer hover:shadow-md"><div class="flex items-center gap-2 mb-2"><span class="px-2 py-0.5 bg-green-100 text-green-700 text-xs font-bold rounded-full">Confirm&eacute;</span><span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs font-medium rounded-full">M&eacute;nage</span></div><h3 class="font-semibold mb-1">Nettoyage bureaux centre-ville</h3><p class="text-sm text-gray-500 mb-2">ProClean Solutions</p><div class="grid grid-cols-2 gap-y-1 text-sm"><div class="text-gray-500">&#128197; sam. 15 f&eacute;v</div><div class="text-gray-500">&#128336; 09:00 - 17:00</div><div class="text-gray-500">&#128205; Montr&eacute;al</div><div class="font-semibold">22.00$/h</div></div></div>
      <div onclick="openShiftDetail(1)" class="bg-white rounded-xl shadow-sm border p-4 cursor-pointer hover:shadow-md"><div class="flex items-center gap-2 mb-2"><span class="px-2 py-0.5 bg-green-100 text-green-700 text-xs font-bold rounded-full">Confirm&eacute;</span><span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs font-medium rounded-full">D&eacute;m&eacute;nagement</span></div><h3 class="font-semibold mb-1">D&eacute;m&eacute;nagement r&eacute;sidentiel Plateau</h3><p class="text-sm text-gray-500 mb-2">D&eacute;m&eacute;Pro</p><div class="grid grid-cols-2 gap-y-1 text-sm"><div class="text-gray-500">&#128197; mer. 18 f&eacute;v</div><div class="text-gray-500">&#128336; 08:00 - 16:00</div><div class="text-gray-500">&#128205; Montr&eacute;al</div><div class="font-semibold">25.00$/h</div></div></div>
    </div>
  </div>
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t z-40 worker-bottom-nav"><div class="max-w-lg mx-auto flex justify-around items-center h-16 px-2"><button onclick="navigate('worker-shifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Quarts</span></button><button onclick="navigate('worker-myshifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-worker-600"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg><span>Mes quarts</span></button><button onclick="navigate('worker-billing')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><span>Facturation</span></button><button onclick="navigate('worker-profile')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg><span>Profil</span></button></div></nav>
</div></div>

<!-- BILLING -->
<div id="view-worker-billing" class="view"><div class="min-h-screen bg-gray-50 pb-20">
  <header class="bg-white shadow-sm sticky top-0 z-30"><div class="max-w-lg mx-auto px-4"><div class="flex justify-between items-center h-14"><div class="flex items-center gap-1.5"><img src="logo.png" width="28" height="28" alt="Logo"><span class="text-lg font-bold text-worker-600">PE</span></div><div class="flex items-center gap-3"><button onclick="logoutUser()" class="text-xs text-red-500 font-medium">D&eacute;co</button></div></div></div></header>
  <div class="max-w-lg mx-auto px-4 pt-4"><h1 class="text-xl font-bold mb-4">Facturation</h1>
    <div class="flex bg-gray-100 rounded-lg p-1 mb-4"><button class="flex-1 py-2 text-sm font-medium rounded-md bg-white text-worker-600 shadow-sm">&Agrave; d&eacute;clarer (2)</button><button class="flex-1 py-2 text-sm font-medium rounded-md text-gray-500">Approuv&eacute;s (1)</button></div>
    <div class="space-y-3">
      <div class="bg-white rounded-xl shadow-sm border p-4"><div class="flex justify-between items-start mb-2"><div><h3 class="font-semibold">Nettoyage bureaux centre-ville</h3><p class="text-xs text-gray-400">REF-2026-001</p></div><span class="px-2 py-0.5 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full">&Agrave; d&eacute;clarer</span></div><div class="grid grid-cols-2 gap-2 text-sm text-gray-500 mb-2"><span>&#128197; sam. 15 f&eacute;v</span><span>&#128336; 09:00-17:00</span><span>Heures: 8h</span><span>Taux: 22$/h</span></div><div class="flex justify-between items-center pt-2 border-t"><span class="text-xs text-gray-400">Estim&eacute;</span><span class="font-bold text-worker-600">176.00$</span></div><button class="mt-3 w-full py-2 bg-worker-600 text-white font-medium rounded-lg text-sm">D&eacute;clarer mes heures</button></div>
      <div class="bg-white rounded-xl shadow-sm border p-4"><div class="flex justify-between items-start mb-2"><div><h3 class="font-semibold">Aide au d&eacute;chargement</h3><p class="text-xs text-gray-400">REF-2026-004</p></div><span class="px-2 py-0.5 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full">&Agrave; d&eacute;clarer</span></div><div class="grid grid-cols-2 gap-2 text-sm text-gray-500 mb-2"><span>&#128197; lun. 16 f&eacute;v</span><span>&#128336; 07:00-12:00</span><span>Heures: 5h</span><span>Taux: 23.50$/h</span></div><div class="flex justify-between items-center pt-2 border-t"><span class="text-xs text-gray-400">Estim&eacute;</span><span class="font-bold text-worker-600">117.50$</span></div><button class="mt-3 w-full py-2 bg-worker-600 text-white font-medium rounded-lg text-sm">D&eacute;clarer mes heures</button></div>
    </div>
  </div>
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t z-40 worker-bottom-nav"><div class="max-w-lg mx-auto flex justify-around items-center h-16 px-2"><button onclick="navigate('worker-shifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Quarts</span></button><button onclick="navigate('worker-myshifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg><span>Mes quarts</span></button><button onclick="navigate('worker-billing')" class="flex flex-col items-center gap-1 text-xs font-medium text-worker-600"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><span>Facturation</span></button><button onclick="navigate('worker-profile')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg><span>Profil</span></button></div></nav>
</div></div>

<!-- NOTIFICATIONS -->
<div id="view-worker-notifications" class="view"><div class="min-h-screen bg-gray-50 pb-20">
  <header class="bg-white shadow-sm sticky top-0 z-30"><div class="max-w-lg mx-auto px-4"><div class="flex justify-between items-center h-14"><div class="flex items-center gap-1.5"><img src="logo.png" width="28" height="28" alt="Logo"><span class="text-lg font-bold text-worker-600">PE</span></div><button onclick="logoutUser()" class="text-xs text-red-500 font-medium">D&eacute;co</button></div></div></header>
  <div class="max-w-lg mx-auto px-4 pt-4"><h1 class="text-xl font-bold mb-4">Notifications</h1>
    <div class="space-y-2">
      <div class="bg-white rounded-xl shadow-sm border p-4 border-l-4 border-l-blue-500"><div class="flex items-start gap-3"><span class="w-2 h-2 bg-blue-500 rounded-full mt-2"></span><div><p class="font-semibold text-sm">Rappel de quart</p><p class="text-sm text-gray-500 mt-1">Votre quart "Nettoyage bureaux" commence demain &agrave; 09:00.</p><p class="text-xs text-gray-400 mt-2">Il y a 2h</p></div></div></div>
      <div class="bg-white rounded-xl shadow-sm border p-4 border-l-4 border-l-green-500"><div class="flex items-start gap-3"><span class="w-2 h-2 bg-blue-500 rounded-full mt-2"></span><div><p class="font-semibold text-sm">Quart confirm&eacute;</p><p class="text-sm text-gray-500 mt-1">"D&eacute;m&eacute;nagement Plateau" confirm&eacute;.</p><p class="text-xs text-gray-400 mt-2">Il y a 5h</p></div></div></div>
      <div class="bg-white rounded-xl shadow-sm border p-4 border-l-4 border-l-worker-500"><div class="flex items-start gap-3"><span class="w-2 h-2 bg-blue-500 rounded-full mt-2"></span><div><p class="font-semibold text-sm">Heures approuv&eacute;es</p><p class="text-sm text-gray-500 mt-1">Vos heures pour "Entretien m&eacute;nager" approuv&eacute;es.</p><p class="text-xs text-gray-400 mt-2">Hier</p></div></div></div>
      <div class="bg-gray-50 rounded-xl shadow-sm border p-4"><div class="flex items-start gap-3"><div class="w-2 mt-2"></div><div><p class="font-medium text-gray-600 text-sm">Quart mis &agrave; jour</p><p class="text-sm text-gray-400 mt-1">Horaire "Aide au d&eacute;chargement" modifi&eacute;.</p><p class="text-xs text-gray-400 mt-2">Il y a 2j</p></div></div></div>
    </div>
  </div>
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t z-40 worker-bottom-nav"><div class="max-w-lg mx-auto flex justify-around items-center h-16 px-2"><button onclick="navigate('worker-shifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Quarts</span></button><button onclick="navigate('worker-myshifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg><span>Mes quarts</span></button><button onclick="navigate('worker-billing')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><span>Facturation</span></button><button onclick="navigate('worker-profile')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg><span>Profil</span></button></div></nav>
</div></div>

<!-- WORKER MESSAGING -->
<div id="view-worker-messaging" class="view"><div class="min-h-screen bg-gray-50 pb-20">
  <header class="bg-white shadow-sm sticky top-0 z-30"><div class="max-w-lg mx-auto px-4"><div class="flex justify-between items-center h-14"><div class="flex items-center gap-1.5"><img src="logo.png" width="28" height="28" alt="Logo"><span class="text-lg font-bold text-worker-600">PE</span></div><button onclick="logoutUser()" class="text-xs text-red-500 font-medium">D&eacute;co</button></div></div></header>
  <div class="max-w-lg mx-auto px-4 pt-4"><h1 class="text-xl font-bold mb-4">Messagerie</h1>
    <div class="bg-white rounded-xl shadow-sm border overflow-hidden mb-3">
      <div class="p-3 bg-green-50 border-l-4 border-worker-600 cursor-pointer"><div class="flex justify-between"><span class="font-semibold text-sm">Gestionnaire</span><span class="text-xs text-gray-400">09:00</span></div><p class="text-xs text-gray-500 truncate">N'oubliez pas le parking P2 demain</p></div>
      <div class="p-3 hover:bg-gray-50 cursor-pointer border-t"><div class="flex justify-between"><span class="font-semibold text-sm">Pierre Durand (Client)</span><span class="text-xs text-gray-400">Hier</span></div><p class="text-xs text-gray-500 truncate">Merci pour le bon travail !</p></div>
    </div>
    <div class="bg-white rounded-xl shadow-sm border flex flex-col" style="height:350px">
      <div class="p-3 bg-gray-50 border-b font-medium text-sm">Gestionnaire</div>
      <div id="worker-chat" class="flex-1 p-4 space-y-3 overflow-y-auto">
        <div class="flex justify-start"><div class="bg-gray-100 rounded-2xl rounded-bl-sm px-4 py-2 max-w-[75%]"><p class="text-sm">Bonjour Julie, votre quart de demain au si&egrave;ge ProClean est confirm&eacute;.</p><p class="text-xs text-gray-400 mt-1">09:00</p></div></div>
        <div class="flex justify-start"><div class="bg-gray-100 rounded-2xl rounded-bl-sm px-4 py-2 max-w-[75%]"><p class="text-sm">N'oubliez pas le parking P2 pour vous stationner.</p><p class="text-xs text-gray-400 mt-1">09:01</p></div></div>
        <div class="flex justify-end"><div class="bg-worker-600 text-white rounded-2xl rounded-br-sm px-4 py-2 max-w-[75%]"><p class="text-sm">Parfait merci ! Je serai l&agrave; &agrave; 8h45.</p><p class="text-xs text-green-200 mt-1">09:05</p></div></div>
      </div>
      <div class="p-3 border-t"><div class="flex gap-2"><input id="worker-msg-input" class="flex-1 px-4 py-2 border rounded-full text-sm" placeholder="&Eacute;crire un message..." onkeydown="if(event.key==='Enter')sendMsg('worker-msg-input','worker-chat','worker')"><button onclick="sendMsg('worker-msg-input','worker-chat','worker')" class="px-4 py-2 bg-worker-600 text-white rounded-full text-sm font-medium">Envoyer</button></div></div>
    </div>
  </div>
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t z-40 worker-bottom-nav"><div class="max-w-lg mx-auto flex justify-around items-center h-16 px-2"><button onclick="navigate('worker-shifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Quarts</span></button><button onclick="navigate('worker-myshifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg><span>Mes quarts</span></button><button onclick="navigate('worker-billing')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><span>Facturation</span></button><button onclick="navigate('worker-profile')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg><span>Profil</span></button></div></nav>
</div></div>

<!-- ===== WORKER REPORTS LIST ===== -->
<div id="view-worker-reports" class="view"><div class="min-h-screen bg-gray-50 pb-20">
  <header class="bg-white shadow-sm sticky top-0 z-30"><div class="max-w-lg mx-auto px-4"><div class="flex justify-between items-center h-14"><div class="flex items-center gap-1.5"><img src="logo.png" width="28" height="28" alt="Logo"><span class="text-lg font-bold text-worker-600">PE</span></div><button onclick="logoutUser()" class="text-xs text-red-500 font-medium">D&eacute;co</button></div></div></header>
  <div class="max-w-lg mx-auto px-4 pt-4">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-xl font-bold">Mes rapports</h1>
      <button onclick="navigate('worker-report-new')" class="px-4 py-2 bg-worker-600 text-white text-sm font-semibold rounded-lg">+ Nouveau</button>
    </div>
    <div class="space-y-3" id="worker-reports-list">
      <div class="bg-white rounded-xl shadow-sm border-l-4 border-green-500 p-4 cursor-pointer" onclick="navigate('worker-report-new')">
        <div class="flex justify-between items-start"><div><p class="font-semibold text-sm">#RPT-2026-003</p><p class="text-xs text-gray-400 mt-0.5">8 f&eacute;v &bull; ProClean Solutions</p></div><div class="flex flex-col items-end gap-1"><span class="px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold rounded-full">RAS</span><span class="text-[10px] text-blue-600 font-medium">Certifi&eacute;</span></div></div>
      </div>
      <div class="bg-white rounded-xl shadow-sm border-l-4 border-red-500 p-4">
        <div class="flex justify-between items-start"><div><p class="font-semibold text-sm">#RPT-2026-002</p><p class="text-xs text-gray-400 mt-0.5">5 f&eacute;v &bull; D&eacute;m&eacute;Pro</p></div><div class="flex flex-col items-end gap-1"><span class="px-2 py-0.5 bg-red-100 text-red-700 text-[10px] font-bold rounded-full">Incident</span><span class="text-[10px] text-green-600 font-medium">Transmis</span></div></div>
      </div>
      <div class="bg-white rounded-xl shadow-sm border-l-4 border-green-500 p-4">
        <div class="flex justify-between items-start"><div><p class="font-semibold text-sm">#RPT-2026-001</p><p class="text-xs text-gray-400 mt-0.5">3 f&eacute;v &bull; NettoPlus</p></div><div class="flex flex-col items-end gap-1"><span class="px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold rounded-full">RAS</span><span class="text-[10px] text-green-600 font-medium">Transmis</span></div></div>
      </div>
    </div>
  </div>
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t z-40"><div class="max-w-lg mx-auto flex justify-around items-center h-16 px-2"><button onclick="navigate('worker-shifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Quarts</span></button><button onclick="navigate('worker-myshifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg><span>Mes quarts</span></button><button onclick="navigate('worker-billing')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><span>Facturation</span></button><button onclick="navigate('worker-profile')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg><span>Profil</span></button></div></nav>
</div></div>

<!-- ===== WORKER REPORT NEW ===== -->
<div id="view-worker-report-new" class="view"><div class="min-h-screen bg-gray-50 pb-6">
  <header class="bg-gradient-to-r from-worker-700 to-worker-600 text-white sticky top-0 z-30">
    <div class="max-w-lg mx-auto px-4"><div class="flex justify-between items-center h-14">
      <button onclick="navigate('worker-reports')" class="flex items-center gap-1 text-white text-sm"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg> Retour</button>
      <span class="font-semibold">Nouveau rapport</span>
      <span></span>
    </div></div>
  </header>
  <div class="max-w-lg mx-auto px-4 pt-4 space-y-4">
    <!-- Infos auto-remplies -->
    <div class="bg-white rounded-xl shadow-sm p-4">
      <h3 class="text-sm font-semibold text-gray-700 mb-3">Informations du travailleur</h3>
      <div class="grid grid-cols-2 gap-3 text-sm">
        <div><span class="text-gray-400 text-xs">Nom</span><p class="font-medium" id="rpt-worker-name">Julie Leblanc</p></div>
        <div><span class="text-gray-400 text-xs">T&eacute;l&eacute;phone</span><p class="font-medium">514-555-0200</p></div>
        <div><span class="text-gray-400 text-xs">N&deg; de compte</span><p class="font-medium">PE-WRK-2026-0042</p></div>
        <div><span class="text-gray-400 text-xs">Signature &eacute;lectronique</span><p class="font-medium text-worker-600">&#10003; Valid&eacute;e</p></div>
      </div>
    </div>
    <!-- Infos du quart -->
    <div class="bg-white rounded-xl shadow-sm p-4">
      <h3 class="text-sm font-semibold text-gray-700 mb-3">Informations du service</h3>
      <div class="space-y-3">
        <div class="grid grid-cols-2 gap-3"><div><label class="text-xs text-gray-400">Date du quart</label><input type="date" class="w-full px-3 py-2 border rounded-lg text-sm" value="2026-02-08"></div><div><label class="text-xs text-gray-400">Horaire</label><input class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" value="09:00 – 17:00" readonly></div></div>
        <div><label class="text-xs text-gray-400">Client</label><input class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" value="ProClean Solutions" readonly></div>
        <div><label class="text-xs text-gray-400">Adresse du service</label><input class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" value="500 boul. René-Lévesque O, Montréal" readonly></div>
      </div>
    </div>
    <!-- RAS ou Incident -->
    <div class="bg-white rounded-xl shadow-sm p-4">
      <h3 class="text-sm font-semibold text-gray-700 mb-3">Type de rapport</h3>
      <div class="flex gap-3 mb-4">
        <button onclick="setReportType('ras')" id="btn-ras" class="flex-1 py-3 rounded-xl border-2 border-green-500 bg-green-50 text-green-700 font-semibold text-sm text-center">&#10003; RAS<br><span class="text-xs font-normal">Rien &agrave; signaler</span></button>
        <button onclick="setReportType('incident')" id="btn-incident" class="flex-1 py-3 rounded-xl border-2 border-gray-200 text-gray-400 font-semibold text-sm text-center">&#9888; Incident<br><span class="text-xs font-normal">Quelque chose &agrave; d&eacute;clarer</span></button>
      </div>
      <!-- RAS auto-text -->
      <div id="report-ras-section">
        <div class="bg-green-50 border border-green-200 rounded-lg p-3">
          <p class="text-sm text-green-800" id="ras-auto-text">Le quart du 8 f&eacute;vrier 2026 (09:00 &ndash; 17:00) chez ProClean Solutions s'est d&eacute;roul&eacute; de mani&egrave;re conforme. Rien &agrave; d&eacute;clarer.</p>
        </div>
      </div>
      <!-- Incident section -->
      <div id="report-incident-section" style="display:none" class="space-y-3">
        <div><label class="text-xs text-gray-500 mb-1 block">Cat&eacute;gorie de l'incident</label>
          <div class="flex flex-wrap gap-2">
            <button onclick="selectIncidentType(this)" class="px-3 py-1.5 border-2 rounded-full text-xs font-medium border-amber-400 bg-amber-50 text-amber-700">Bris</button>
            <button onclick="selectIncidentType(this)" class="px-3 py-1.5 border-2 rounded-full text-xs font-medium border-gray-200 text-gray-500">Panne</button>
            <button onclick="selectIncidentType(this)" class="px-3 py-1.5 border-2 rounded-full text-xs font-medium border-gray-200 text-gray-500">D&eacute;g&acirc;t</button>
            <button onclick="selectIncidentType(this)" class="px-3 py-1.5 border-2 rounded-full text-xs font-medium border-gray-200 text-gray-500">Vol</button>
            <button onclick="selectIncidentType(this)" class="px-3 py-1.5 border-2 rounded-full text-xs font-medium border-gray-200 text-gray-500">Insalubrit&eacute;</button>
            <button onclick="selectIncidentType(this)" class="px-3 py-1.5 border-2 rounded-full text-xs font-medium border-gray-200 text-gray-500">Autre</button>
          </div>
        </div>
        <div><label class="text-xs text-gray-500 mb-1 block">Description de l'incident <span id="word-count" class="text-gray-400">(0 / 500 mots)</span></label>
          <textarea id="report-text" class="w-full px-3 py-2 border rounded-lg text-sm h-32 resize-none" placeholder="D&eacute;crivez ce qui s'est pass&eacute;..." oninput="updateWordCount()"></textarea>
        </div>
        <div><label class="text-xs text-gray-500 mb-2 block">Photos (optionnel)</label>
          <div class="flex gap-2">
            <button onclick="simulatePhotoUpload()" class="w-20 h-20 border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center text-gray-400 hover:border-worker-500 hover:text-worker-600">
              <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
              <span class="text-[10px] mt-1">Photo</span>
            </button>
            <div id="photo-preview-container" class="flex gap-2"></div>
          </div>
        </div>
      </div>
    </div>
    <!-- Submit -->
    <button onclick="submitReport()" class="w-full py-3.5 bg-worker-600 hover:bg-worker-700 text-white font-semibold rounded-xl shadow-md text-sm">Soumettre le rapport</button>
  </div>
</div></div>

<!-- PROFILE -->
<div id="view-worker-profile" class="view"><div class="min-h-screen bg-gray-50 pb-20">
  <header class="bg-white shadow-sm sticky top-0 z-30"><div class="max-w-lg mx-auto px-4"><div class="flex justify-between items-center h-14"><div class="flex items-center gap-1.5"><img src="logo.png" width="28" height="28" alt="Logo"><span class="text-lg font-bold text-worker-600">PE</span></div><button onclick="logoutUser()" class="text-xs text-red-500 font-medium">D&eacute;co</button></div></div></header>
  <div class="max-w-lg mx-auto px-4 pt-4">
    <div class="bg-white rounded-xl shadow-sm p-6 mb-4 text-center"><div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3"><span class="text-3xl text-worker-600 font-bold">JL</span></div><h2 class="text-lg font-bold">Julie Leblanc</h2><p class="text-sm text-gray-500">julie.leblanc@workerapp.com</p></div>
    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
      <button onclick="navigate('worker-profile-account')" class="w-full flex items-center gap-4 px-4 py-4 hover:bg-gray-50 text-left border-b"><span class="text-xl w-8 text-center">&#128100;</span><span class="flex-1 text-sm font-medium text-gray-700">Informations du compte</span><svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg></button>
      <button class="w-full flex items-center gap-4 px-4 py-4 hover:bg-gray-50 text-left border-b"><span class="text-xl w-8 text-center">&#128736;</span><span class="flex-1 text-sm font-medium text-gray-700">Postes et exp&eacute;riences</span><svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg></button>
      <button class="w-full flex items-center gap-4 px-4 py-4 hover:bg-gray-50 text-left border-b"><span class="text-xl w-8 text-center">&#128202;</span><span class="flex-1 text-sm font-medium text-gray-700">Statistiques</span><svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg></button>
      <button class="w-full flex items-center gap-4 px-4 py-4 hover:bg-gray-50 text-left border-b"><span class="text-xl w-8 text-center">&#128196;</span><span class="flex-1 text-sm font-medium text-gray-700">Documents</span><svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg></button>
      <button onclick="navigate('worker-reports')" class="w-full flex items-center gap-4 px-4 py-4 hover:bg-gray-50 text-left border-b"><span class="text-xl w-8 text-center">&#128221;</span><span class="flex-1 text-sm font-medium text-gray-700">Mes rapports</span><svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg></button>
      <button onclick="navigate('worker-profile-payment')" class="w-full flex items-center gap-4 px-4 py-4 hover:bg-gray-50 text-left border-b"><span class="text-xl w-8 text-center">&#128179;</span><span class="flex-1 text-sm font-medium text-gray-700">Modes de paiement</span><svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg></button>
      <button class="w-full flex items-center gap-4 px-4 py-4 hover:bg-gray-50 text-left border-b"><span class="text-xl w-8 text-center">&#9878;&#65039;</span><span class="flex-1 text-sm font-medium text-gray-700">L&eacute;gal</span><svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg></button>
      <button class="w-full flex items-center gap-4 px-4 py-4 hover:bg-gray-50 text-left"><span class="text-xl w-8 text-center">&#10067;</span><span class="flex-1 text-sm font-medium text-gray-700">Aide</span><svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg></button>
    </div>
    <p class="text-center text-xs text-gray-400 mt-6">Version: 1.0.0</p>
  </div>
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t z-40 worker-bottom-nav"><div class="max-w-lg mx-auto flex justify-around items-center h-16 px-2"><button onclick="navigate('worker-shifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Quarts</span></button><button onclick="navigate('worker-myshifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg><span>Mes quarts</span></button><button onclick="navigate('worker-billing')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><span>Facturation</span></button><button onclick="navigate('worker-profile')" class="flex flex-col items-center gap-1 text-xs font-medium text-worker-600"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg><span>Profil</span></button></div></nav>
</div></div>

<!-- PROFILE ACCOUNT -->
<div id="view-worker-profile-account" class="view"><div class="min-h-screen bg-gray-50 pb-20">
  <header class="bg-white shadow-sm sticky top-0 z-30"><div class="max-w-lg mx-auto px-4"><div class="flex justify-between items-center h-14"><div class="flex items-center gap-1.5"><img src="logo.png" width="28" height="28" alt="Logo"><span class="text-lg font-bold text-worker-600">PE</span></div><button onclick="logoutUser()" class="text-xs text-red-500 font-medium">D&eacute;co</button></div></div></header>
  <div class="max-w-lg mx-auto px-4 pt-4">
    <button onclick="navigate('worker-profile')" class="text-sm text-worker-600 font-medium mb-4 inline-block">&larr; Retour</button>
    <h1 class="text-xl font-bold mb-4">Informations du compte</h1>
    <div class="bg-white rounded-xl shadow-sm p-6 space-y-4">
      <div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Pr&eacute;nom</label><input class="w-full px-3 py-2 border rounded-lg text-sm" value="Julie"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Nom</label><input class="w-full px-3 py-2 border rounded-lg text-sm" value="Leblanc"></div></div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Email</label><input class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" value="julie.leblanc@workerapp.com" readonly></div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">T&eacute;l&eacute;phone</label><input class="w-full px-3 py-2 border rounded-lg text-sm" value="514-555-0200"></div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Date de naissance</label><input type="date" class="w-full px-3 py-2 border rounded-lg text-sm" value="1995-03-15"></div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Adresse</label><input class="w-full px-3 py-2 border rounded-lg text-sm" value="200 avenue Test"></div>
      <div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Ville</label><input class="w-full px-3 py-2 border rounded-lg text-sm" value="Montr&eacute;al"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Code postal</label><input class="w-full px-3 py-2 border rounded-lg text-sm" value="H3A 2B2"></div></div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Transport</label><select class="w-full px-3 py-2 border rounded-lg text-sm"><option>Transport en commun</option><option>Voiture</option><option>V&eacute;lo</option><option>Marche</option></select></div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Pr&eacute;f&eacute;rence</label><select class="w-full px-3 py-2 border rounded-lg text-sm"><option>Temps plein</option><option>Temps partiel</option><option>Quelques quarts</option></select></div>
      <button class="w-full py-3 bg-worker-600 text-white font-semibold rounded-lg">Enregistrer</button>
    </div>
  </div>
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t z-40"><div class="max-w-lg mx-auto flex justify-around items-center h-16 px-2"><button onclick="navigate('worker-shifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Quarts</span></button><button onclick="navigate('worker-myshifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg><span>Mes quarts</span></button><button onclick="navigate('worker-billing')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><span>Facturation</span></button><button onclick="navigate('worker-profile')" class="flex flex-col items-center gap-1 text-xs font-medium text-worker-600"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg><span>Profil</span></button></div></nav>
</div></div>

<!-- PROFILE PAYMENT -->
<div id="view-worker-profile-payment" class="view"><div class="min-h-screen bg-gray-50 pb-20">
  <header class="bg-white shadow-sm sticky top-0 z-30"><div class="max-w-lg mx-auto px-4"><div class="flex justify-between items-center h-14"><div class="flex items-center gap-1.5"><img src="logo.png" width="28" height="28" alt="Logo"><span class="text-lg font-bold text-worker-600">PE</span></div><button onclick="logoutUser()" class="text-xs text-red-500 font-medium">D&eacute;co</button></div></div></header>
  <div class="max-w-lg mx-auto px-4 pt-4">
    <button onclick="navigate('worker-profile')" class="text-sm text-worker-600 font-medium mb-4 inline-block">&larr; Retour</button>
    <h1 class="text-xl font-bold mb-4">Modes de paiement</h1>
    <div class="bg-white rounded-xl shadow-sm p-6 space-y-4">
      <div><label class="block text-sm font-medium text-gray-700 mb-1">N&deg; de transit</label><input class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" value="12345" readonly></div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Code d'institution</label><input class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" value="006" readonly></div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">N&deg; de folio / compte</label><input class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" value="1234567" readonly></div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">NAS (masqu&eacute;)</label><input class="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50" value="*** *** 890" readonly></div>
      <div class="bg-amber-50 border border-amber-200 rounded-lg p-3"><p class="text-sm text-amber-700">Pour modifier vos informations bancaires, contactez le support.</p></div>
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-3"><p class="text-sm text-blue-700">Retrouvez ces num&eacute;ros sur un ch&egrave;que personnel.</p></div>
    </div>
  </div>
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t z-40"><div class="max-w-lg mx-auto flex justify-around items-center h-16 px-2"><button onclick="navigate('worker-shifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Quarts</span></button><button onclick="navigate('worker-myshifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg><span>Mes quarts</span></button><button onclick="navigate('worker-billing')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><span>Facturation</span></button><button onclick="navigate('worker-profile')" class="flex flex-col items-center gap-1 text-xs font-medium text-worker-600"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg><span>Profil</span></button></div></nav>
</div></div>

<!-- ===== WORKER SHIFTS MAP VIEW ===== -->
<div id="view-worker-shifts-map" class="view"><div class="min-h-screen bg-gray-50 pb-20">
  <header class="bg-white shadow-sm sticky top-0 z-30"><div class="max-w-lg mx-auto px-4"><div class="flex justify-between items-center h-14">
    <div class="flex items-center gap-1.5"><img src="logo.png" width="28" height="28" alt="Logo"><span class="text-lg font-bold text-worker-600">PE</span></div>
    <button onclick="navigate('worker-notifications')" class="relative p-2"><svg class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg><span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span></button>
  </div></div></header>
  <div class="max-w-lg mx-auto px-4 pt-4">
    <div class="flex items-center justify-between mb-4">
      <h1 class="text-xl font-bold text-gray-900">Quarts - Carte</h1>
      <button onclick="navigate('worker-shifts')" class="text-sm text-worker-600 font-medium">&larr; Liste</button>
    </div>
    <div id="worker-shifts-map-container" class="w-full h-96 rounded-xl shadow-sm z-10"></div>
    <p class="text-xs text-gray-400 mt-2 text-center">Cliquez sur un marqueur pour voir les d&eacute;tails</p>
  </div>
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t z-40"><div class="max-w-lg mx-auto flex justify-around items-center h-16 px-2"><button onclick="navigate('worker-shifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-worker-600"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Quarts</span></button><button onclick="navigate('worker-myshifts')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg><span>Mes quarts</span></button><button onclick="navigate('worker-billing')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><span>Facturation</span></button><button onclick="navigate('worker-profile')" class="flex flex-col items-center gap-1 text-xs font-medium text-gray-400"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg><span>Profil</span></button></div></nav>
</div></div>

<!-- ============================================= -->
<!-- JAVASCRIPT -->
<!-- ============================================= -->
<script>
// ---- DATA ----
const shifts = [
  { title: 'Nettoyage bureaux centre-ville', company: 'ProClean Solutions', ref: 'REF-2026-001', date: 'Samedi 15 février', time: '09:00 – 17:00', rate: '22 $ / H', post: 'Ménage', total: '176 $', address: '500 boul. René-Lévesque O, Montréal, QC', lat: 45.5017, lng: -73.5673, urgent: true, status: 'Confirmé', dress: 'Uniforme fourni', breakTime: '30 min', responsable: 'Marie Tremblay', respPhone: '514-555-0100', photo: '' },
  { title: 'Déménagement résidentiel Plateau', company: 'DéméPro', ref: 'REF-2026-002', date: 'Mercredi 19 février', time: '08:00 – 16:00', rate: '25 $ / H', post: 'Déménagement', total: '200 $', address: '4200 rue Saint-Denis, Montréal, QC', lat: 45.5225, lng: -73.5775, urgent: false, status: 'À confirmer', dress: 'Vêtements de travail', breakTime: '45 min', responsable: 'Pierre Gagnon', respPhone: '514-555-0201', photo: '' },
  { title: 'Entretien ménager hebdomadaire', company: 'NettoPlus', ref: 'REF-2026-003', date: 'Vendredi 21 février', time: '10:00 – 14:00', rate: '20 $ / H', post: 'Ménage', total: '80 $', address: '3000 boul. Le Carrefour, Laval, QC', lat: 45.5690, lng: -73.7490, urgent: false, status: 'Confirmé', dress: 'Aucun requis', breakTime: '15 min', responsable: 'Sophie Roy', respPhone: '450-555-0300', photo: '' },
  { title: 'Aide au déchargement entrepôt', company: 'TranspoQuick', ref: 'REF-2026-004', date: 'Lundi 24 février', time: '07:00 – 12:00', rate: '23 $ / H', post: 'Manutention', total: '115 $', address: '1500 chemin du Tremblay, Longueuil, QC', lat: 45.5088, lng: -73.4525, urgent: true, status: 'À confirmer', dress: 'Bottes de sécurité', breakTime: '15 min', responsable: 'Marc Lapointe', respPhone: '450-555-0400', photo: '' }
];

const clientSites = [
  { name: 'Siège social – Centre-ville', address: '500 boul. René-Lévesque O, Montréal', lat: 45.5017, lng: -73.5673 },
  { name: 'Succursale Laval', address: '3000 boul. Le Carrefour, Laval', lat: 45.5690, lng: -73.7490 },
  { name: 'Entrepôt Longueuil', address: '1500 chemin du Tremblay, Longueuil', lat: 45.5088, lng: -73.4525 }
];

const users = {
  'pierre': { name: 'Pierre Durand', role: 'Client', badge: 'Client', home: 'client', color: '#7c3aed', bgColor: 'bg-purple-600' },
  'marie': { name: 'Marie Martin', role: 'Client', badge: 'Client', home: 'client', color: '#7c3aed', bgColor: 'bg-purple-600' },
  'client': { name: 'Pierre Durand', role: 'Client', badge: 'Client', home: 'client', color: '#7c3aed', bgColor: 'bg-purple-600' },
  'admin': { name: 'Admin Gestionnaire', role: 'Gestionnaire', badge: 'Manager', home: 'manager', color: '#d97706', bgColor: 'bg-amber-600' },
  'manager': { name: 'Admin Gestionnaire', role: 'Gestionnaire', badge: 'Manager', home: 'manager', color: '#d97706', bgColor: 'bg-amber-600' },
  'julie': { name: 'Julie Leblanc', role: 'Travailleur', badge: 'Worker', home: 'worker-shifts', color: '#059669', bgColor: 'bg-green-600' },
  'marc': { name: 'Marc Tremblay', role: 'Travailleur', badge: 'Worker', home: 'worker-shifts', color: '#059669', bgColor: 'bg-green-600' },
  'sophie': { name: 'Sophie Roy', role: 'Travailleur', badge: 'Worker', home: 'worker-shifts', color: '#059669', bgColor: 'bg-green-600' },
  'worker': { name: 'Julie Leblanc', role: 'Travailleur', badge: 'Worker', home: 'worker-shifts', color: '#059669', bgColor: 'bg-green-600' },
  'sarah': { name: 'Sarah Côté', role: 'Gestionnaire', badge: 'Manager', home: 'manager', color: '#d97706', bgColor: 'bg-amber-600' },
  'luc': { name: 'Luc Mercier', role: 'Gestionnaire', badge: 'Manager', home: 'manager', color: '#d97706', bgColor: 'bg-amber-600' }
};

// ---- MANAGER DATA ARRAYS ----
const mgrTeam = [
  { name: 'Admin Gestionnaire', role: 'Gestionnaire principal', email: 'admin@premierelement.ca', phone: '514-555-0001', status: 'active' },
  { name: 'Sarah Côté', role: 'Gestionnaire', email: 'sarah.cote@premierelement.ca', phone: '514-555-0010', status: 'active' },
  { name: 'Luc Mercier', role: 'Gestionnaire', email: 'luc.mercier@premierelement.ca', phone: '438-555-0020', status: 'pending' }
];

const mgrWorkers = [
  { name: 'Julie Leblanc', initials: 'JL', status: 'Disponible', skills: ['Nettoyage', 'Repassage', 'Vitres'], experience: 5, rate: 20, city: 'Montréal', phone: '514-555-1001', email: 'julie.l@email.com', rating: 4.8, shiftsCompleted: 142, hoursThisMonth: 64, recentShifts: ['8 fév - Nettoyage bureaux (09:00-17:00)', '5 fév - Ménage résidentiel (10:00-14:00)', '3 fév - Nettoyage commercial (08:00-16:00)'] },
  { name: 'Marc Tremblay', initials: 'MT', status: 'Disponible', skills: ['Déménagement', 'Manutention', 'Conduite'], experience: 3, rate: 25, city: 'Longueuil', phone: '450-555-1002', email: 'marc.t@email.com', rating: 4.5, shiftsCompleted: 87, hoursThisMonth: 48, recentShifts: ['7 fév - Déménagement résidentiel (08:00-16:00)', '4 fév - Manutention entrepôt (07:00-12:00)'] },
  { name: 'Sophie Roy', initials: 'SR', status: 'Indisponible', skills: ['Multi-services', 'Nettoyage', 'Entretien'], experience: 7, rate: 22, city: 'Laval', phone: '450-555-1003', email: 'sophie.r@email.com', rating: 4.9, shiftsCompleted: 210, hoursThisMonth: 0, recentShifts: ['3 fév - Entretien mensuel (10:00-14:00)', '1 fév - Nettoyage bureaux (09:00-17:00)'] },
  { name: 'David Chen', initials: 'DC', status: 'Disponible', skills: ['Nettoyage', 'Déménagement'], experience: 2, rate: 19, city: 'Montréal', phone: '514-555-1004', email: 'david.c@email.com', rating: 4.3, shiftsCompleted: 45, hoursThisMonth: 32, recentShifts: ['6 fév - Nettoyage commercial (18:00-22:00)'] },
  { name: 'Amélie Gagnon', initials: 'AG', status: 'Disponible', skills: ['Nettoyage', 'Vitres', 'Repassage'], experience: 4, rate: 21, city: 'Brossard', phone: '450-555-1005', email: 'amelie.g@email.com', rating: 4.7, shiftsCompleted: 120, hoursThisMonth: 56, recentShifts: ['8 fév - Ménage résidentiel (08:00-12:00)', '6 fév - Nettoyage vitres (13:00-17:00)'] },
  { name: 'Karim Benali', initials: 'KB', status: 'Disponible', skills: ['Déménagement', 'Manutention', 'Montage meubles'], experience: 6, rate: 24, city: 'Montréal', phone: '514-555-1006', email: 'karim.b@email.com', rating: 4.6, shiftsCompleted: 165, hoursThisMonth: 72, recentShifts: ['8 fév - Déménagement commercial (07:00-17:00)', '5 fév - Montage mobilier (09:00-13:00)'] },
  { name: 'Émilie Fortin', initials: 'EF', status: 'Disponible', skills: ['Entretien', 'Nettoyage industriel'], experience: 3, rate: 22, city: 'Terrebonne', phone: '450-555-1007', email: 'emilie.f@email.com', rating: 4.4, shiftsCompleted: 78, hoursThisMonth: 40, recentShifts: ['7 fév - Entretien industriel (06:00-14:00)', '4 fév - Nettoyage industriel (06:00-14:00)'] },
  { name: 'Nicolas Paquet', initials: 'NP', status: 'Indisponible', skills: ['Déménagement', 'Transport'], experience: 8, rate: 26, city: 'Laval', phone: '450-555-1008', email: 'nicolas.p@email.com', rating: 4.8, shiftsCompleted: 230, hoursThisMonth: 0, recentShifts: ['2 fév - Déménagement résidentiel (08:00-18:00)'] }
];

const mgrTimesheets = [
  { worker: 'Julie Leblanc', initials: 'JL', date: '8 fév 2026', hours: 8, start: '09:00', end: '17:00', mission: 'Nettoyage bureaux centre-ville', client: 'Test Services Inc.', status: 'pending' },
  { worker: 'Marc Tremblay', initials: 'MT', date: '7 fév 2026', hours: 8, start: '08:00', end: '16:00', mission: 'Déménagement résidentiel', client: 'DéméPro', status: 'pending' },
  { worker: 'Karim Benali', initials: 'KB', date: '8 fév 2026', hours: 10, start: '07:00', end: '17:00', mission: 'Déménagement commercial', client: 'Test Services Inc.', status: 'pending' },
  { worker: 'Sophie Roy', initials: 'SR', date: '3 fév 2026', hours: 4, start: '10:00', end: '14:00', mission: 'Entretien mensuel Laval', client: 'NettoPlus', status: 'approved' },
  { worker: 'Amélie Gagnon', initials: 'AG', date: '6 fév 2026', hours: 4, start: '13:00', end: '17:00', mission: 'Nettoyage vitres', client: 'ProClean Solutions', status: 'approved' },
  { worker: 'David Chen', initials: 'DC', date: '5 fév 2026', hours: 4, start: '18:00', end: '22:00', mission: 'Nettoyage commercial soir', client: 'Test Services Inc.', status: 'rejected' }
];

const mgrAssignments = [
  { mission: 'Nettoyage bureaux centre-ville', client: 'Test Services Inc.', date: '15 fév 2026', time: '18:00-22:00', required: 3, assigned: 2, assignedWorkers: ['Julie Leblanc', 'Amélie Gagnon'] },
  { mission: 'Déménagement entrepôt Nord', client: 'Test Services Inc.', date: '10 mar 2026', time: '07:00-17:00', required: 5, assigned: 3, assignedWorkers: ['Marc Tremblay', 'Karim Benali', 'David Chen'] },
  { mission: 'Entretien mensuel Laval', client: 'NettoPlus', date: '1 mar 2026', time: '09:00-13:00', required: 2, assigned: 1, assignedWorkers: ['Sophie Roy'] },
  { mission: 'Nettoyage post-construction', client: 'ProClean Solutions', date: '20 fév 2026', time: '08:00-16:00', required: 4, assigned: 0, assignedWorkers: [] }
];

const mgrClients = [
  { name: 'Test Services Inc.', contact: 'Pierre Durand', email: 'pierre@testservices.ca', phone: '514-555-0100', address: '500 boul. René-Lévesque O, Montréal', status: 'Actif', contracts: 3, missions: 5, since: 'Janvier 2026', contractsList: [0, 1, 2], missionsList: [0, 1] },
  { name: 'NettoPlus', contact: 'Marie Martin', email: 'marie@nettoplus.ca', phone: '514-555-0200', address: '3000 boul. Le Carrefour, Laval', status: 'Actif', contracts: 1, missions: 2, since: 'Janvier 2026', contractsList: [3], missionsList: [2] },
  { name: 'ProClean Solutions', contact: 'Marie Martin', email: 'info@proclean.ca', phone: '514-555-0300', address: '1200 rue Sherbrooke E, Montréal', status: 'Actif', contracts: 2, missions: 3, since: 'Décembre 2025', contractsList: [], missionsList: [] },
  { name: 'DéméPro', contact: 'Pierre Gagnon', email: 'info@demepro.ca', phone: '450-555-0400', address: '800 boul. Industriel, Longueuil', status: 'En attente', contracts: 0, missions: 1, since: 'Février 2026', contractsList: [], missionsList: [] }
];

let currentUser = null;
let shiftMap = null;
let sitesMap = null;
let missionMap = null;
let currentView = 'landing';
let missionEditMode = false;
let selectedMissionService = 'menage';
let currentInviteMethod = 'email';

// ---- MISSIONS DATA ----
const missions = [
  {
    ref: 'PE-MSN-2026-0001',
    clientName: 'Test Services Inc.',
    contact: 'Pierre Durand',
    phone: '514-555-0100',
    email: 'pierre@testservices.ca',
    address: '500 boul. René-Lévesque O, Montréal, QC',
    city: 'Montréal',
    postal: 'H2Z 1Y6',
    lat: 45.5017,
    lng: -73.5673,
    service: 'menage',
    serviceLabel: 'Ménage',
    title: 'Nettoyage complet des bureaux',
    description: 'Nettoyage quotidien des espaces de travail, salles de réunion et espaces communs. Inclut le vidage des poubelles, le passage de l\'aspirateur, le nettoyage des surfaces et des sanitaires.',
    startDate: '2026-02-15',
    endDate: '2026-06-30',
    startTime: '18:00',
    endTime: '22:00',
    recurrence: 'weekly',
    workers: 3,
    rate: 22,
    budget: 4200,
    status: 'active',
    statusLabel: 'En cours',
    finalRate: 23.50,
    hasFinalRate: true,
    createdAt: '3 jan. 2026',
    timeline: ['Demande soumise — 3 jan. 2026', 'Évaluation complétée — 5 jan. 2026', 'Coût final confirmé — 7 jan. 2026', 'Mission démarrée — 15 fév. 2026']
  },
  {
    ref: 'PE-MSN-2026-0002',
    clientName: 'Test Services Inc.',
    contact: 'Pierre Durand',
    phone: '514-555-0100',
    email: 'pierre@testservices.ca',
    address: '1500 rue Notre-Dame, Montréal, QC',
    city: 'Montréal',
    postal: 'H3C 1K5',
    lat: 45.4950,
    lng: -73.5560,
    service: 'demenagement',
    serviceLabel: 'Déménagement',
    title: 'Déménagement entrepôt Nord',
    description: 'Déménagement complet de l\'entrepôt vers le nouveau local. Manutention lourde, emballage du matériel informatique et mobilier.',
    startDate: '2026-03-10',
    endDate: '2026-03-12',
    startTime: '07:00',
    endTime: '17:00',
    recurrence: 'none',
    workers: 5,
    rate: 25,
    budget: 3750,
    status: 'evaluation',
    statusLabel: 'En évaluation',
    finalRate: null,
    hasFinalRate: false,
    createdAt: '5 fév. 2026',
    timeline: ['Demande soumise — 5 fév. 2026', 'Évaluation en cours']
  },
  {
    ref: 'PE-MSN-2026-0003',
    clientName: 'Test Services Inc.',
    contact: 'Pierre Durand',
    phone: '514-555-0100',
    email: 'pierre@testservices.ca',
    address: '3200 boul. Le Carrefour, Laval, QC',
    city: 'Laval',
    postal: 'H7T 2R5',
    lat: 45.5690,
    lng: -73.7490,
    service: 'entretien',
    serviceLabel: 'Entretien',
    title: 'Entretien mensuel succursale Laval',
    description: 'Entretien mensuel complet : nettoyage des planchers, fenêtres intérieures, salles de bain et cuisine. Produits fournis par le client.',
    startDate: '2026-03-01',
    endDate: '2026-12-31',
    startTime: '09:00',
    endTime: '13:00',
    recurrence: 'monthly',
    workers: 2,
    rate: 20,
    budget: 1280,
    status: 'draft',
    statusLabel: 'Brouillon',
    finalRate: null,
    hasFinalRate: false,
    createdAt: '7 fév. 2026',
    timeline: ['Brouillon créé — 7 fév. 2026']
  }
];

// ---- NAVIGATION ----
function navigate(viewId) {
  document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
  const target = document.getElementById('view-' + viewId);
  if (target) {
    target.style.display = 'block';
    currentView = viewId;
    window.scrollTo(0, 0);
  }
  // Init maps if needed
  if (viewId === 'client-sites') {
    setTimeout(() => initSitesMap(), 200);
  }
  if (viewId === 'client-missions') {
    renderMissions();
  }
  if (viewId === 'client-mission-new') {
    setTimeout(() => initMissionMap(), 300);
    resetMissionForm();
  }
  if (viewId === 'manager-missions') {
    renderMgrMissions();
  }
  if (viewId === 'manager-workers') {
    renderMgrWorkers();
  }
  if (viewId === 'manager-validation') {
    setValidationTab('timesheets');
  }
  if (viewId === 'manager-clients') {
    renderMgrClients();
  }
  if (viewId === 'manager-team') {
    renderTeamMembers();
  }
}

// ---- AUTH ----
function switchUser(userId) {
  currentUser = users[userId];
  if (!currentUser) return;
  // Update sidebar user display
  const nameEl = document.getElementById('currentUserName');
  const badgeEl = document.getElementById('currentUserBadge');
  const userDiv = document.getElementById('currentUser');
  const logoutBtn = document.getElementById('btn-logout-sidebar');
  if (nameEl) nameEl.textContent = currentUser.name;
  if (badgeEl) {
    badgeEl.textContent = currentUser.badge;
    badgeEl.style.backgroundColor = currentUser.color;
    badgeEl.style.color = '#fff';
  }
  if (userDiv) userDiv.classList.remove('hidden');
  if (logoutBtn) logoutBtn.classList.remove('hidden');
  // Highlight active account button
  document.querySelectorAll('.acct-btn').forEach(btn => {
    btn.classList.remove('ring-2', 'ring-orange-400');
    if (btn.dataset.user === userId) btn.classList.add('ring-2', 'ring-orange-400');
  });
  navigate(currentUser.home);
}

function logoutUser() {
  currentUser = null;
  const userDiv = document.getElementById('currentUser');
  const logoutBtn = document.getElementById('btn-logout-sidebar');
  if (userDiv) userDiv.classList.add('hidden');
  if (logoutBtn) logoutBtn.classList.add('hidden');
  document.querySelectorAll('.acct-btn').forEach(btn => btn.classList.remove('ring-2', 'ring-orange-400'));
  navigate('landing');
}

function loginDemo(role) {
  switchUser(role);
}

function setRegRole(role) {
  const fields = document.getElementById('reg-enterprise-fields');
  if (fields) fields.style.display = role === 'client' ? 'block' : 'none';
  const clientBtn = document.getElementById('reg-client');
  const workerBtn = document.getElementById('reg-worker');
  if (clientBtn && workerBtn) {
    if (role === 'client') {
      clientBtn.className = 'flex-1 py-2 text-sm font-medium rounded-md bg-enterprise-600 text-white';
      workerBtn.className = 'flex-1 py-2 text-sm font-medium rounded-md text-gray-500';
    } else {
      workerBtn.className = 'flex-1 py-2 text-sm font-medium rounded-md bg-worker-600 text-white';
      clientBtn.className = 'flex-1 py-2 text-sm font-medium rounded-md text-gray-500';
    }
  }
}

// ---- SIDEBAR (Test Mode Panel) ----
let sidebarVisible = true;
function toggleSidebar() {
  const sb = document.getElementById('sidebar');
  const toggle = document.getElementById('sidebar-toggle');
  if (sidebarVisible) {
    sb.style.display = 'none';
    if (toggle) toggle.classList.remove('hidden');
    sidebarVisible = false;
  } else {
    sb.style.display = 'flex';
    if (toggle) toggle.classList.add('hidden');
    sidebarVisible = true;
  }
}
function closeSidebar() {
  // No-op for fixed sidebar mode
}

function setSidebarTab(tab) {
  const panelAccounts = document.getElementById('panel-accounts');
  const panelNavigate = document.getElementById('panel-navigate');
  const tabAccounts = document.getElementById('tab-accounts');
  const tabNavigate = document.getElementById('tab-navigate');
  if (tab === 'accounts') {
    if (panelAccounts) panelAccounts.style.display = 'block';
    if (panelNavigate) panelNavigate.style.display = 'none';
    if (tabAccounts) { tabAccounts.classList.add('text-orange-400', 'border-b-2', 'border-orange-400'); tabAccounts.classList.remove('text-gray-400'); }
    if (tabNavigate) { tabNavigate.classList.remove('text-orange-400', 'border-b-2', 'border-orange-400'); tabNavigate.classList.add('text-gray-400'); }
  } else {
    if (panelAccounts) panelAccounts.style.display = 'none';
    if (panelNavigate) panelNavigate.style.display = 'block';
    if (tabNavigate) { tabNavigate.classList.add('text-orange-400', 'border-b-2', 'border-orange-400'); tabNavigate.classList.remove('text-gray-400'); }
    if (tabAccounts) { tabAccounts.classList.remove('text-orange-400', 'border-b-2', 'border-orange-400'); tabAccounts.classList.add('text-gray-400'); }
  }
}

// ---- SHIFT DETAIL ----
function openShiftDetail(index) {
  const s = shifts[index];
  if (!s) return;
  // Fill data using actual HTML IDs
  document.getElementById('shift-title').textContent = s.title;
  document.getElementById('shift-site-name').textContent = s.company;
  document.getElementById('shift-reference').textContent = 'Référence : ' + s.ref;
  document.getElementById('shift-date').textContent = s.date;
  document.getElementById('shift-time').textContent = s.time;
  document.getElementById('shift-rate').textContent = s.rate;
  document.getElementById('shift-post').textContent = s.post;
  document.getElementById('shift-total').textContent = s.total;
  document.getElementById('shift-address').textContent = s.address;
  document.getElementById('shift-dress').textContent = s.dress;
  document.getElementById('shift-break').textContent = s.breakTime;
  document.getElementById('shift-responsable').textContent = s.responsable;
  document.getElementById('shift-resp-phone').setAttribute('href', 'tel:' + s.respPhone);
  document.getElementById('shift-resp-phone').innerHTML = '<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg> ' + s.respPhone;
  // Status badge
  const badge = document.getElementById('shift-status-badge');
  badge.textContent = s.status;
  if (s.status === 'Confirmé') {
    badge.className = 'px-2 py-0.5 bg-green-100 text-green-700 text-xs font-bold rounded-full';
  } else {
    badge.className = 'px-2 py-0.5 bg-amber-100 text-amber-700 text-xs font-bold rounded-full';
  }
  // Status line
  const statusLine = document.getElementById('shift-status');
  statusLine.textContent = s.status === 'Confirmé' ? 'Quart confirmé' : 'Quart à confirmer';
  // Urgent badge
  document.getElementById('shift-urgent').style.display = s.urgent ? 'inline-block' : 'none';

  navigate('worker-shift-detail');

  // Init map
  setTimeout(() => {
    const mapEl = document.getElementById('shift-detail-map');
    if (shiftMap) {
      shiftMap.remove();
      shiftMap = null;
    }
    shiftMap = L.map(mapEl).setView([s.lat, s.lng], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap'
    }).addTo(shiftMap);
    L.marker([s.lat, s.lng]).addTo(shiftMap)
      .bindPopup('<b>' + s.company + '</b><br>' + s.address)
      .openPopup();
    setTimeout(() => shiftMap.invalidateSize(), 300);
  }, 300);
}

function selectTransport(btn, mode, duration) {
  // Highlight selected
  btn.parentElement.querySelectorAll('button').forEach(b => {
    b.classList.remove('bg-worker-600', 'text-white');
    b.classList.add('bg-gray-100', 'text-gray-600');
  });
  btn.classList.remove('bg-gray-100', 'text-gray-600');
  btn.classList.add('bg-worker-600', 'text-white');
  // Update estimated time
  document.getElementById('shift-commute-time').textContent = duration;
}

// ---- CLIENT SITES MAP ----
function initSitesMap() {
  const mapEl = document.getElementById('client-sites-map');
  if (!mapEl) return;
  if (sitesMap) {
    sitesMap.remove();
    sitesMap = null;
  }
  sitesMap = L.map(mapEl).setView([45.52, -73.57], 11);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap'
  }).addTo(sitesMap);
  clientSites.forEach(site => {
    L.marker([site.lat, site.lng]).addTo(sitesMap)
      .bindPopup('<b>' + site.name + '</b><br>' + site.address);
  });
  setTimeout(() => sitesMap.invalidateSize(), 300);
}

// ---- WORKER SHIFTS MAP VIEW ----
function showShiftsMap() {
  navigate('worker-shifts-map');
  setTimeout(() => {
    const mapEl = document.getElementById('worker-shifts-map-container');
    if (!mapEl) return;
    const wMap = L.map(mapEl).setView([45.52, -73.57], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap'
    }).addTo(wMap);
    shifts.forEach((s, i) => {
      L.marker([s.lat, s.lng]).addTo(wMap)
        .bindPopup('<b>' + s.title + '</b><br>' + s.company + '<br><a href="#" onclick="openShiftDetail(' + i + '); return false;">Voir détails</a>');
    });
    setTimeout(() => wMap.invalidateSize(), 300);
  }, 300);
}

// ---- CALENDAR INTERACTIONS ----
function calendarDayClick(day) {
  if (day === 15) openShiftDetail(0);
  else if (day === 19) openShiftDetail(1);
  else if (day === 21) openShiftDetail(2);
  else if (day === 24) openShiftDetail(3);
}

// ---- MESSAGING ----
function sendMessage(inputId, chatId) {
  sendMsg(inputId, chatId, 'default');
}

function sendMsg(inputId, chatId, theme) {
  const input = document.getElementById(inputId);
  const chat = document.getElementById(chatId);
  if (!input || !chat || !input.value.trim()) return;
  const text = input.value.trim();
  const colors = {
    enterprise: { bg: 'bg-enterprise-600', reply: 'bg-purple-100 text-purple-800' },
    manager: { bg: 'bg-manager-600', reply: 'bg-amber-100 text-amber-800' },
    worker: { bg: 'bg-worker-600', reply: 'bg-green-100 text-green-800' },
    default: { bg: 'bg-blue-600', reply: 'bg-gray-200 text-gray-800' }
  };
  const c = colors[theme] || colors.default;
  const msg = document.createElement('div');
  msg.className = 'flex justify-end mb-2';
  msg.innerHTML = '<div class="' + c.bg + ' text-white px-4 py-2 rounded-2xl rounded-br-md max-w-xs text-sm">' + text + '</div>';
  chat.appendChild(msg);
  input.value = '';
  chat.scrollTop = chat.scrollHeight;
  const replies = [
    'Merci pour votre message ! Nous reviendrons vers vous bientôt.',
    'Bien reçu, je vérifie et je reviens vers vous.',
    'D\'accord, je m\'en occupe.',
    'Merci ! Est-ce qu\'il y a autre chose ?',
    'Parfait, c\'est noté.'
  ];
  const reply = replies[Math.floor(Math.random() * replies.length)];
  setTimeout(() => {
    const resp = document.createElement('div');
    resp.className = 'flex justify-start mb-2';
    resp.innerHTML = '<div class="' + c.reply + ' px-4 py-2 rounded-2xl rounded-bl-md max-w-xs text-sm">' + reply + '</div>';
    chat.appendChild(resp);
    chat.scrollTop = chat.scrollHeight;
  }, 800 + Math.random() * 1200);
}

// ---- MANAGER CONTRACTS ----
const mgrContracts = [
  { title: 'Nettoyage \u2014 Si\u00e8ge social', client: 'Test Services Inc.', signer: 'Pierre Durand', estab: 'Si\u00e8ge social \u2014 500 boul. Ren\u00e9-L\u00e9vesque O, Montr\u00e9al', ref: 'PE-CTR-2026-0015', date: '15 janvier 2026', docTitle: 'CONTRAT DE SERVICE DE NETTOYAGE', rate: '22,00 $/h', duration: '15 janvier 2026 au 31 d\u00e9cembre 2026', pdf: 'contrat-nettoyage-siege.pdf', art1: 'Le Prestataire s\u2019engage \u00e0 fournir des services de nettoyage commercial r\u00e9gulier.' },
  { title: 'Entretien mensuel \u2014 Si\u00e8ge', client: 'Test Services Inc.', signer: 'Pierre Durand', estab: 'Si\u00e8ge social \u2014 500 boul. Ren\u00e9-L\u00e9vesque O, Montr\u00e9al', ref: 'PE-CTR-2026-0018', date: '1 f\u00e9vrier 2026', docTitle: 'CONTRAT D\u2019ENTRETIEN MENSUEL', rate: '20,00 $/h', duration: '1 f\u00e9vrier 2026 au 1 f\u00e9vrier 2027', pdf: 'contrat-entretien-siege.pdf', art1: 'Le Prestataire s\u2019engage \u00e0 fournir des services d\u2019entretien g\u00e9n\u00e9ral mensuel.' },
  { title: 'D\u00e9m\u00e9nagement \u2014 Entrep\u00f4t Nord', client: 'Test Services Inc.', signer: 'Pierre Durand', estab: 'Entrep\u00f4t Nord \u2014 1500 rue Notre-Dame, Montr\u00e9al', ref: 'PE-CTR-2026-0021', date: '8 f\u00e9vrier 2026', docTitle: 'CONTRAT DE D\u00c9M\u00c9NAGEMENT', rate: '25,00 $/h', duration: '10 au 12 f\u00e9vrier 2026 (ponctuel)', pdf: 'contrat-demenagement-entrepot.pdf', art1: 'Le Prestataire s\u2019engage \u00e0 fournir une \u00e9quipe de 4 travailleurs pour le d\u00e9m\u00e9nagement.' },
  { title: 'Nettoyage \u2014 Succursale Laval', client: 'NettoPlus', signer: 'Marie Martin', estab: 'Succursale Laval \u2014 3200 boul. Le Carrefour, Laval', ref: 'PE-CTR-2026-0009', date: '20 janvier 2026', docTitle: 'CONTRAT DE NETTOYAGE HEBDOMADAIRE', rate: '21,00 $/h', duration: '20 au 31 janvier 2026', pdf: 'contrat-nettoyage-laval.pdf', art1: 'Le Prestataire s\u2019engage \u00e0 fournir des services de nettoyage hebdomadaire.' }
];

function openMgrContract(index) {
  const c = mgrContracts[index];
  if (!c) return;
  document.getElementById('mgr-ctr-title').textContent = c.title;
  document.getElementById('mgr-ctr-subtitle').textContent = c.client + ' \u2014 ' + c.signer;
  document.getElementById('mgr-ctr-pdf-name').textContent = c.pdf;
  document.getElementById('mgr-ctr-doc-title').textContent = c.docTitle;
  document.getElementById('mgr-ctr-ref').textContent = c.ref;
  document.getElementById('mgr-ctr-date').textContent = c.date;
  document.getElementById('mgr-ctr-estab').textContent = c.estab;
  document.getElementById('mgr-ctr-client').innerHTML = '<strong>' + c.client + '</strong>, repr\u00e9sent\u00e9 par ' + c.signer + ' (ci-apr\u00e8s \u00ab le Client \u00bb)';
  document.getElementById('mgr-ctr-art1').textContent = c.art1;
  document.getElementById('mgr-ctr-art2').textContent = 'P\u00e9riode : ' + c.duration + '.';
  document.getElementById('mgr-ctr-art3').textContent = 'Taux horaire : ' + c.rate + ' par travailleur.';
  document.getElementById('mgr-ctr-signer').textContent = c.signer + ' \u2014 ' + c.client;
  navigate('manager-contract-detail');
}

// ---- MANAGER REPORTS DETAIL ----
const mgrReports = [
  { id: 'RPT-2026-004', date: '8 f\u00e9v 2026', location: '3000 boul. Le Carrefour, Laval', type: 'ras', body: 'Le quart du 8 f\u00e9vrier 2026 (10:00 \u2013 14:00) s\u2019est d\u00e9roul\u00e9 de mani\u00e8re conforme. Rien \u00e0 d\u00e9clarer.', worker: 'Sophie Roy', workerInit: 'SR', client: 'NettoPlus \u2014 Pierre Durand', clientInit: 'PD', schedule: '10:00 \u2013 14:00', status: '\u00c0 certifier', statusColor: 'text-amber-600', photos: 0, incidentCat: '', actions: 'certify' },
  { id: 'RPT-2026-003', date: '8 f\u00e9v 2026', location: '500 boul. Ren\u00e9-L\u00e9vesque O', type: 'ras', body: 'Le quart du 8 f\u00e9vrier 2026 (09:00 \u2013 17:00) s\u2019est d\u00e9roul\u00e9 de mani\u00e8re conforme. Rien \u00e0 d\u00e9clarer.', worker: 'Julie Leblanc', workerInit: 'JL', client: 'ProClean Solutions \u2014 Pierre Durand', clientInit: 'PD', schedule: '09:00 \u2013 17:00', status: 'Certifi\u00e9', statusColor: 'text-blue-600', photos: 0, incidentCat: '', actions: 'transmit' },
  { id: 'RPT-2026-002', date: '5 f\u00e9v 2026', location: '4200 rue Saint-Denis, Montr\u00e9al', type: 'incident', body: 'Lors du d\u00e9m\u00e9nagement, un miroir mural a \u00e9t\u00e9 endommag\u00e9 dans le couloir du 2e \u00e9tage. Le bris est survenu pendant le d\u00e9placement d\u2019un meuble volumineux. Photos jointes.', worker: 'Marc Tremblay', workerInit: 'MT', client: 'D\u00e9m\u00e9Pro \u2014 Pierre Durand', clientInit: 'PD', schedule: '07:00 \u2013 16:00', status: 'Transmis', statusColor: 'text-green-600', photos: 2, incidentCat: 'BRIS', actions: 'done' },
  { id: 'RPT-2026-001', date: '3 f\u00e9v 2026', location: '3000 boul. Le Carrefour, Laval', type: 'ras', body: 'Le quart du 3 f\u00e9vrier 2026 s\u2019est d\u00e9roul\u00e9 de mani\u00e8re conforme.', worker: 'Sophie Roy', workerInit: 'SR', client: 'NettoPlus \u2014 Pierre Durand', clientInit: 'PD', schedule: '10:00 \u2013 14:00', status: 'Transmis', statusColor: 'text-green-600', photos: 0, incidentCat: '', actions: 'done' }
];

function openMgrReport(index) {
  const r = mgrReports[index];
  if (!r) return;
  document.getElementById('mgr-rpt-title').textContent = 'Rapport #' + r.id;
  document.getElementById('mgr-rpt-meta').textContent = r.date + ' \u2022 ' + r.worker + ' \u2022 ' + r.location;
  const badge = document.getElementById('mgr-rpt-badge');
  const card = document.getElementById('mgr-rpt-card');
  if (r.type === 'ras') {
    badge.textContent = 'RAS'; badge.className = 'px-3 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full';
    card.className = 'bg-white rounded-xl shadow-sm p-6 border-l-4 border-green-500';
  } else {
    badge.textContent = 'Incident'; badge.className = 'px-3 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-full';
    card.className = 'bg-white rounded-xl shadow-sm p-6 border-l-4 border-red-500';
  }
  const catEl = document.getElementById('mgr-rpt-incident-cat');
  if (r.incidentCat) { catEl.classList.remove('hidden'); catEl.querySelector('span').textContent = r.incidentCat; } else { catEl.classList.add('hidden'); }
  document.getElementById('mgr-rpt-body').textContent = r.body;
  document.getElementById('mgr-rpt-worker').textContent = r.worker;
  document.getElementById('mgr-rpt-client').textContent = r.client;
  document.getElementById('mgr-rpt-schedule').textContent = r.schedule;
  const statusEl = document.getElementById('mgr-rpt-status');
  statusEl.textContent = r.status; statusEl.className = 'font-medium ' + r.statusColor;
  const photosEl = document.getElementById('mgr-rpt-photos');
  const photosList = document.getElementById('mgr-rpt-photos-list');
  if (r.photos > 0) { photosEl.classList.remove('hidden'); photosList.innerHTML = ''; for (let i = 0; i < r.photos; i++) photosList.innerHTML += '<div class="w-24 h-24 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400 text-xs">Photo '+(i+1)+'</div>'; }
  else { photosEl.classList.add('hidden'); }
  // Actions
  const actionsEl = document.getElementById('mgr-rpt-actions');
  if (r.actions === 'certify') {
    actionsEl.innerHTML = '<button onclick="event.stopPropagation();certifyReport(this)" class="px-5 py-2.5 bg-manager-600 text-white text-sm font-semibold rounded-lg hover:bg-manager-700">Certifier</button><button onclick="event.stopPropagation();transmitReport(this)" class="px-5 py-2.5 border-2 border-manager-600 text-manager-700 text-sm font-semibold rounded-lg" disabled style="opacity:0.4">Transmettre au client</button>';
  } else if (r.actions === 'transmit') {
    actionsEl.innerHTML = '<span class="px-4 py-2 bg-green-100 text-green-700 text-sm font-medium rounded-lg">\u2713 Certifi\u00e9</span><button onclick="event.stopPropagation();transmitReport(this)" class="px-5 py-2.5 bg-enterprise-600 text-white text-sm font-semibold rounded-lg hover:bg-enterprise-700">Transmettre au client</button>';
  } else {
    actionsEl.innerHTML = '<span class="px-4 py-2 bg-green-100 text-green-700 text-sm font-medium rounded-lg">\u2713 Transmis au client</span>';
  }
  // Contact panel
  document.getElementById('mgr-rpt-client-init').textContent = r.clientInit;
  document.getElementById('mgr-rpt-client-name2').textContent = r.client.split(' \u2014 ')[1] || r.client;
  document.getElementById('mgr-rpt-worker-init').textContent = r.workerInit;
  document.getElementById('mgr-rpt-worker-name2').textContent = r.worker;
  document.getElementById('mgr-report-chat-area').classList.add('hidden');
  document.getElementById('mgr-report-chat').innerHTML = '';
  navigate('manager-report-detail');
}

function startMgrReportChat(target) {
  const area = document.getElementById('mgr-report-chat-area');
  const label = document.getElementById('mgr-report-chat-target');
  area.classList.remove('hidden');
  if (target === 'client') {
    label.textContent = document.getElementById('mgr-rpt-client-name2').textContent;
  } else {
    label.textContent = document.getElementById('mgr-rpt-worker-name2').textContent;
  }
  document.getElementById('mgr-report-chat').innerHTML = '<div class="flex justify-start mb-2"><div class="bg-gray-100 rounded-2xl rounded-bl-sm px-3 py-2 max-w-xs text-sm text-gray-600">Bonjour, en quoi puis-je vous aider concernant ce rapport ?</div></div>';
  document.getElementById('mgr-report-chat-input').focus();
}

// ---- MANAGER CONVERSATIONS ----
const mgrConversations = [
  { name: 'Pierre Durand', initials: 'PD', color: 'bg-purple-100 text-purple-700', role: 'Client \u2014 Test Services Inc.', messages: [
    { from: 'me', text: 'La mission de vendredi au si\u00e8ge est confirm\u00e9e avec 2 travailleurs.', time: '10:30' },
    { from: 'them', text: 'Parfait ! Parking P2 disponible.', time: '10:32' },
    { from: 'me', text: 'Bien not\u00e9. Je transmets l\u2019information aux travailleurs.', time: '10:35' }
  ]},
  { name: 'Julie Leblanc', initials: 'JL', color: 'bg-green-100 text-green-700', role: 'Travailleuse \u2014 Nettoyage', messages: [
    { from: 'me', text: 'Julie, vous \u00eates assign\u00e9e au si\u00e8ge de Test Services vendredi 09:00.', time: '09:00' },
    { from: 'them', text: 'OK je serai l\u00e0 \u00e0 9h. Parking P2 c\u2019est not\u00e9 !', time: '09:05' }
  ]},
  { name: 'Marc Tremblay', initials: 'MT', color: 'bg-green-100 text-green-700', role: 'Travailleur \u2014 D\u00e9m\u00e9nagement', messages: [
    { from: 'them', text: 'D\u00e9sol\u00e9 pour le retard de ce matin, il y avait un accident sur le pont.', time: 'Hier 08:15' },
    { from: 'me', text: 'Pas de souci Marc, merci de pr\u00e9venir. L\u2019\u00e9quipe est sur place.', time: 'Hier 08:20' }
  ]},
  { name: 'Sophie Roy', initials: 'SR', color: 'bg-green-100 text-green-700', role: 'Travailleuse \u2014 Multi-services', messages: [
    { from: 'me', text: 'Sophie, votre quart de lundi \u00e0 Laval est confirm\u00e9. 10h-14h.', time: '3 f\u00e9v 10:00' },
    { from: 'them', text: 'Merci, \u00e0 la semaine prochaine !', time: '3 f\u00e9v 10:10' }
  ]},
  { name: 'Marie Martin', initials: 'MM', color: 'bg-purple-100 text-purple-700', role: 'Cliente \u2014 NettoPlus', messages: [
    { from: 'them', text: 'Pouvez-vous me rappeler concernant le renouvellement du contrat ?', time: '2 f\u00e9v 15:00' }
  ]}
];

function selectMgrConv(index) {
  const conv = mgrConversations[index];
  if (!conv) return;
  document.querySelectorAll('#mgr-conv-list > div').forEach((el, i) => {
    if (i === index) {
      el.className = 'p-3 bg-amber-50 border-l-4 border-manager-600 cursor-pointer';
      const badge = el.querySelector('.bg-red-500');
      if (badge) badge.remove();
    } else {
      el.className = 'p-3 hover:bg-gray-50 cursor-pointer';
    }
  });
  document.getElementById('mgr-chat-avatar').className = 'w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ' + conv.color;
  document.getElementById('mgr-chat-avatar').textContent = conv.initials;
  document.getElementById('mgr-chat-name').textContent = conv.name;
  document.getElementById('mgr-chat-role').textContent = conv.role;
  const chat = document.getElementById('manager-chat');
  chat.innerHTML = '';
  conv.messages.forEach(m => {
    const div = document.createElement('div');
    if (m.from === 'me') {
      div.className = 'flex justify-end mb-2';
      div.innerHTML = '<div class="bg-manager-600 text-white rounded-2xl rounded-br-sm px-4 py-2 max-w-xs"><p class="text-sm">' + m.text + '</p><p class="text-xs text-amber-200 mt-1">' + m.time + '</p></div>';
    } else {
      div.className = 'flex justify-start mb-2';
      div.innerHTML = '<div class="bg-gray-100 rounded-2xl rounded-bl-sm px-4 py-2 max-w-xs"><p class="text-sm">' + m.text + '</p><p class="text-xs text-gray-400 mt-1">' + m.time + '</p></div>';
    }
    chat.appendChild(div);
  });
  chat.scrollTop = chat.scrollHeight;
  updateMgrMsgBadge();
}

function updateMgrMsgBadge() {
  let count = 0;
  document.querySelectorAll('#mgr-conv-list .bg-red-500').forEach(() => count++);
  document.querySelectorAll('.mgr-msg-badge').forEach(b => {
    if (count > 0) { b.textContent = count; b.classList.remove('hidden'); }
    else { b.classList.add('hidden'); }
  });
}

// ---- CONTRACTS ----
const contracts = [
  { title: 'Contrat de service \u2014 Nettoyage', establishment: 'Si\u00e8ge social \u2014 500 boul. Ren\u00e9-L\u00e9vesque O, Montr\u00e9al', ref: 'PE-CTR-2026-0015', dateSigned: '15 janvier 2026', docTitle: 'CONTRAT DE SERVICE DE NETTOYAGE', rate: '22,00 $/h', duration: '15 janvier 2026 au 31 d\u00e9cembre 2026', pdf: 'contrat-nettoyage-siege.pdf', art1: 'Le Prestataire s\u2019engage \u00e0 fournir des services de nettoyage commercial r\u00e9gulier \u00e0 l\u2019\u00e9tablissement d\u00e9sign\u00e9 ci-dessus.' },
  { title: 'Contrat de service \u2014 Entretien mensuel', establishment: 'Si\u00e8ge social \u2014 500 boul. Ren\u00e9-L\u00e9vesque O, Montr\u00e9al', ref: 'PE-CTR-2026-0018', dateSigned: '1 f\u00e9vrier 2026', docTitle: 'CONTRAT D\u2019ENTRETIEN MENSUEL', rate: '20,00 $/h', duration: '1 f\u00e9vrier 2026 au 1 f\u00e9vrier 2027', pdf: 'contrat-entretien-siege.pdf', art1: 'Le Prestataire s\u2019engage \u00e0 fournir des services d\u2019entretien g\u00e9n\u00e9ral mensuel incluant nettoyage des vitres, cire des planchers et d\u00e9sinfection.' },
  { title: 'Contrat de d\u00e9m\u00e9nagement', establishment: 'Entrep\u00f4t Nord \u2014 1500 rue Notre-Dame, Montr\u00e9al', ref: 'PE-CTR-2026-0021', dateSigned: '8 f\u00e9vrier 2026', docTitle: 'CONTRAT DE D\u00c9M\u00c9NAGEMENT', rate: '25,00 $/h', duration: '10 f\u00e9vrier 2026 au 12 f\u00e9vrier 2026 (ponctuel)', pdf: 'contrat-demenagement-entrepot.pdf', art1: 'Le Prestataire s\u2019engage \u00e0 fournir une \u00e9quipe de 4 travailleurs pour le d\u00e9m\u00e9nagement complet de l\u2019entrep\u00f4t d\u00e9sign\u00e9.' },
  { title: 'Contrat de service \u2014 Nettoyage hebdo', establishment: 'Succursale Laval \u2014 3200 boul. Le Carrefour, Laval', ref: 'PE-CTR-2026-0009', dateSigned: '20 janvier 2026', docTitle: 'CONTRAT DE NETTOYAGE HEBDOMADAIRE', rate: '21,00 $/h', duration: '20 janvier 2026 au 31 janvier 2026', pdf: 'contrat-nettoyage-laval.pdf', art1: 'Le Prestataire s\u2019engage \u00e0 fournir des services de nettoyage hebdomadaire pour la succursale d\u00e9sign\u00e9e.' }
];

function openContract(index) {
  const c = contracts[index];
  if (!c) return;
  document.getElementById('contract-title').textContent = c.title;
  document.getElementById('contract-subtitle').textContent = c.establishment;
  document.getElementById('contract-pdf-name').textContent = c.pdf;
  document.getElementById('contract-doc-title').textContent = c.docTitle;
  document.getElementById('contract-ref').textContent = c.ref;
  document.getElementById('contract-date-signed').textContent = c.dateSigned;
  document.getElementById('contract-establishment').textContent = c.establishment;
  document.getElementById('contract-art1').textContent = c.art1;
  document.getElementById('contract-art2').textContent = 'Le pr\u00e9sent contrat entre en vigueur pour la p\u00e9riode du ' + c.duration + '.';
  navigate('client-contract-detail');
}

// ---- CLIENT REPORTS DETAIL ----
const clientReports = [
  { id: 'RPT-2026-003', date: '8 f\u00e9v 2026', location: '500 boul. Ren\u00e9-L\u00e9vesque O, Montr\u00e9al', type: 'ras', body: 'Le quart du 8 f\u00e9vrier 2026 (09:00 \u2013 17:00) chez ProClean Solutions s\u2019est d\u00e9roul\u00e9 de mani\u00e8re conforme. Rien \u00e0 d\u00e9clarer.', worker: 'Julie Leblanc', workerInitials: 'JL', schedule: '09:00 \u2013 17:00', photos: 0, incidentCat: '' },
  { id: 'RPT-2026-002', date: '5 f\u00e9v 2026', location: '4200 rue Saint-Denis, Montr\u00e9al', type: 'incident', body: 'Lors du d\u00e9m\u00e9nagement, un miroir mural a \u00e9t\u00e9 endommag\u00e9 dans le couloir du 2e \u00e9tage. Le bris est survenu pendant le d\u00e9placement d\u2019un meuble volumineux. L\u2019\u00e9quipe a s\u00e9curis\u00e9 la zone et document\u00e9 les dommages par photos. Le miroir mesure environ 120x80cm. Aucune blessure \u00e0 signaler.', worker: 'Marc Tremblay', workerInitials: 'MT', schedule: '07:00 \u2013 16:00', photos: 2, incidentCat: 'BRIS' },
  { id: 'RPT-2026-001', date: '3 f\u00e9v 2026', location: '3000 boul. Le Carrefour, Laval', type: 'ras', body: 'Le quart du 3 f\u00e9vrier 2026 (10:00 \u2013 14:00) s\u2019est d\u00e9roul\u00e9 de mani\u00e8re conforme. Rien \u00e0 d\u00e9clarer.', worker: 'Sophie Roy', workerInitials: 'SR', schedule: '10:00 \u2013 14:00', photos: 0, incidentCat: '' }
];

function openClientReport(index) {
  const r = clientReports[index];
  if (!r) return;
  document.getElementById('rpt-detail-title').textContent = 'Rapport #' + r.id;
  document.getElementById('rpt-detail-meta').textContent = r.date + ' \u2022 ' + r.location;
  const badge = document.getElementById('rpt-detail-badge');
  if (r.type === 'ras') {
    badge.textContent = 'RAS';
    badge.className = 'px-3 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full';
    document.getElementById('report-detail-card').className = 'bg-white rounded-xl shadow-sm p-6 border-l-4 border-green-500';
  } else {
    badge.textContent = 'Incident';
    badge.className = 'px-3 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-full';
    document.getElementById('report-detail-card').className = 'bg-white rounded-xl shadow-sm p-6 border-l-4 border-red-500';
  }
  const catEl = document.getElementById('rpt-detail-incident-cat');
  if (r.incidentCat) {
    catEl.classList.remove('hidden');
    catEl.querySelector('span').textContent = r.incidentCat;
  } else {
    catEl.classList.add('hidden');
  }
  document.getElementById('rpt-detail-body').textContent = r.body;
  document.getElementById('rpt-detail-worker').textContent = r.worker;
  document.getElementById('rpt-detail-schedule').textContent = r.schedule;
  const photosEl = document.getElementById('rpt-detail-photos');
  const photosList = document.getElementById('rpt-detail-photos-list');
  if (r.photos > 0) {
    photosEl.classList.remove('hidden');
    photosList.innerHTML = '';
    for (let i = 0; i < r.photos; i++) {
      photosList.innerHTML += '<div class="w-24 h-24 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400 text-xs">Photo ' + (i+1) + '</div>';
    }
  } else {
    photosEl.classList.add('hidden');
  }
  document.getElementById('rpt-chat-worker-initials').textContent = r.workerInitials;
  document.getElementById('rpt-chat-worker-name').textContent = r.worker;
  document.getElementById('report-chat-area').classList.add('hidden');
  document.getElementById('report-chat').innerHTML = '';
  navigate('client-report-detail');
}

function startReportChat(target) {
  const area = document.getElementById('report-chat-area');
  const label = document.getElementById('report-chat-target');
  area.classList.remove('hidden');
  if (target === 'manager') {
    label.textContent = 'Gestionnaire';
  } else {
    label.textContent = document.getElementById('rpt-chat-worker-name').textContent;
  }
  document.getElementById('report-chat').innerHTML = '<div class="flex justify-start mb-2"><div class="bg-gray-100 rounded-2xl rounded-bl-sm px-3 py-2 max-w-xs text-sm text-gray-600">Bonjour, concernant ce rapport, comment puis-je vous aider ?</div></div>';
  document.getElementById('report-chat-input').focus();
}

// ---- CLIENT CONVERSATIONS ----
const clientConversations = [
  { name: 'Admin Gestionnaire', initials: 'AG', color: 'bg-amber-100 text-amber-700', role: 'Gestionnaire de compte', messages: [
    { from: 'them', text: 'Bonjour Pierre, la mission de vendredi au si\u00e8ge est confirm\u00e9e avec 2 travailleurs.', time: '10:30' },
    { from: 'me', text: 'Parfait, merci ! Ils peuvent se stationner au parking P2.', time: '10:32' },
    { from: 'them', text: 'Bien not\u00e9. Je transmets l\u2019information aux travailleurs.', time: '10:35' }
  ]},
  { name: 'Julie Leblanc', initials: 'JL', color: 'bg-green-100 text-green-700', role: 'Travailleuse \u2014 Nettoyage', messages: [
    { from: 'them', text: 'Bonjour ! Je confirme ma pr\u00e9sence pour vendredi au si\u00e8ge.', time: 'Hier 14:20' },
    { from: 'them', text: 'Merci pour la confirmation !', time: 'Hier 14:22' }
  ]},
  { name: 'Marc Tremblay', initials: 'MT', color: 'bg-green-100 text-green-700', role: 'Travailleur \u2014 D\u00e9m\u00e9nagement', messages: [
    { from: 'them', text: 'Je serai l\u00e0 \u00e0 7h demain avec l\u2019\u00e9quipe.', time: '5 f\u00e9v 16:00' }
  ]},
  { name: 'Sophie Roy', initials: 'SR', color: 'bg-green-100 text-green-700', role: 'Travailleuse \u2014 Multi-services', messages: [
    { from: 'me', text: '\u00c0 lundi pour le nettoyage Laval ?', time: '3 f\u00e9v 11:00' },
    { from: 'them', text: 'D\u2019accord, \u00e0 lundi !', time: '3 f\u00e9v 11:15' }
  ]},
  { name: 'Support PE', initials: 'PE', color: 'bg-purple-100 text-purple-700', role: 'Support Premier \u00c9l\u00e9ment', messages: [
    { from: 'them', text: 'Bonjour ! Comment puis-je vous aider ?', time: '1 f\u00e9v 09:00' }
  ]}
];

function selectClientConv(index) {
  const conv = clientConversations[index];
  if (!conv) return;
  // Update conversation list highlight
  document.querySelectorAll('#client-conv-list > div').forEach((el, i) => {
    if (i === index) {
      el.className = 'p-3 bg-purple-50 border-l-4 border-enterprise-600 cursor-pointer';
      // Remove notification badge if present
      const badge = el.querySelector('.bg-red-500');
      if (badge) badge.remove();
    } else {
      el.className = 'p-3 hover:bg-gray-50 cursor-pointer';
    }
  });
  // Update chat header
  document.getElementById('client-chat-avatar').className = 'w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ' + conv.color;
  document.getElementById('client-chat-avatar').textContent = conv.initials;
  document.getElementById('client-chat-name').textContent = conv.name;
  document.getElementById('client-chat-role').textContent = conv.role;
  // Render messages
  const chat = document.getElementById('client-chat');
  chat.innerHTML = '';
  conv.messages.forEach(m => {
    const div = document.createElement('div');
    if (m.from === 'me') {
      div.className = 'flex justify-end mb-2';
      div.innerHTML = '<div class="bg-enterprise-600 text-white rounded-2xl rounded-br-sm px-4 py-2 max-w-xs"><p class="text-sm">' + m.text + '</p><p class="text-xs text-purple-200 mt-1">' + m.time + '</p></div>';
    } else {
      div.className = 'flex justify-start mb-2';
      div.innerHTML = '<div class="bg-gray-100 rounded-2xl rounded-bl-sm px-4 py-2 max-w-xs"><p class="text-sm">' + m.text + '</p><p class="text-xs text-gray-400 mt-1">' + m.time + '</p></div>';
    }
    chat.appendChild(div);
  });
  chat.scrollTop = chat.scrollHeight;
  updateMsgBadge();
}

function updateMsgBadge() {
  // Count remaining unread badges
  let count = 0;
  document.querySelectorAll('#client-conv-list .bg-red-500').forEach(() => count++);
  document.querySelectorAll('.client-msg-badge').forEach(b => {
    if (count > 0) { b.textContent = count; b.classList.remove('hidden'); }
    else { b.classList.add('hidden'); }
  });
}

// ---- REPORTS ----
function setReportType(type) {
  const btnRas = document.getElementById('btn-ras');
  const btnInc = document.getElementById('btn-incident');
  const secRas = document.getElementById('report-ras-section');
  const secInc = document.getElementById('report-incident-section');
  if (type === 'ras') {
    btnRas.className = 'flex-1 py-3 rounded-xl border-2 border-green-500 bg-green-50 text-green-700 font-semibold text-sm text-center';
    btnInc.className = 'flex-1 py-3 rounded-xl border-2 border-gray-200 text-gray-400 font-semibold text-sm text-center';
    secRas.style.display = 'block';
    secInc.style.display = 'none';
  } else {
    btnRas.className = 'flex-1 py-3 rounded-xl border-2 border-gray-200 text-gray-400 font-semibold text-sm text-center';
    btnInc.className = 'flex-1 py-3 rounded-xl border-2 border-red-500 bg-red-50 text-red-700 font-semibold text-sm text-center';
    secRas.style.display = 'none';
    secInc.style.display = 'block';
  }
}

function selectIncidentType(btn) {
  btn.closest('.flex.flex-wrap').querySelectorAll('button').forEach(b => {
    b.className = 'px-3 py-1.5 border-2 rounded-full text-xs font-medium border-gray-200 text-gray-500';
  });
  btn.className = 'px-3 py-1.5 border-2 rounded-full text-xs font-medium border-amber-400 bg-amber-50 text-amber-700';
}

function updateWordCount() {
  const textarea = document.getElementById('report-text');
  const counter = document.getElementById('word-count');
  if (!textarea || !counter) return;
  const words = textarea.value.trim() ? textarea.value.trim().split(/\s+/).length : 0;
  counter.textContent = '(' + words + ' / 500 mots)';
  if (words > 500) {
    counter.classList.add('text-red-500');
    counter.classList.remove('text-gray-400');
  } else {
    counter.classList.remove('text-red-500');
    counter.classList.add('text-gray-400');
  }
}

let photoCount = 0;
function simulatePhotoUpload() {
  photoCount++;
  const container = document.getElementById('photo-preview-container');
  if (!container) return;
  if (photoCount > 4) { alert('Maximum 4 photos'); return; }
  const div = document.createElement('div');
  div.className = 'relative w-20 h-20 bg-gray-200 rounded-xl overflow-hidden';
  div.innerHTML = '<div class="w-full h-full flex items-center justify-center text-gray-400"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909M3.75 21h16.5A2.25 2.25 0 0022.5 18.75V5.25A2.25 2.25 0 0020.25 3H3.75A2.25 2.25 0 001.5 5.25v13.5A2.25 2.25 0 003.75 21z"/></svg></div><button onclick="this.parentElement.remove(); photoCount--;" class="absolute top-0.5 right-0.5 w-5 h-5 bg-red-500 text-white rounded-full text-xs flex items-center justify-center">&times;</button>';
  container.appendChild(div);
}

function submitReport() {
  const btnRas = document.getElementById('btn-ras');
  const isRas = btnRas.className.includes('border-green-500');
  const type = isRas ? 'RAS' : 'Incident';
  if (!isRas) {
    const textarea = document.getElementById('report-text');
    if (!textarea || !textarea.value.trim()) {
      alert('Veuillez décrire l\'incident avant de soumettre.');
      return;
    }
    const words = textarea.value.trim().split(/\s+/).length;
    if (words > 500) {
      alert('Le texte dépasse 500 mots. Veuillez le raccourcir.');
      return;
    }
  }
  if (confirm('Soumettre le rapport (' + type + ') ?\n\nUne fois soumis, vous pourrez encore le modifier et le resoumettre.')) {
    alert('Rapport soumis avec succès !\nRéférence: #RPT-2026-004\n\nVotre gestionnaire sera notifié.');
    navigate('worker-reports');
  }
}

function certifyReport(btn) {
  const card = btn.closest('.bg-white.rounded-xl');
  if (!card) return;
  btn.disabled = true;
  btn.textContent = '✓ Certifié';
  btn.className = 'px-5 py-2.5 bg-green-100 text-green-700 text-sm font-medium rounded-lg cursor-default';
  const transmitBtn = card.querySelector('button[disabled]');
  if (transmitBtn) {
    transmitBtn.disabled = false;
    transmitBtn.style.opacity = '1';
    transmitBtn.className = 'px-5 py-2.5 bg-enterprise-600 text-white text-sm font-semibold rounded-lg hover:bg-enterprise-700';
  }
}

function transmitReport(btn) {
  const card = btn.closest('.bg-white.rounded-xl');
  if (!card) return;
  if (confirm('Transmettre ce rapport au client ?')) {
    btn.disabled = true;
    btn.textContent = '✓ Transmis au client';
    btn.className = 'px-5 py-2.5 bg-blue-100 text-blue-700 text-sm font-medium rounded-lg cursor-default';
    const badge = card.querySelector('.text-\\[10px\\]');
    if (badge) {
      badge.textContent = 'Transmis';
      badge.className = 'text-[10px] text-blue-600 font-medium';
    }
    alert('Rapport transmis au client avec succès.');
  }
}

// ---- BILLING TABS ----
function setBillingTab(tab) {
  document.querySelectorAll('[data-billing-tab]').forEach(el => {
    el.style.display = el.dataset.billingTab === tab ? 'block' : 'none';
  });
  document.querySelectorAll('[data-billing-btn]').forEach(btn => {
    const isActive = btn.dataset.billingBtn === tab;
    btn.classList.toggle('bg-worker-600', isActive);
    btn.classList.toggle('text-white', isActive);
    btn.classList.toggle('bg-gray-200', !isActive);
    btn.classList.toggle('text-gray-700', !isActive);
  });
}

// ---- MY SHIFTS TABS ----
function setMyShiftsTab(tab) {
  document.querySelectorAll('[data-myshifts-tab]').forEach(el => {
    el.style.display = el.dataset.myshiftsTab === tab ? 'block' : 'none';
  });
  document.querySelectorAll('[data-myshifts-btn]').forEach(btn => {
    const isActive = btn.dataset.myshiftsBtn === tab;
    btn.classList.toggle('bg-worker-600', isActive);
    btn.classList.toggle('text-white', isActive);
    btn.classList.toggle('bg-gray-200', !isActive);
    btn.classList.toggle('text-gray-700', !isActive);
  });
}

// ---- SHIFT VIEW MODE (list/calendar/map) ----
function setShiftViewMode(mode) {
  document.querySelectorAll('[data-shift-view]').forEach(el => {
    el.style.display = el.dataset.shiftView === mode ? 'block' : 'none';
  });
  document.querySelectorAll('[data-shift-view-btn]').forEach(btn => {
    const isActive = btn.dataset.shiftViewBtn === mode;
    btn.classList.toggle('bg-worker-600', isActive);
    btn.classList.toggle('text-white', isActive);
    btn.classList.toggle('bg-white', !isActive);
    btn.classList.toggle('text-gray-600', !isActive);
  });
  if (mode === 'map') showShiftsMap();
}

// ---- DELAY MODAL ----
function showDelayModal() {
  alert('Signalement de retard envoyé au responsable !');
}
function showCancelModal() {
  if (confirm('Êtes-vous sûr de vouloir annuler ce quart ?')) {
    alert('Quart annulé.');
    navigate('worker-shifts');
  }
}

// ---- MISSIONS ----
const serviceLabels = { menage: 'Ménage', entretien: 'Entretien', demenagement: 'Déménagement', autre: 'Autre' };
const serviceIcons = { menage: '🗓', entretien: '🔧', demenagement: '🚚', autre: '🔨' };
const recurrenceLabels = { none: 'Ponctuel', daily: 'Quotidien', weekly: 'Hebdomadaire', biweekly: 'Bimensuel', monthly: 'Mensuel' };
const statusColors = {
  active: 'bg-green-100 text-green-700',
  evaluation: 'bg-amber-100 text-amber-700',
  draft: 'bg-gray-100 text-gray-600',
  completed: 'bg-blue-100 text-blue-700',
  cancelled: 'bg-red-100 text-red-700'
};

function renderMissions() {
  const container = document.getElementById('missions-list');
  if (!container) return;
  if (missions.length === 0) {
    container.innerHTML = '<div class="text-center py-12 text-gray-400"><p class="text-lg mb-2">Aucune mission</p><p class="text-sm">Créez votre première mission pour commencer.</p></div>';
    return;
  }
  container.innerHTML = missions.map((m, i) => `
    <div onclick="openMissionDetail(${i})" class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 hover:shadow-md cursor-pointer transition-shadow">
      <div class="flex items-start gap-4">
        <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center text-2xl flex-shrink-0">${serviceIcons[m.service] || '📋'}</div>
        <div class="flex-1 min-w-0">
          <div class="flex items-center justify-between gap-2">
            <h3 class="font-semibold text-gray-900 truncate">${m.title}</h3>
            <span class="px-2.5 py-0.5 text-[10px] font-bold rounded-full flex-shrink-0 ${statusColors[m.status] || 'bg-gray-100 text-gray-600'}">${m.statusLabel}</span>
          </div>
          <p class="text-xs text-gray-400 mt-0.5">${m.ref}</p>
          <div class="flex flex-wrap items-center gap-3 mt-2 text-xs text-gray-500">
            <span>${m.serviceLabel}</span>
            <span>•</span>
            <span>${m.address.split(',')[0]}</span>
            <span>•</span>
            <span>${m.startDate} → ${m.endDate || '—'}</span>
            <span>•</span>
            <span>${m.workers} travailleur${m.workers > 1 ? 's' : ''}</span>
          </div>
          <div class="flex items-center gap-4 mt-2">
            <span class="text-sm font-semibold text-enterprise-600">${m.hasFinalRate ? m.finalRate.toFixed(2) : m.rate.toFixed(2)}$/h</span>
            ${m.hasFinalRate ? '<span class="text-[10px] bg-green-50 text-green-600 px-2 py-0.5 rounded-full font-medium">Coût confirmé</span>' : ''}
            ${m.budget ? '<span class="text-xs text-gray-400">Budget: ' + m.budget + '$/mois</span>' : ''}
          </div>
        </div>
      </div>
    </div>
  `).join('');
}

function selectMissionService(btn, type) {
  selectedMissionService = type;
  document.querySelectorAll('#m-service-types button').forEach(b => {
    b.classList.remove('border-enterprise-500', 'bg-enterprise-50', 'text-enterprise-700');
    b.classList.add('border-gray-200', 'text-gray-500');
  });
  btn.classList.remove('border-gray-200', 'text-gray-500');
  btn.classList.add('border-enterprise-500', 'bg-enterprise-50', 'text-enterprise-700');
  // Update summary
  const msService = document.getElementById('ms-service');
  if (msService) msService.textContent = serviceLabels[type] || type;
}

function initMissionMap() {
  const mapDiv = document.getElementById('mission-map');
  if (!mapDiv) return;
  if (missionMap) { missionMap.remove(); missionMap = null; }
  missionMap = L.map('mission-map').setView([45.5017, -73.5673], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap'
  }).addTo(missionMap);
}

function geocodeMissionAddress() {
  const address = document.getElementById('m-address').value.trim();
  if (!address) { alert('Veuillez entrer une adresse.'); return; }
  // Use Nominatim free geocoder
  fetch('https://nominatim.openstreetmap.org/search?format=json&q=' + encodeURIComponent(address + ', Québec, Canada') + '&limit=1')
    .then(r => r.json())
    .then(data => {
      if (data.length > 0) {
        const lat = parseFloat(data[0].lat);
        const lng = parseFloat(data[0].lon);
        if (missionMap) {
          missionMap.setView([lat, lng], 15);
          L.marker([lat, lng]).addTo(missionMap).bindPopup(address).openPopup();
        }
        // Update summary
        const msAddr = document.getElementById('ms-address');
        if (msAddr) msAddr.textContent = address.split(',')[0];
      } else {
        // Fallback: place marker at Montreal center
        if (missionMap) {
          missionMap.setView([45.5017, -73.5673], 14);
          L.marker([45.5017, -73.5673]).addTo(missionMap).bindPopup(address).openPopup();
        }
        const msAddr = document.getElementById('ms-address');
        if (msAddr) msAddr.textContent = address.split(',')[0];
      }
    })
    .catch(() => {
      // On error, still place a pin at default location
      if (missionMap) {
        missionMap.setView([45.5017, -73.5673], 14);
        L.marker([45.5017, -73.5673]).addTo(missionMap).bindPopup(address).openPopup();
      }
    });
}

function resetMissionForm() {
  selectedMissionService = 'menage';
  // Reset service buttons
  const btns = document.querySelectorAll('#m-service-types button');
  btns.forEach(b => {
    const svc = b.getAttribute('data-svc');
    if (svc === 'menage') {
      b.classList.add('border-enterprise-500', 'bg-enterprise-50', 'text-enterprise-700');
      b.classList.remove('border-gray-200', 'text-gray-500');
    } else {
      b.classList.remove('border-enterprise-500', 'bg-enterprise-50', 'text-enterprise-700');
      b.classList.add('border-gray-200', 'text-gray-500');
    }
  });
  // Update summary defaults
  updateMissionSummary();
}

function updateMissionSummary() {
  const v = id => { const el = document.getElementById(id); return el ? el.value : ''; };
  const s = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
  s('ms-client', v('m-client-name') || '—');
  s('ms-service', serviceLabels[selectedMissionService] || '—');
  s('ms-address', v('m-address') ? v('m-address').split(',')[0] : '—');
  const sd = v('m-start-date'), ed = v('m-end-date');
  if (sd) {
    const start = new Date(sd);
    const months = ['jan', 'fév', 'mar', 'avr', 'mai', 'jun', 'jul', 'aoû', 'sep', 'oct', 'nov', 'déc'];
    let periodStr = start.getDate() + ' ' + months[start.getMonth()];
    if (ed) {
      const end = new Date(ed);
      periodStr += ' — ' + end.getDate() + ' ' + months[end.getMonth()];
    }
    s('ms-period', periodStr);
  }
  s('ms-hours', (v('m-start-time') || '—') + ' – ' + (v('m-end-time') || '—'));
  s('ms-workers', v('m-workers') || '—');
  s('ms-rate', v('m-rate') ? v('m-rate') + '$/h' : '—');
  s('ms-budget', v('m-budget') ? v('m-budget') + '$' : '—');
}

function submitMission() {
  const title = document.getElementById('m-title').value.trim();
  const clientName = document.getElementById('m-client-name').value.trim();
  const address = document.getElementById('m-address').value.trim();
  if (!title) { alert('Veuillez entrer un titre de mission.'); return; }
  if (!clientName) { alert('Veuillez entrer le nom du client.'); return; }
  if (!address) { alert('Veuillez entrer une adresse.'); return; }

  const num = String(missions.length + 1).padStart(4, '0');
  const ref = 'PE-MSN-2026-' + num;
  const now = new Date();
  const months = ['jan.', 'fév.', 'mar.', 'avr.', 'mai', 'jun.', 'jul.', 'aoû.', 'sep.', 'oct.', 'nov.', 'déc.'];
  const createdAt = now.getDate() + ' ' + months[now.getMonth()] + ' ' + now.getFullYear();

  const newMission = {
    ref: ref,
    clientName: clientName,
    contact: document.getElementById('m-contact').value || '',
    phone: document.getElementById('m-phone').value || '',
    email: document.getElementById('m-email').value || '',
    address: address,
    city: document.getElementById('m-city').value || '',
    postal: document.getElementById('m-postal').value || '',
    lat: 45.5017,
    lng: -73.5673,
    service: selectedMissionService,
    serviceLabel: serviceLabels[selectedMissionService] || selectedMissionService,
    title: title,
    description: document.getElementById('m-description').value || '',
    startDate: document.getElementById('m-start-date').value || '',
    endDate: document.getElementById('m-end-date').value || '',
    startTime: document.getElementById('m-start-time').value || '',
    endTime: document.getElementById('m-end-time').value || '',
    recurrence: document.getElementById('m-recurrence').value || 'none',
    workers: parseInt(document.getElementById('m-workers').value) || 1,
    rate: parseFloat(document.getElementById('m-rate').value) || 0,
    budget: parseFloat(document.getElementById('m-budget').value) || 0,
    status: 'evaluation',
    statusLabel: 'En évaluation',
    finalRate: null,
    hasFinalRate: false,
    createdAt: createdAt,
    timeline: ['Demande soumise — ' + createdAt, 'Évaluation en cours']
  };

  missions.push(newMission);
  alert('Mission ' + ref + ' soumise avec succès !\nVotre demande a été envoyée au gestionnaire pour évaluation.');
  navigate('client-missions');
}

function saveMissionDraft() {
  const title = document.getElementById('m-title').value.trim() || 'Mission sans titre';
  const clientName = document.getElementById('m-client-name').value.trim() || '—';

  const num = String(missions.length + 1).padStart(4, '0');
  const ref = 'PE-MSN-2026-' + num;
  const now = new Date();
  const months = ['jan.', 'fév.', 'mar.', 'avr.', 'mai', 'jun.', 'jul.', 'aoû.', 'sep.', 'oct.', 'nov.', 'déc.'];
  const createdAt = now.getDate() + ' ' + months[now.getMonth()] + ' ' + now.getFullYear();

  const draft = {
    ref: ref,
    clientName: clientName,
    contact: document.getElementById('m-contact').value || '',
    phone: document.getElementById('m-phone').value || '',
    email: document.getElementById('m-email').value || '',
    address: document.getElementById('m-address').value || '',
    city: document.getElementById('m-city').value || '',
    postal: document.getElementById('m-postal').value || '',
    lat: 45.5017,
    lng: -73.5673,
    service: selectedMissionService,
    serviceLabel: serviceLabels[selectedMissionService] || selectedMissionService,
    title: title,
    description: document.getElementById('m-description').value || '',
    startDate: document.getElementById('m-start-date').value || '',
    endDate: document.getElementById('m-end-date').value || '',
    startTime: document.getElementById('m-start-time').value || '',
    endTime: document.getElementById('m-end-time').value || '',
    recurrence: document.getElementById('m-recurrence').value || 'none',
    workers: parseInt(document.getElementById('m-workers').value) || 1,
    rate: parseFloat(document.getElementById('m-rate').value) || 0,
    budget: parseFloat(document.getElementById('m-budget').value) || 0,
    status: 'draft',
    statusLabel: 'Brouillon',
    finalRate: null,
    hasFinalRate: false,
    createdAt: createdAt,
    timeline: ['Brouillon créé — ' + createdAt]
  };

  missions.push(draft);
  alert('Brouillon ' + ref + ' enregistré.');
  navigate('client-missions');
}

function openMissionDetail(index) {
  const m = missions[index];
  if (!m) return;
  // Store current editing index
  window._missionIndex = index;
  missionEditMode = false;

  // Fill detail fields
  document.getElementById('md-title').textContent = m.title;
  document.getElementById('md-ref').textContent = m.ref;
  document.getElementById('md-client').value = m.clientName;
  document.getElementById('md-contact').value = m.contact;
  document.getElementById('md-service').value = m.serviceLabel;
  document.getElementById('md-address').value = m.address;
  document.getElementById('md-description').value = m.description;
  document.getElementById('md-start').value = m.startDate;
  document.getElementById('md-end').value = m.endDate;
  document.getElementById('md-hours').value = (m.startTime || '') + ' – ' + (m.endTime || '');
  document.getElementById('md-workers').value = m.workers;
  document.getElementById('md-rate').value = m.rate;
  document.getElementById('md-budget').value = m.budget || '';

  // Status badge
  const badge = document.getElementById('md-status-badge');
  badge.textContent = m.statusLabel;
  badge.className = 'px-3 py-1 text-xs font-bold rounded-full ' + (statusColors[m.status] || 'bg-gray-100 text-gray-600');

  // Final rate
  const costNote = document.getElementById('md-cost-note');
  if (m.hasFinalRate && m.finalRate) {
    costNote.classList.remove('hidden');
    document.getElementById('md-final-rate').textContent = m.finalRate.toFixed(2);
  } else {
    costNote.classList.add('hidden');
  }

  // Timeline
  const tl = document.getElementById('md-timeline');
  tl.innerHTML = m.timeline.map((step, i) => {
    const isLast = i === m.timeline.length - 1;
    const dotColor = isLast && m.status === 'evaluation' ? 'bg-amber-500' : (isLast && m.status === 'draft' ? 'bg-gray-400' : 'bg-enterprise-600');
    return '<div class="flex gap-3"><div class="w-2 h-2 mt-1.5 ' + dotColor + ' rounded-full flex-shrink-0"></div><div><p class="text-sm font-medium">' + step.split(' — ')[0] + '</p><p class="text-xs text-gray-400">' + (step.split(' — ')[1] || '') + '</p></div></div>';
  }).join('');

  // Reset chat
  const chat = document.getElementById('md-chat');
  if (m.status === 'draft') {
    chat.innerHTML = '<p class="text-xs text-gray-400 text-center py-6">Soumettez la mission pour démarrer la discussion avec le gestionnaire.</p>';
  } else {
    chat.innerHTML = '<p class="text-xs text-gray-400 text-center py-6">La discussion avec le gestionnaire commencera après soumission.</p>';
    if (m.status === 'active' || m.status === 'evaluation') {
      chat.innerHTML = '<div class="flex justify-start"><div class="bg-gray-100 rounded-2xl rounded-bl-sm px-3 py-2 max-w-[80%]"><p class="text-sm">Bonjour, nous avons bien reçu votre demande de mission. Nous l\'analysons actuellement.</p><p class="text-[10px] text-gray-400 mt-1">Gestionnaire — ' + m.createdAt + '</p></div></div>';
    }
  }

  // Ensure readonly mode
  setMissionFieldsReadonly(true);
  document.getElementById('md-save-bar').classList.add('hidden');

  navigate('client-mission-detail');
}

function toggleMissionEdit() {
  missionEditMode = !missionEditMode;
  setMissionFieldsReadonly(!missionEditMode);
  const saveBar = document.getElementById('md-save-bar');
  const editBtn = document.getElementById('md-edit-btn');
  if (missionEditMode) {
    saveBar.classList.remove('hidden');
    editBtn.innerHTML = '<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>Annuler';
  } else {
    saveBar.classList.add('hidden');
    editBtn.innerHTML = '<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>Modifier';
    // Reload data to cancel changes
    if (window._missionIndex !== undefined) openMissionDetail(window._missionIndex);
  }
}

function setMissionFieldsReadonly(readonly) {
  ['md-client','md-contact','md-service','md-address','md-description','md-start','md-end','md-hours','md-workers','md-rate','md-budget'].forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.readOnly = readonly;
      if (readonly) {
        el.classList.add('bg-gray-50');
        el.classList.remove('bg-white', 'border-enterprise-500');
      } else {
        el.classList.remove('bg-gray-50');
        el.classList.add('bg-white', 'border-enterprise-500');
      }
    }
  });
}

function saveMissionChanges() {
  const i = window._missionIndex;
  if (i === undefined || !missions[i]) return;
  const m = missions[i];
  m.clientName = document.getElementById('md-client').value;
  m.contact = document.getElementById('md-contact').value;
  m.serviceLabel = document.getElementById('md-service').value;
  m.address = document.getElementById('md-address').value;
  m.description = document.getElementById('md-description').value;
  m.startDate = document.getElementById('md-start').value;
  m.endDate = document.getElementById('md-end').value;
  const hours = document.getElementById('md-hours').value;
  if (hours.includes('–')) {
    const parts = hours.split('–').map(s => s.trim());
    m.startTime = parts[0];
    m.endTime = parts[1];
  }
  m.workers = parseInt(document.getElementById('md-workers').value) || m.workers;
  m.rate = parseFloat(document.getElementById('md-rate').value) || m.rate;
  m.budget = parseFloat(document.getElementById('md-budget').value) || m.budget;

  missionEditMode = false;
  alert('Modifications enregistrées.');
  openMissionDetail(i);
}

// Live summary updates on mission creation form
document.addEventListener('input', function(e) {
  const id = e.target.id;
  if (['m-client-name','m-address','m-start-date','m-end-date','m-start-time','m-end-time','m-workers','m-rate','m-budget'].includes(id)) {
    updateMissionSummary();
  }
});

// ---- MANAGER MISSIONS ----
function renderMgrMissions() {
  const container = document.getElementById('mgr-missions-list');
  if (!container) return;
  // Show all missions (same shared data — client creates, manager sees)
  const mgrMissions = missions.filter(m => m.status !== 'draft');
  if (mgrMissions.length === 0) {
    container.innerHTML = '<div class="text-center py-12 text-gray-400"><p class="text-lg mb-2">Aucune mission reçue</p><p class="text-sm">Les missions soumises par les clients s\'afficheront ici.</p></div>';
    return;
  }
  container.innerHTML = mgrMissions.map((m, idx) => {
    const realIdx = missions.indexOf(m);
    return `
    <div onclick="openMgrMissionDetail(${realIdx})" class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 hover:shadow-md cursor-pointer transition-shadow">
      <div class="flex items-start gap-4">
        <div class="w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center text-2xl flex-shrink-0">${serviceIcons[m.service] || '📋'}</div>
        <div class="flex-1 min-w-0">
          <div class="flex items-center justify-between gap-2">
            <h3 class="font-semibold text-gray-900 truncate">${m.title}</h3>
            <span class="px-2.5 py-0.5 text-[10px] font-bold rounded-full flex-shrink-0 ${statusColors[m.status] || 'bg-gray-100 text-gray-600'}">${m.statusLabel}</span>
          </div>
          <p class="text-xs text-gray-400 mt-0.5">${m.ref} — ${m.clientName}</p>
          <div class="flex flex-wrap items-center gap-3 mt-2 text-xs text-gray-500">
            <span>${m.serviceLabel}</span>
            <span>•</span>
            <span>${m.address.split(',')[0]}</span>
            <span>•</span>
            <span>${m.workers} travailleur${m.workers > 1 ? 's' : ''}</span>
            <span>•</span>
            <span>Taux proposé: ${m.rate.toFixed(2)}$/h</span>
          </div>
          ${m.hasFinalRate ? '<div class="mt-2"><span class="text-[10px] bg-green-50 text-green-600 px-2 py-0.5 rounded-full font-medium">Coût confirmé: ' + m.finalRate.toFixed(2) + '$/h</span></div>' : '<div class="mt-2"><span class="text-[10px] bg-amber-50 text-amber-600 px-2 py-0.5 rounded-full font-medium">En attente d\'évaluation</span></div>'}
        </div>
      </div>
    </div>`;
  }).join('');
}

function openMgrMissionDetail(index) {
  const m = missions[index];
  if (!m) return;
  window._mgrMissionIndex = index;

  document.getElementById('mmd-title').textContent = m.title;
  document.getElementById('mmd-ref').textContent = m.ref;
  document.getElementById('mmd-client').textContent = m.clientName;
  document.getElementById('mmd-contact').textContent = m.contact;
  document.getElementById('mmd-phone').textContent = m.phone;
  document.getElementById('mmd-email').textContent = m.email;
  document.getElementById('mmd-service').textContent = m.serviceLabel;
  document.getElementById('mmd-address').textContent = m.address;
  document.getElementById('mmd-description').textContent = m.description;
  document.getElementById('mmd-start').textContent = m.startDate;
  document.getElementById('mmd-end').textContent = m.endDate || '—';
  document.getElementById('mmd-hours').textContent = (m.startTime || '') + ' – ' + (m.endTime || '');
  document.getElementById('mmd-workers').textContent = m.workers;
  document.getElementById('mmd-rate-proposed').textContent = m.rate.toFixed(2) + ' $/h';
  document.getElementById('mmd-budget').textContent = m.budget ? m.budget + ' $/mois' : '—';

  // Status badge
  const badge = document.getElementById('mmd-status-badge');
  badge.textContent = m.statusLabel;
  badge.className = 'px-3 py-1 text-xs font-bold rounded-full ' + (statusColors[m.status] || 'bg-gray-100 text-gray-600');

  // Eval section & confirmed rate
  const evalSection = document.getElementById('mmd-eval-section');
  const confirmedDiv = document.getElementById('mmd-confirmed-rate');
  if (m.hasFinalRate && m.finalRate) {
    evalSection.classList.add('hidden');
    confirmedDiv.classList.remove('hidden');
    document.getElementById('mmd-final-rate-display').textContent = m.finalRate.toFixed(2);
  } else {
    evalSection.classList.remove('hidden');
    confirmedDiv.classList.add('hidden');
    document.getElementById('mmd-final-rate-input').value = '';
  }

  // Timeline
  const tl = document.getElementById('mmd-timeline');
  tl.innerHTML = m.timeline.map((step, i) => {
    const isLast = i === m.timeline.length - 1;
    const dotColor = isLast && m.status === 'evaluation' ? 'bg-amber-500' : 'bg-manager-600';
    return '<div class="flex gap-3"><div class="w-2 h-2 mt-1.5 ' + dotColor + ' rounded-full flex-shrink-0"></div><div><p class="text-sm font-medium">' + step.split(' — ')[0] + '</p><p class="text-xs text-gray-400">' + (step.split(' — ')[1] || '') + '</p></div></div>';
  }).join('');

  // Chat
  const chat = document.getElementById('mmd-chat');
  chat.innerHTML = '<div class="flex justify-end"><div class="bg-amber-100 rounded-2xl rounded-br-sm px-3 py-2 max-w-[80%]"><p class="text-sm">Bonjour, nous avons bien reçu votre demande de mission. Nous l\'analysons actuellement.</p><p class="text-[10px] text-gray-400 mt-1">Vous — ' + m.createdAt + '</p></div></div>';

  navigate('manager-mission-detail');
}

function confirmMissionRate() {
  const i = window._mgrMissionIndex;
  if (i === undefined || !missions[i]) return;
  const rateInput = document.getElementById('mmd-final-rate-input');
  const rate = parseFloat(rateInput.value);
  if (!rate || rate < 15) { alert('Veuillez entrer un taux horaire valide (minimum 15$/h).'); return; }

  const m = missions[i];
  m.finalRate = rate;
  m.hasFinalRate = true;
  m.status = 'active';
  m.statusLabel = 'En cours';

  const now = new Date();
  const months = ['jan.', 'fév.', 'mar.', 'avr.', 'mai', 'jun.', 'jul.', 'aoû.', 'sep.', 'oct.', 'nov.', 'déc.'];
  const dateStr = now.getDate() + ' ' + months[now.getMonth()] + ' ' + now.getFullYear();
  // Update timeline
  if (m.timeline[m.timeline.length - 1].includes('Évaluation en cours')) {
    m.timeline.pop();
  }
  m.timeline.push('Évaluation complétée — ' + dateStr);
  m.timeline.push('Coût final confirmé: ' + rate.toFixed(2) + '$/h — ' + dateStr);
  m.timeline.push('Mission démarrée — ' + dateStr);

  alert('Coût final de ' + rate.toFixed(2) + '$/h confirmé pour la mission ' + m.ref + '.\nLa mission est maintenant active.');
  openMgrMissionDetail(i);
}

// ---- MANAGER WORKERS ----
function renderMgrWorkers(filter) {
  const container = document.getElementById('mgr-workers-grid');
  if (!container) return;
  const f = (filter || '').toLowerCase();
  const filtered = mgrWorkers.filter(w => !f || w.name.toLowerCase().includes(f));
  if (filtered.length === 0) {
    container.innerHTML = '<div class="col-span-full text-center py-12 text-gray-400"><p class="text-lg mb-2">Aucun travailleur trouv\u00e9</p><p class="text-sm">Essayez un autre terme de recherche.</p></div>';
    return;
  }
  container.innerHTML = filtered.map((w, idx) => {
    const realIdx = mgrWorkers.indexOf(w);
    const statusColor = w.status === 'Disponible' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
    const avatarColor = w.status === 'Disponible' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
    return `<div onclick="openWorkerDetail(${realIdx})" class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 hover:shadow-md cursor-pointer transition-shadow">
      <div class="flex items-center gap-3 mb-3"><div class="w-10 h-10 ${avatarColor} rounded-full flex items-center justify-center font-bold text-sm">${w.initials}</div><div><p class="font-semibold">${w.name}</p><span class="px-2 py-0.5 ${statusColor} text-xs font-medium rounded-full">${w.status}</span></div></div>
      <p class="text-sm text-gray-500 mb-2">${w.skills.join(', ')}</p>
      <div class="flex justify-between text-sm"><span class="text-gray-400">${w.experience} ans exp.</span><span class="font-semibold text-worker-600">${w.rate.toFixed(2)}$/h</span></div>
    </div>`;
  }).join('');
}

function filterWorkers() {
  const q = document.getElementById('worker-search').value;
  renderMgrWorkers(q);
}

function openWorkerDetail(index) {
  const w = mgrWorkers[index];
  if (!w) return;
  const container = document.getElementById('worker-detail-content');
  const statusColor = w.status === 'Disponible' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
  const avatarColor = w.status === 'Disponible' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
  container.innerHTML = `
    <div class="flex items-center gap-4 mb-6">
      <div class="w-16 h-16 ${avatarColor} rounded-full flex items-center justify-center font-bold text-xl">${w.initials}</div>
      <div><h1 class="text-2xl font-bold">${w.name}</h1><span class="px-3 py-1 ${statusColor} text-xs font-bold rounded-full">${w.status}</span></div>
    </div>
    <div class="grid lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2 space-y-4">
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Informations personnelles</h3>
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label class="text-xs text-gray-400">T\u00e9l\u00e9phone</label><p class="text-sm font-medium mt-1">${w.phone}</p></div>
            <div><label class="text-xs text-gray-400">Courriel</label><p class="text-sm font-medium mt-1">${w.email}</p></div>
            <div><label class="text-xs text-gray-400">Ville</label><p class="text-sm font-medium mt-1">${w.city}</p></div>
            <div><label class="text-xs text-gray-400">Exp\u00e9rience</label><p class="text-sm font-medium mt-1">${w.experience} ans</p></div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h3 class="text-sm font-semibold text-gray-700 mb-3">Comp\u00e9tences</h3>
          <div class="flex flex-wrap gap-2">${w.skills.map(s => '<span class="px-3 py-1 bg-green-50 text-green-700 text-xs font-medium rounded-full">' + s + '</span>').join('')}</div>
        </div>
        <div class="bg-white rounded-xl shadow-sm p-6">
          <h3 class="text-sm font-semibold text-gray-700 mb-3">Quarts r\u00e9cents</h3>
          <div class="space-y-2">${w.recentShifts.map(s => '<div class="flex items-center gap-2 py-2 border-b border-gray-50 last:border-0"><div class="w-2 h-2 bg-manager-600 rounded-full flex-shrink-0"></div><p class="text-sm text-gray-600">' + s + '</p></div>').join('')}</div>
        </div>
      </div>
      <div class="space-y-4">
        <div class="bg-white rounded-xl shadow-sm p-5">
          <h3 class="font-semibold text-sm mb-4">Statistiques</h3>
          <div class="space-y-3">
            <div class="flex justify-between items-center"><span class="text-sm text-gray-500">\u00c9valuation</span><span class="font-bold text-amber-600">${w.rating} / 5</span></div>
            <div class="flex justify-between items-center"><span class="text-sm text-gray-500">Quarts compl\u00e9t\u00e9s</span><span class="font-bold">${w.shiftsCompleted}</span></div>
            <div class="flex justify-between items-center"><span class="text-sm text-gray-500">Heures ce mois</span><span class="font-bold">${w.hoursThisMonth}h</span></div>
            <div class="flex justify-between items-center"><span class="text-sm text-gray-500">Taux horaire</span><span class="font-bold text-worker-600">${w.rate.toFixed(2)}$/h</span></div>
          </div>
        </div>
        <button onclick="alert('Fonctionnalit\u00e9 messagerie : ouvrir conversation avec ${w.name}')" class="w-full py-3 bg-manager-600 text-white font-semibold rounded-lg hover:bg-manager-700 text-sm">Envoyer un message</button>
      </div>
    </div>`;
  navigate('manager-worker-detail');
}

// ---- MANAGER TEAM ----
function renderTeamMembers() {
  const container = document.getElementById('team-members-list');
  if (!container) return;
  container.innerHTML = mgrTeam.map((m, i) => {
    const statusBadge = m.status === 'active'
      ? '<span class="px-2 py-0.5 bg-green-100 text-green-700 text-xs font-medium rounded-full">Actif</span>'
      : '<span class="px-2 py-0.5 bg-amber-100 text-amber-700 text-xs font-medium rounded-full">En attente</span>';
    const initials = m.name.split(' ').map(n => n[0]).join('').substring(0, 2);
    return `<div class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 flex items-center gap-4">
      <div class="w-12 h-12 bg-amber-100 rounded-full flex items-center justify-center text-amber-700 font-bold text-sm flex-shrink-0">${initials}</div>
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2 mb-1"><p class="font-semibold">${m.name}</p>${statusBadge}</div>
        <p class="text-sm text-gray-500">${m.role}</p>
        <div class="flex flex-wrap gap-3 mt-1 text-xs text-gray-400"><span>${m.email}</span><span>${m.phone}</span></div>
      </div>
    </div>`;
  }).join('');
}

function showInviteManagerForm() {
  document.getElementById('invite-manager-form').classList.remove('hidden');
  document.getElementById('invite-success').classList.add('hidden');
  document.getElementById('invite-name').value = '';
  document.getElementById('invite-email').value = '';
  document.getElementById('invite-phone').value = '';
}

function hideInviteManagerForm() {
  document.getElementById('invite-manager-form').classList.add('hidden');
}

function setInviteMethod(method) {
  currentInviteMethod = method;
  const emailBtn = document.getElementById('invite-method-email');
  const smsBtn = document.getElementById('invite-method-sms');
  if (method === 'email') {
    emailBtn.className = 'flex-1 py-1.5 text-xs font-medium rounded-md bg-white text-manager-600 shadow-sm';
    smsBtn.className = 'flex-1 py-1.5 text-xs font-medium rounded-md text-gray-500';
  } else {
    smsBtn.className = 'flex-1 py-1.5 text-xs font-medium rounded-md bg-white text-manager-600 shadow-sm';
    emailBtn.className = 'flex-1 py-1.5 text-xs font-medium rounded-md text-gray-500';
  }
}

function submitInviteManager() {
  const name = document.getElementById('invite-name').value.trim();
  const email = document.getElementById('invite-email').value.trim();
  const phone = document.getElementById('invite-phone').value.trim();
  if (!name) { alert('Veuillez entrer un nom.'); return; }
  if (currentInviteMethod === 'email' && !email) { alert('Veuillez entrer un courriel.'); return; }
  if (currentInviteMethod === 'sms' && !phone) { alert('Veuillez entrer un num\u00e9ro de t\u00e9l\u00e9phone.'); return; }
  const link = 'https://premierelement.ca/inscription/mgr/' + Math.random().toString(36).substring(2, 10);
  const dest = currentInviteMethod === 'email' ? email : phone;
  mgrTeam.push({ name: name, role: 'Gestionnaire', email: email || '—', phone: phone || '—', status: 'pending' });
  const successDiv = document.getElementById('invite-success');
  const successMsg = document.getElementById('invite-success-msg');
  successMsg.innerHTML = 'Invitation envoy\u00e9e \u00e0 <strong>' + name + '</strong> via ' + (currentInviteMethod === 'email' ? 'courriel' : 'SMS') + ' (' + dest + ').<br>Lien d\'inscription : <code class="text-xs bg-green-100 px-1 py-0.5 rounded">' + link + '</code>';
  successDiv.classList.remove('hidden');
  renderTeamMembers();
}

// ---- VALIDATION ----
function setValidationTab(tab) {
  const tsPanel = document.getElementById('validation-timesheets-panel');
  const asPanel = document.getElementById('validation-assignments-panel');
  const tsBtn = document.getElementById('vtab-timesheets');
  const asBtn = document.getElementById('vtab-assignments');
  if (tab === 'timesheets') {
    tsPanel.classList.remove('hidden');
    asPanel.classList.add('hidden');
    tsBtn.className = 'flex-1 py-2 text-sm font-medium rounded-md bg-white text-manager-600 shadow-sm';
    asBtn.className = 'flex-1 py-2 text-sm font-medium rounded-md text-gray-500';
    renderTimesheets('all');
  } else {
    tsPanel.classList.add('hidden');
    asPanel.classList.remove('hidden');
    asBtn.className = 'flex-1 py-2 text-sm font-medium rounded-md bg-white text-manager-600 shadow-sm';
    tsBtn.className = 'flex-1 py-2 text-sm font-medium rounded-md text-gray-500';
    renderAssignments();
  }
}

function renderTimesheets(filter) {
  const container = document.getElementById('timesheets-list');
  if (!container) return;
  document.querySelectorAll('.ts-filter').forEach(btn => {
    btn.className = 'ts-filter px-3 py-1.5 text-xs font-medium rounded-full cursor-pointer ';
    const t = btn.textContent.trim();
    if (t === 'Tous' && filter === 'all') btn.className += 'bg-gray-900 text-white';
    else if (t === 'En attente' && filter === 'pending') btn.className += 'bg-amber-500 text-white';
    else if (t.startsWith('Approuv') && filter === 'approved') btn.className += 'bg-green-500 text-white';
    else if (t.startsWith('Refus') && filter === 'rejected') btn.className += 'bg-red-500 text-white';
    else if (t === 'Tous') btn.className += 'bg-gray-200 text-gray-700';
    else if (t === 'En attente') btn.className += 'bg-amber-100 text-amber-700';
    else if (t.startsWith('Approuv')) btn.className += 'bg-green-100 text-green-700';
    else btn.className += 'bg-red-100 text-red-700';
  });
  const filtered = filter === 'all' ? mgrTimesheets : mgrTimesheets.filter(t => t.status === filter);
  if (filtered.length === 0) {
    container.innerHTML = '<div class="text-center py-8 text-gray-400"><p>Aucune feuille de temps dans cette cat\u00e9gorie.</p></div>';
    return;
  }
  container.innerHTML = filtered.map((t, idx) => {
    const realIdx = mgrTimesheets.indexOf(t);
    const statusMap = { pending: { label: 'En attente', color: 'bg-amber-100 text-amber-700', border: 'border-amber-400' }, approved: { label: 'Approuv\u00e9', color: 'bg-green-100 text-green-700', border: 'border-green-400' }, rejected: { label: 'Refus\u00e9', color: 'bg-red-100 text-red-700', border: 'border-red-400' } };
    const s = statusMap[t.status];
    const actions = t.status === 'pending'
      ? '<div class="flex gap-2 mt-3"><button onclick="event.stopPropagation();approveTimesheet(' + realIdx + ')" class="px-4 py-2 bg-green-600 text-white text-xs font-semibold rounded-lg hover:bg-green-700">Approuver</button><button onclick="event.stopPropagation();rejectTimesheet(' + realIdx + ')" class="px-4 py-2 bg-red-600 text-white text-xs font-semibold rounded-lg hover:bg-red-700">Refuser</button></div>'
      : '<span class="inline-block mt-3 px-3 py-1 ' + s.color + ' text-xs font-bold rounded-full">' + s.label + '</span>';
    return `<div class="bg-white rounded-xl shadow-sm p-5 border-l-4 ${s.border}">
      <div class="flex items-start gap-3">
        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-700 font-bold text-sm flex-shrink-0">${t.initials}</div>
        <div class="flex-1">
          <div class="flex items-center justify-between"><p class="font-semibold">${t.worker}</p><span class="px-2 py-0.5 ${s.color} text-[10px] font-bold rounded-full">${s.label}</span></div>
          <p class="text-sm text-gray-500 mt-1">${t.mission}</p>
          <div class="flex flex-wrap gap-3 mt-1 text-xs text-gray-400"><span>${t.date}</span><span>${t.start} \u2013 ${t.end}</span><span>${t.hours}h</span><span>${t.client}</span></div>
          ${actions}
        </div>
      </div>
    </div>`;
  }).join('');
}

function approveTimesheet(i) {
  mgrTimesheets[i].status = 'approved';
  renderTimesheets('all');
}

function rejectTimesheet(i) {
  mgrTimesheets[i].status = 'rejected';
  renderTimesheets('all');
}

function renderAssignments() {
  const container = document.getElementById('assignments-list');
  if (!container) return;
  container.innerHTML = mgrAssignments.map((a, i) => {
    const pct = a.required > 0 ? Math.round((a.assigned / a.required) * 100) : 0;
    const barColor = pct === 100 ? 'bg-green-500' : pct >= 50 ? 'bg-amber-500' : 'bg-red-500';
    return `<div class="bg-white rounded-xl shadow-sm p-5 border border-gray-100">
      <div class="flex items-start justify-between mb-3">
        <div><h3 class="font-semibold">${a.mission}</h3><p class="text-sm text-gray-500 mt-0.5">${a.client} &bull; ${a.date} &bull; ${a.time}</p></div>
        <span class="text-sm font-bold ${pct === 100 ? 'text-green-600' : 'text-amber-600'}">${a.assigned}/${a.required}</span>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-2 mb-3"><div class="${barColor} h-2 rounded-full transition-all" style="width:${pct}%"></div></div>
      <div class="flex flex-wrap gap-1 mb-3">${a.assignedWorkers.map(n => '<span class="px-2 py-0.5 bg-green-50 text-green-700 text-xs font-medium rounded-full">' + n + '</span>').join('')}</div>
      ${a.assigned < a.required ? '<button onclick="assignWorkerPrompt(' + i + ')" class="px-4 py-2 bg-manager-600 text-white text-xs font-semibold rounded-lg hover:bg-manager-700">Assigner un travailleur</button>' : '<span class="px-3 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full">\u2713 Complet</span>'}
    </div>`;
  }).join('');
}

function assignWorkerPrompt(i) {
  const a = mgrAssignments[i];
  const available = mgrWorkers.filter(w => w.status === 'Disponible' && !a.assignedWorkers.includes(w.name));
  if (available.length === 0) { alert('Aucun travailleur disponible pour cette mission.'); return; }
  const names = available.map((w, idx) => (idx + 1) + '. ' + w.name).join('\n');
  const choice = prompt('Choisissez un travailleur \u00e0 assigner :\n' + names + '\n\nEntrez le num\u00e9ro :');
  if (!choice) return;
  const idx = parseInt(choice) - 1;
  if (idx >= 0 && idx < available.length) {
    a.assignedWorkers.push(available[idx].name);
    a.assigned = a.assignedWorkers.length;
    renderAssignments();
  }
}

// ---- MANAGER CLIENTS ----
function renderMgrClients() {
  const container = document.getElementById('mgr-clients-grid');
  if (!container) return;
  container.innerHTML = mgrClients.map((c, i) => {
    const statusColor = c.status === 'Actif' ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700';
    const initials = c.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
    return `<div onclick="openClientDetail(${i})" class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 hover:shadow-md cursor-pointer transition-shadow">
      <div class="flex items-center gap-3 mb-3">
        <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center text-purple-700 font-bold text-sm">${initials}</div>
        <div><p class="font-semibold">${c.name}</p><span class="px-2 py-0.5 ${statusColor} text-xs font-medium rounded-full">${c.status}</span></div>
      </div>
      <p class="text-sm text-gray-500 mb-2">${c.contact}</p>
      <div class="flex justify-between text-sm"><span class="text-gray-400">${c.contracts} contrat${c.contracts > 1 ? 's' : ''}</span><span class="text-gray-400">${c.missions} mission${c.missions > 1 ? 's' : ''}</span></div>
    </div>`;
  }).join('');
}

function openClientDetail(index) {
  const c = mgrClients[index];
  if (!c) return;
  const container = document.getElementById('client-detail-content');
  const statusColor = c.status === 'Actif' ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700';
  const contractsHtml = c.contractsList.length > 0
    ? c.contractsList.map(ci => '<div onclick="openMgrContract(' + ci + ')" class="p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer flex items-center gap-2"><svg class="w-5 h-5 text-red-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg><span class="text-sm font-medium">Contrat #' + (ci + 1) + '</span></div>').join('')
    : '<p class="text-sm text-gray-400">Aucun contrat</p>';
  const missionsHtml = c.missionsList.length > 0
    ? c.missionsList.map(mi => {
        const m = missions[mi];
        if (!m) return '';
        return '<div onclick="openMgrMissionDetail(' + mi + ')" class="p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><p class="text-sm font-medium">' + m.title + '</p><p class="text-xs text-gray-400">' + m.ref + ' \u2014 ' + m.statusLabel + '</p></div>';
      }).join('')
    : '<p class="text-sm text-gray-400">Aucune mission li\u00e9e</p>';
  container.innerHTML = `
    <div class="lg:col-span-2 space-y-4">
      <div class="bg-white rounded-xl shadow-sm p-6">
        <div class="flex items-center gap-4 mb-4">
          <div class="w-14 h-14 bg-purple-100 rounded-full flex items-center justify-center text-purple-700 font-bold text-lg">${c.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase()}</div>
          <div><h2 class="text-xl font-bold">${c.name}</h2><span class="px-3 py-1 ${statusColor} text-xs font-bold rounded-full">${c.status}</span></div>
        </div>
        <div class="grid sm:grid-cols-2 gap-4">
          <div><label class="text-xs text-gray-400">Contact</label><p class="text-sm font-medium mt-1">${c.contact}</p></div>
          <div><label class="text-xs text-gray-400">Courriel</label><p class="text-sm font-medium mt-1">${c.email}</p></div>
          <div><label class="text-xs text-gray-400">T\u00e9l\u00e9phone</label><p class="text-sm font-medium mt-1">${c.phone}</p></div>
          <div><label class="text-xs text-gray-400">Adresse</label><p class="text-sm font-medium mt-1">${c.address}</p></div>
        </div>
      </div>
      <div class="bg-white rounded-xl shadow-sm p-6">
        <h3 class="text-sm font-semibold text-gray-700 mb-3">Contrats</h3>
        <div class="space-y-2">${contractsHtml}</div>
      </div>
      <div class="bg-white rounded-xl shadow-sm p-6">
        <h3 class="text-sm font-semibold text-gray-700 mb-3">Missions</h3>
        <div class="space-y-2">${missionsHtml}</div>
      </div>
    </div>
    <div>
      <div class="bg-white rounded-xl shadow-sm p-5">
        <h3 class="font-semibold text-sm mb-4">R\u00e9sum\u00e9</h3>
        <div class="space-y-3">
          <div class="flex justify-between items-center"><span class="text-sm text-gray-500">Client depuis</span><span class="font-medium text-sm">${c.since}</span></div>
          <div class="flex justify-between items-center"><span class="text-sm text-gray-500">Contrats actifs</span><span class="font-bold">${c.contracts}</span></div>
          <div class="flex justify-between items-center"><span class="text-sm text-gray-500">Total missions</span><span class="font-bold">${c.missions}</span></div>
          <div class="flex justify-between items-center"><span class="text-sm text-gray-500">Statut</span><span class="px-2 py-0.5 ${statusColor} text-xs font-medium rounded-full">${c.status}</span></div>
        </div>
      </div>
    </div>`;
  navigate('manager-client-detail');
}

// ---- INIT ----
navigate('landing');
</script>
</body>
</html>
